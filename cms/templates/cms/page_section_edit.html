{% extends "base.html" %}
{% load static %}

{% block title %}{% if object %}Edit{% else %}Create{% endif %} Page Section - {{ block.super }}{% endblock %}

{% block extra_css %}
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
    /* System Color Scheme */
    :root {
        /* Secondary Colors */
        --secondary-color: #4a5568;
        
        /* UI Colors */
        --ui-background: #f7fafc;
        --ui-surface: #ffffff;
        --ui-border: #e2e8f0;
        --ui-hover: #edf2f7;
        
        /* Text Colors */
        --text-primary: #2d3748;
        --text-secondary: #718096;
        --text-muted: #a0aec0;
        --text-light: #ffffff;
        
        /* Feedback Colors */
        --feedback-success: #48bb78;
        --feedback-warning: #ed8936;
        --feedback-error: #e53e3e;
        --feedback-info: #4299e1;
        
        /* Shadows */
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
        --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
        
        /* Border Radius */
        --radius-sm: 0.25rem;
        --radius-md: 0.375rem;
        --radius-lg: 0.5rem;
    }
    
    body {
         background-color: var(--ui-background);
         font-size: 0.875rem;
         font-family: 'Poppins', sans-serif;
     }
     
     .container-fluid {
         padding: 1.5rem;
         max-width: 1200px;
         margin: 0 auto;
     }

    /* Header Section */
    .directory-header {
        background: var(--primary-color);
        color: var(--text-light);
        padding: 2rem;
        border-radius: var(--radius-md);
        margin-bottom: 1.5rem;
        box-shadow: var(--shadow-sm);
        text-align: center;
        font-family: 'Poppins', sans-serif;
    }
    
    .directory-title {
        font-size: 2rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        font-family: 'Poppins', sans-serif;
    }
    
    .directory-subtitle {
        opacity: 0.9;
        font-size: 1rem;
        margin: 0;
        font-family: 'Poppins', sans-serif;
    }

    /* Form Card */
    .form-card {
        background: var(--ui-surface);
        border-radius: var(--radius-md);
        padding: 2rem;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--ui-border);
        margin-bottom: 1.5rem;
        font-family: 'Poppins', sans-serif;
    }

    /* Section Headers */
    .section-header {
        background: var(--ui-hover);
        padding: 1rem 1.5rem;
        border-radius: var(--radius-sm);
        margin: 2rem 0 1.5rem 0;
        border-left: 4px solid var(--primary-color);
        font-family: 'Poppins', sans-serif;
    }

    .section-header h4 {
        margin: 0;
        color: var(--text-primary);
        font-weight: 600;
        font-size: 1.1rem;
        font-family: 'Poppins', sans-serif;
    }

    /* Form Styles */
    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-group label {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
        display: block;
        font-family: 'Poppins', sans-serif;
        font-size: 0.875rem;
    }

    .form-control {
        border: 1px solid var(--ui-border);
        border-radius: var(--radius-sm);
        padding: 0.75rem;
        font-size: 0.875rem;
        font-family: 'Poppins', sans-serif;
        background: var(--ui-surface);
        color: var(--text-primary);
        transition: all 0.3s ease;
        width: 100%;
    }

    .form-control:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(43, 60, 107, 0.1);
    }

    .form-control::placeholder {
        color: var(--text-muted);
    }

    /* Textarea specific styling */
    .form-control[rows] {
        min-height: 120px;
        resize: vertical;
    }

    /* Checkbox styling */
    .form-check {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-top: 1rem;
    }

    .form-check-input {
        width: 1.25rem;
        height: 1.25rem;
        margin: 0;
        cursor: pointer;
    }

    .form-check-label {
        font-weight: 500;
        color: var(--text-primary);
        cursor: pointer;
        font-family: 'Poppins', sans-serif;
    }

    /* Help text styling */
    .form-text {
        font-size: 0.75rem;
        color: var(--text-secondary);
        margin-top: 0.25rem;
        font-family: 'Poppins', sans-serif;
    }

    /* Button Styles */
    .btn-primary {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        border-radius: var(--radius-sm);
        font-family: 'Poppins', sans-serif;
        transition: all 0.3s ease;
        color: var(--text-light);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        border: none;
        cursor: pointer;
    }

    .btn-primary:hover {
        background-color: var(--primary-hover);
        border-color: var(--primary-hover);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
        color: var(--text-light);
    }

    .btn-secondary {
        background-color: var(--secondary-color);
        border-color: var(--secondary-color);
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        border-radius: var(--radius-sm);
        font-family: 'Poppins', sans-serif;
        transition: all 0.3s ease;
        color: var(--text-light);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-secondary:hover {
        background-color: #2d3748;
        border-color: #2d3748;
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
        color: var(--text-light);
    }

    /* Form Actions */
    .form-actions {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
        padding-top: 1.5rem;
        border-top: 1px solid var(--ui-border);
    }

    /* Error Messages */
    .text-danger {
        color: var(--feedback-error);
        font-size: 0.75rem;
        margin-top: 0.25rem;
        font-family: 'Poppins', sans-serif;
    }

    /* Breadcrumb */
    .breadcrumb {
        background: transparent;
        padding: 0;
        margin-bottom: 1.5rem;
        font-family: 'Poppins', sans-serif;
    }

    .breadcrumb-item a {
        color: var(--primary-color);
        text-decoration: none;
    }

    .breadcrumb-item.active {
        color: var(--text-secondary);
    }

    /* Section Type Help Icon */
    .section-type-help-icon {
        margin-top: 0.5rem;
        display: inline-block;
    }
    
    .section-type-help-icon i {
        color: var(--feedback-info);
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        padding: 0.25rem;
        border-radius: 50%;
    }
    
    .section-type-help-icon i:hover {
        color: var(--primary-color);
        background-color: var(--ui-hover);
        transform: scale(1.1);
    }

    /* Order Help Icon */
    .order-help-icon {
        margin-top: 0.5rem;
        display: inline-block;
    }
    
    .order-help-icon i {
        color: var(--feedback-warning);
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        padding: 0.25rem;
        border-radius: 50%;
    }
    
    .order-help-icon i:hover {
        color: var(--primary-color);
        background-color: var(--ui-hover);
        transform: scale(1.1);
    }
    
    /* Preview Modal */
    .preview-modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
    }
    
    .preview-modal-content {
        background-color: var(--ui-surface);
        margin: 2% auto;
        padding: 0;
        border-radius: var(--radius-md);
        width: 90%;
        max-width: 800px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        font-family: 'Poppins', sans-serif;
    }
    
    .preview-modal-header {
        background: var(--primary-color);
        color: var(--text-light);
        padding: 1.5rem;
        border-radius: var(--radius-md) var(--radius-md) 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .preview-modal-title {
        margin: 0;
        font-size: 1.25rem;
        font-weight: 600;
        font-family: 'Poppins', sans-serif;
    }
    
    .preview-modal-close {
        background: none;
        border: none;
        color: var(--text-light);
        font-size: 1.5rem;
        cursor: pointer;
        padding: 0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: background-color 0.3s ease;
    }
    
    .preview-modal-close:hover {
        background-color: rgba(255, 255, 255, 0.2);
    }
    
    .preview-modal-body {
        padding: 2rem;
    }
    
    .preview-section {
        border: 2px dashed var(--ui-border);
        border-radius: var(--radius-md);
        padding: 2rem;
        background: var(--ui-background);
        text-align: center;
        font-family: 'Poppins', sans-serif;
    }
    
    .preview-section.hero {
        background: linear-gradient(135deg, var(--primary-color), var(--feedback-info));
        color: var(--text-light);
        border: none;
    }
    
    .preview-section.features {
        background: var(--ui-surface);
        border-color: var(--feedback-success);
    }
    
    .preview-section.testimonials {
        background: var(--ui-surface);
        border-color: var(--feedback-warning);
    }
    
    .preview-section.cta {
        background: var(--primary-color);
        color: var(--text-light);
        border: none;
    }
    
    .preview-section.announcements {
        background: var(--ui-surface);
        border-color: var(--feedback-info);
    }
    
    .preview-section.stats {
        background: var(--ui-surface);
        border-color: var(--secondary-color);
    }
    
    .preview-title {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 1rem;
        font-family: 'Poppins', sans-serif;
    }
    
    .preview-subtitle {
        font-size: 1.125rem;
        margin-bottom: 1.5rem;
        opacity: 0.9;
        font-family: 'Poppins', sans-serif;
    }
    
    .preview-content {
        font-size: 1rem;
        line-height: 1.6;
        margin-bottom: 1.5rem;
        font-family: 'Poppins', sans-serif;
    }
    
    .preview-placeholder {
        color: var(--text-muted);
        font-style: italic;
        font-family: 'Poppins', sans-serif;
    }
    
    /* Preview Button */
    .preview-btn {
        background-color: var(--feedback-info);
        border-color: var(--feedback-info);
        color: var(--text-light);
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        border-radius: var(--radius-sm);
        font-family: 'Poppins', sans-serif;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        border: none;
        cursor: pointer;
        margin-left: 1rem;
    }
    
    .preview-btn:hover {
        background-color: #3182ce;
        border-color: #3182ce;
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
        color: var(--text-light);
    }

    /* Section Types Modal */
    .section-types-modal {
        display: none;
        position: fixed;
        z-index: 1001;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
    }
    
    .section-types-modal-content {
        background-color: var(--ui-surface);
        margin: 5% auto;
        padding: 0;
        border-radius: var(--radius-md);
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        font-family: 'Poppins', sans-serif;
    }
    
    .section-types-modal-header {
        background: var(--feedback-info);
        color: var(--text-light);
        padding: 1.5rem;
        border-radius: var(--radius-md) var(--radius-md) 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .section-types-modal-title {
        margin: 0;
        font-size: 1.25rem;
        font-weight: 600;
        font-family: 'Poppins', sans-serif;
    }
    
    .section-types-modal-close {
        background: none;
        border: none;
        color: var(--text-light);
        font-size: 1.5rem;
        cursor: pointer;
        padding: 0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: background-color 0.3s ease;
    }
    
    .section-types-modal-close:hover {
        background-color: rgba(255, 255, 255, 0.2);
    }
    
    .section-types-modal-body {
        padding: 2rem;
    }
    
    .section-types-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .section-types-list li {
        background: var(--ui-hover);
        border: 1px solid var(--ui-border);
        border-radius: var(--radius-sm);
        padding: 1rem;
        margin-bottom: 1rem;
        transition: all 0.3s ease;
        font-family: 'Poppins', sans-serif;
    }
    
    .section-types-list li:hover {
        background: var(--ui-surface);
        border-color: var(--primary-color);
        transform: translateY(-2px);
        box-shadow: var(--shadow-sm);
    }
    
    .section-type-name {
        font-weight: 600;
        color: var(--primary-color);
        font-size: 1rem;
        margin-bottom: 0.5rem;
        font-family: 'Poppins', sans-serif;
    }
    
    .section-type-description {
        color: var(--text-secondary);
        font-size: 0.875rem;
        line-height: 1.5;
        font-family: 'Poppins', sans-serif;
    }

    /* Order Guide Modal */
    .order-guide-modal {
        display: none;
        position: fixed;
        z-index: 1002;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
    }
    
    .order-guide-modal-content {
        background-color: var(--ui-surface);
        margin: 5% auto;
        padding: 0;
        border-radius: var(--radius-md);
        width: 90%;
        max-width: 700px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        font-family: 'Poppins', sans-serif;
    }
    
    .order-guide-modal-header {
        background: var(--feedback-warning);
        color: var(--text-light);
        padding: 1.5rem;
        border-radius: var(--radius-md) var(--radius-md) 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .order-guide-modal-title {
        margin: 0;
        font-size: 1.25rem;
        font-weight: 600;
        font-family: 'Poppins', sans-serif;
    }
    
    .order-guide-modal-close {
        background: none;
        border: none;
        color: var(--text-light);
        font-size: 1.5rem;
        cursor: pointer;
        padding: 0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: background-color 0.3s ease;
    }
    
    .order-guide-modal-close:hover {
        background-color: rgba(255, 255, 255, 0.2);
    }
    
    .order-guide-modal-body {
        padding: 2rem;
    }
    
    .order-guide-info {
        background: var(--ui-hover);
        border: 1px solid var(--ui-border);
        border-radius: var(--radius-sm);
        padding: 1rem;
        margin-bottom: 1.5rem;
        font-family: 'Poppins', sans-serif;
    }
    
    .order-guide-info h4 {
        color: var(--text-primary);
        font-weight: 600;
        margin-bottom: 0.5rem;
        font-family: 'Poppins', sans-serif;
    }
    
    .order-guide-info p {
        color: var(--text-secondary);
        font-size: 0.875rem;
        line-height: 1.5;
        margin: 0;
        font-family: 'Poppins', sans-serif;
    }
    
    .order-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .order-list li {
        background: var(--ui-surface);
        border: 1px solid var(--ui-border);
        border-radius: var(--radius-sm);
        padding: 1rem;
        margin-bottom: 0.75rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        transition: all 0.3s ease;
        font-family: 'Poppins', sans-serif;
    }
    
    .order-list li:hover {
        background: var(--ui-hover);
        border-color: var(--primary-color);
        transform: translateY(-1px);
        box-shadow: var(--shadow-sm);
    }
    
    .order-number {
        background: var(--primary-color);
        color: var(--text-light);
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.875rem;
        font-family: 'Poppins', sans-serif;
        flex-shrink: 0;
    }
    
    .order-section-info {
        flex: 1;
    }
    
    .order-section-title {
        font-weight: 600;
        color: var(--text-primary);
        font-size: 1rem;
        margin-bottom: 0.25rem;
        font-family: 'Poppins', sans-serif;
    }
    
    .order-section-type {
        color: var(--text-secondary);
        font-size: 0.875rem;
        font-family: 'Poppins', sans-serif;
    }
    
    .no-sections {
        text-align: center;
        padding: 2rem;
        color: var(--text-secondary);
        font-family: 'Poppins', sans-serif;
    }
    
    .no-sections i {
        font-size: 2rem;
        margin-bottom: 1rem;
        color: var(--text-muted);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .container-fluid {
            padding: 1rem;
        }
        
        .directory-header {
            padding: 1.5rem;
        }
        
        .directory-title {
            font-size: 1.5rem;
        }
        
        .form-actions {
            flex-direction: column;
        }
        
        .form-actions .btn {
            width: 100%;
            justify-content: center;
        }
        
        .preview-modal-content {
            width: 95%;
            margin: 5% auto;
        }
        
        .preview-modal-body {
            padding: 1rem;
        }
        
        .preview-title {
            font-size: 1.5rem;
        }
        
        /* Stack columns on mobile */
        .row .col-md-6 {
            margin-bottom: 1rem;
        }
        
        /* Section types modal on mobile */
        .section-types-modal-content {
            width: 95%;
            margin: 10% auto;
        }
        
        .section-types-modal-body {
            padding: 1rem;
        }
        
        /* Order guide modal on mobile */
        .order-guide-modal-content {
            width: 95%;
            margin: 10% auto;
        }
        
        .order-guide-modal-body {
            padding: 1rem;
        }
        
        .order-list li {
            flex-direction: column;
            align-items: flex-start;
            gap: 0.5rem;
        }
        
        .order-number {
            align-self: flex-start;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header Section -->
    <div class="directory-header">
        <h1 class="directory-title">{% if object %}Edit{% else %}Create{% endif %} Page Section</h1>
        <p class="directory-subtitle">{% if object %}Update the page section{% else %}Add a new content section for your website{% endif %}</p>
    </div>

    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'core:admin_dashboard' %}">Admin</a></li>
            <li class="breadcrumb-item"><a href="{% url 'cms:dashboard' %}">CMS Dashboard</a></li>
            <li class="breadcrumb-item"><a href="{% url 'cms:page_section_list' %}">Page Sections</a></li>
            <li class="breadcrumb-item active" aria-current="page">{% if object %}Edit{% else %}Create{% endif %} Page Section</li>
        </ol>
    </nav>

    <!-- Form Card -->
    <div class="form-card">
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <!-- Basic Information Section -->
            <div class="section-header">
                <h4><i class="fas fa-info-circle" style="color: var(--primary-color); margin-right: 0.5rem;"></i> Basic Information</h4>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="{{ form.title.id_for_label }}">Section Title</label>
                        <input type="text" name="title" class="form-control" id="{{ form.title.id_for_label }}" placeholder="Enter section title" required>
                        {% if form.title.errors %}
                            <div class="text-danger">{{ form.title.errors.0 }}</div>
                        {% endif %}
                        <small class="form-text">The main title for this section</small>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="{{ form.section_type.id_for_label }}">Section Type</label>
                        <select name="section_type" class="form-control" id="{{ form.section_type.id_for_label }}" required>
                            <option value="">Select section type</option>
                            <option value="hero">Hero Section</option>
                            <option value="features">Features Section</option>
                            <option value="testimonials">Testimonials Section</option>
                            <option value="cta">Call to Action Section</option>
                            <option value="announcements">Announcements Section</option>
                            <option value="stats">Statistics Section</option>
                        </select>
                        {% if form.section_type.errors %}
                            <div class="text-danger">{{ form.section_type.errors.0 }}</div>
                        {% endif %}
                        <small class="form-text">Choose the type of content section you want to create</small>
                        {{ form.section_type.help_text|safe }}
                    </div>
                </div>
            </div>
            
            
            <!-- Content Section -->
            <div class="section-header">
                <h4><i class="fas fa-edit" style="color: var(--primary-color); margin-right: 0.5rem;"></i> Content</h4>
            </div>
            
            <div class="form-group">
                <label for="{{ form.subtitle.id_for_label }}">Subtitle</label>
                {{ form.subtitle }}
                {% if form.subtitle.errors %}
                    <div class="text-danger">{{ form.subtitle.errors.0 }}</div>
                {% endif %}
                <small class="form-text">Optional subtitle or description</small>
            </div>
            
            <div class="form-group">
                <label for="{{ form.content.id_for_label }}">Content</label>
                {{ form.content }}
                {% if form.content.errors %}
                    <div class="text-danger">{{ form.content.errors.0 }}</div>
                {% endif %}
                <small class="form-text">Main content for this section</small>
            </div>
            
            <!-- Settings Section -->
            <div class="section-header">
                <h4><i class="fas fa-cog" style="color: var(--primary-color); margin-right: 0.5rem;"></i> Settings</h4>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="{{ form.order.id_for_label }}">Display Order</label>
                        {{ form.order }}
                        {% if form.order.errors %}
                            <div class="text-danger">{{ form.order.errors.0 }}</div>
                        {% endif %}
                        <small class="form-text">Lower numbers appear first</small>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <div class="form-check">
                            {{ form.is_active }}
                            <label class="form-check-label" for="{{ form.is_active.id_for_label }}">
                                Active
                            </label>
                        </div>
                        {% if form.is_active.errors %}
                            <div class="text-danger">{{ form.is_active.errors.0 }}</div>
                        {% endif %}
                        <small class="form-text">Only active sections will be displayed</small>
                    </div>
                </div>
            </div>
            
            <!-- Form Actions -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> {% if object %}Update{% else %}Create{% endif %} Section
                </button>
                <button type="button" class="preview-btn" onclick="openPreviewModal()">
                    <i class="fas fa-eye"></i> Preview Section
                </button>
                <a href="{% url 'cms:page_section_list' %}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to List
                </a>
            </div>
        </form>
    </div>
</div>

<!-- Preview Modal -->
<div id="previewModal" class="preview-modal">
    <div class="preview-modal-content">
        <div class="preview-modal-header">
            <h3 class="preview-modal-title">Section Preview</h3>
            <button class="preview-modal-close" onclick="closePreviewModal()">&times;</button>
        </div>
        <div class="preview-modal-body">
            <div id="previewSection" class="preview-section">
                <div class="preview-title" id="previewTitle">Section Title</div>
                <div class="preview-subtitle" id="previewSubtitle">Section subtitle or description</div>
                <div class="preview-content" id="previewContent">Section content will appear here...</div>
            </div>
        </div>
    </div>
</div>

<!-- Section Types Modal -->
<div id="sectionTypesModal" class="section-types-modal">
    <div class="section-types-modal-content">
        <div class="section-types-modal-header">
            <h3 class="section-types-modal-title">Section Types Guide</h3>
            <button class="section-types-modal-close" onclick="closeSectionTypesModal()">&times;</button>
        </div>
        <div class="section-types-modal-body">
            <ul class="section-types-list">
                <li>
                    <div class="section-type-name">Hero Section</div>
                    <div class="section-type-description">Main banner area at the top of pages with large title and call-to-action. Perfect for introducing your organization and key messaging.</div>
                </li>
                <li>
                    <div class="section-type-name">Features Section</div>
                    <div class="section-type-description">Showcase key features or services with icons and descriptions. Great for highlighting what makes your organization unique.</div>
                </li>
                <li>
                    <div class="section-type-name">Testimonials Section</div>
                    <div class="section-type-description">Display customer reviews and testimonials. Build trust and credibility with real feedback from your community.</div>
                </li>
                <li>
                    <div class="section-type-name">Call to Action Section</div>
                    <div class="section-type-description">Prominent section encouraging user action (sign up, contact, donate, etc.). Drive engagement and conversions.</div>
                </li>
                <li>
                    <div class="section-type-name">Announcements Section</div>
                    <div class="section-type-description">Display important news, updates, or announcements. Keep your community informed about latest developments.</div>
                </li>
                <li>
                    <div class="section-type-name">Statistics Section</div>
                    <div class="section-type-description">Show key numbers, metrics, or achievements. Demonstrate your impact with compelling data and statistics.</div>
                </li>
            </ul>
        </div>
    </div>
</div>

<!-- Order Guide Modal -->
<div id="orderGuideModal" class="order-guide-modal">
    <div class="order-guide-modal-content">
        <div class="order-guide-modal-header">
            <h3 class="order-guide-modal-title">Current Section Order</h3>
            <button class="order-guide-modal-close" onclick="closeOrderGuideModal()">&times;</button>
        </div>
        <div class="order-guide-modal-body">
            <div class="order-guide-info">
                <h4><i class="fas fa-info-circle" style="color: var(--primary-color); margin-right: 0.5rem;"></i> How Display Order Works</h4>
                <p>Sections are displayed in ascending order (1, 2, 3, etc.). Lower numbers appear first on your website. Choose an order number that fits where you want your new section to appear.</p>
            </div>
            
            {% if existing_sections %}
                <ul class="order-list">
                    {% for section in existing_sections %}
                    <li>
                        <div class="order-number">{{ section.order }}</div>
                        <div class="order-section-info">
                            <div class="order-section-title">{{ section.title }}</div>
                            <div class="order-section-type">{{ section.get_section_type_display }}</div>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            {% else %}
                <div class="no-sections">
                    <i class="fas fa-layer-group"></i>
                    <h4>No Active Sections Found</h4>
                    <p>There are currently no active sections. Your new section will be the first one displayed.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function openPreviewModal() {
    // Get form values
    const title = document.getElementById('{{ form.title.id_for_label }}').value || 'Section Title';
    const subtitle = document.getElementById('{{ form.subtitle.id_for_label }}').value || 'Section subtitle or description';
    const content = document.getElementById('{{ form.content.id_for_label }}').value || 'Section content will appear here...';
    const sectionType = document.getElementById('{{ form.section_type.id_for_label }}').value || 'hero';
    
    // Update preview content
    document.getElementById('previewTitle').textContent = title;
    document.getElementById('previewSubtitle').textContent = subtitle;
    document.getElementById('previewContent').textContent = content;
    
    // Update preview section styling based on type
    const previewSection = document.getElementById('previewSection');
    previewSection.className = 'preview-section ' + sectionType;
    
    // Show modal
    document.getElementById('previewModal').style.display = 'block';
}

function closePreviewModal() {
    document.getElementById('previewModal').style.display = 'none';
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('previewModal');
    if (event.target === modal) {
        closePreviewModal();
    }
}

// Close modal with Escape key
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closePreviewModal();
    }
});

// Auto-update preview when form fields change
document.addEventListener('DOMContentLoaded', function() {
    const titleField = document.getElementById('{{ form.title.id_for_label }}');
    const subtitleField = document.getElementById('{{ form.subtitle.id_for_label }}');
    const contentField = document.getElementById('{{ form.content.id_for_label }}');
    const sectionTypeField = document.getElementById('{{ form.section_type.id_for_label }}');
    
    if (titleField) titleField.addEventListener('input', updatePreview);
    if (subtitleField) subtitleField.addEventListener('input', updatePreview);
    if (contentField) contentField.addEventListener('input', updatePreview);
    if (sectionTypeField) sectionTypeField.addEventListener('change', updatePreview);
});

function updatePreview() {
    // Only update if modal is open
    if (document.getElementById('previewModal').style.display === 'block') {
        openPreviewModal();
    }
}

// Section Types Modal Functions
function openSectionTypesModal() {
    document.getElementById('sectionTypesModal').style.display = 'block';
}

function closeSectionTypesModal() {
    document.getElementById('sectionTypesModal').style.display = 'none';
}

// Close section types modal when clicking outside
window.onclick = function(event) {
    const previewModal = document.getElementById('previewModal');
    const sectionTypesModal = document.getElementById('sectionTypesModal');
    const orderGuideModal = document.getElementById('orderGuideModal');
    
    if (event.target === previewModal) {
        closePreviewModal();
    }
    
    if (event.target === sectionTypesModal) {
        closeSectionTypesModal();
    }
    
    if (event.target === orderGuideModal) {
        closeOrderGuideModal();
    }
}

// Order Guide Modal Functions
function openOrderGuideModal() {
    document.getElementById('orderGuideModal').style.display = 'block';
}

function closeOrderGuideModal() {
    document.getElementById('orderGuideModal').style.display = 'none';
}

// Close section types modal with Escape key
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closePreviewModal();
        closeSectionTypesModal();
        closeOrderGuideModal();
    }
});
</script>
{% endblock %}