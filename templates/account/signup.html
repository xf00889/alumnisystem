{% load i18n %}
{% load account %}
{% load crispy_forms_tags %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication - NORSU Alumni Network</title>
    
    <!-- Google Fonts - Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        /* NORSU Alumni System Variables */
        :root {
            --primary-color: #2b3c6b;
            --primary-dark: #1a2544;
            --secondary-color: #4a5568;
            --ui-background: #f7fafc;
            --ui-surface: #ffffff;
            --ui-border: #e2e8f0;
            --ui-hover: #edf2f7;
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --text-muted: #a0aec0;
            --text-light: #ffffff;
            --feedback-success: #48bb78;
            --feedback-warning: #ed8936;
            --feedback-error: #e53e3e;
            --feedback-info: #4299e1;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            --radius-sm: 0.25rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --font-primary: 'Poppins', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background: linear-gradient(rgba(43, 60, 107, 0.8), rgba(26, 37, 68, 0.9)),
                        url('{% static "images/bg.jpg" %}') no-repeat center center;
            background-size: cover;
            background-attachment: fixed;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Main Container */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .auth-wrapper {
            background: var(--ui-surface);
            border-radius: 1rem;
            /* Enhanced multi-layered shadow for depth and professional appearance */
            box-shadow:
                0 25px 50px -12px rgba(43, 60, 107, 0.25),
                0 20px 25px -5px rgba(43, 60, 107, 0.1),
                0 10px 10px -5px rgba(43, 60, 107, 0.04),
                0 4px 6px -2px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            width: 100%;
            max-width: 850px; /* Reduced from 1000px for better proportions */
            min-height: 600px;
            display: flex;
            position: relative;
        }

        /* Left Panel - Branding */
        .auth-brand-panel {
            flex: 0 0 45%;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%),
                        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><defs><pattern id="campus-pattern" x="0" y="0" width="200" height="200" patternUnits="userSpaceOnUse"><circle cx="100" cy="100" r="3" fill="%23ffffff" opacity="0.1"/><circle cx="50" cy="50" r="2" fill="%23ffffff" opacity="0.05"/><circle cx="150" cy="150" r="2" fill="%23ffffff" opacity="0.05"/></pattern></defs><rect width="1000" height="1000" fill="url(%23campus-pattern)"/></svg>') repeat;
            background-size: cover, 200px 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 3rem 2rem;
            color: var(--text-light);
            position: relative;
        }

        .auth-brand-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, 
                rgba(43, 60, 107, 0.2) 0%, 
                rgba(26, 37, 68, 0.3) 50%,
                rgba(43, 60, 107, 0.2) 100%);
            pointer-events: none;
        }

        .brand-content {
            position: relative;
            z-index: 1;
            text-align: center;
        }

        .brand-logo {
            width: 120px;
            height: 120px;
            margin-bottom: 2rem;
            filter: brightness(1.1) drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }

        .brand-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .brand-subtitle {
            font-size: 1.125rem;
            opacity: 0.9;
            line-height: 1.6;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* Right Panel - Forms */
        .auth-form-panel {
            flex: 1;
            padding: 2.5rem 2rem; /* Reduced padding for more compact layout */
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Back to Home Button */
        .back-to-home {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: transparent;
            border: 2px solid rgba(43, 60, 107, 0.2);
            color: var(--primary-color);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .back-to-home:hover {
            background: rgba(43, 60, 107, 0.1);
            border-color: var(--primary-color);
            color: var(--primary-dark);
            transform: translateY(-1px);
        }

        .back-to-home:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(43, 60, 107, 0.25);
        }

        /* Tab Navigation */
        .auth-tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--ui-border);
            margin-top: 2rem;
        }

        .auth-tab {
            flex: 1;
            padding: 1rem;
            background: none;
            border: none;
            font-family: var(--font-primary);
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .auth-tab.active {
            color: var(--primary-color);
        }

        .auth-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary-color);
            border-radius: 1px;
        }

        .auth-tab:hover:not(.active) {
            color: var(--text-primary);
        }

        /* Form Content */
        .auth-form-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .form-container {
            display: none;
        }

        .form-container.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Form Field Styling */
        .form-group {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .password-field {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            transition: all 0.2s ease;
            z-index: 2;
        }

        .password-toggle:hover {
            color: var(--primary-color);
            background: rgba(43, 60, 107, 0.1);
        }

        .password-toggle:focus {
            outline: none;
            color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(43, 60, 107, 0.2);
        }

        .form-input.has-toggle {
            padding-right: 2.5rem;
        }

        /* Password Criteria Styles */
        .password-criteria {
            margin-top: 0.75rem;
            padding: 1rem;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            transition: all 0.3s ease;
            display: block;
            visibility: visible;
        }

        .criteria-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .criteria-title {
            font-weight: 600;
            color: var(--text-primary);
        }

        .strength-indicator {
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .strength-indicator.weak {
            background: #fed7d7;
            color: #c53030;
        }

        .strength-indicator.fair {
            background: #fef5e7;
            color: #dd6b20;
        }

        .strength-indicator.good {
            background: #c6f6d5;
            color: #2f855a;
        }

        .strength-indicator.strong {
            background: #9ae6b4;
            color: #22543d;
        }

        .criteria-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .criterion {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .criterion i {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 0.75rem;
            transition: all 0.3s ease;
        }

        .criterion i.fa-times-circle {
            color: #e53e3e;
            background: #fed7d7;
        }

        .criterion i.fa-check-circle {
            color: #2f855a;
            background: #c6f6d5;
        }

        .criterion span {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .criterion.valid span {
            color: var(--text-primary);
            font-weight: 500;
        }

        /* Password Match Indicator */
        .password-match-indicator {
            margin-top: 0.75rem;
            padding: 0.75rem;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            transition: all 0.3s ease;
            display: block;
            visibility: visible;
        }

        .match-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .match-status i {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 0.75rem;
            transition: all 0.3s ease;
        }

        .match-status i.fa-times-circle {
            color: #e53e3e;
            background: #fed7d7;
        }

        .match-status i.fa-check-circle {
            color: #2f855a;
            background: #c6f6d5;
        }

        .match-status span {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .match-status.valid span {
            color: var(--text-primary);
            font-weight: 500;
        }

        /* Animation for criteria updates */
        .criterion.valid {
            animation: criteriaSuccess 0.5s ease;
        }

        @keyframes criteriaSuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .form-input {
            width: 100%;
            padding: 1rem 0.75rem 0.5rem;
            border: 2px solid var(--ui-border);
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-family: var(--font-primary);
            background: var(--ui-surface);
            transition: all 0.3s ease;
            outline: none;
        }

        .form-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(43, 60, 107, 0.1);
        }

        .form-input:focus + .form-label,
        .form-input:not(:placeholder-shown) + .form-label,
        .form-input.has-value + .form-label {
            transform: translateY(-1.75rem) scale(0.8);
            color: var(--primary-color);
            background: var(--ui-surface);
            padding: 0 0.25rem;
            border-radius: 2px;
            font-weight: 600;
        }

        .form-label {
            position: absolute;
            left: 0.75rem;
            top: 1rem;
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 500;
            pointer-events: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: left top;
            z-index: 1;
        }

        .form-input:focus + .form-label {
            color: var(--primary-color);
        }

        /* Enhanced label visibility for better contrast */
        .form-input:focus + .form-label,
        .form-input:not(:placeholder-shown) + .form-label,
        .form-input.has-value + .form-label {
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
        }

        /* Button Styling */
        .btn-auth {
            width: 100%;
            padding: 0.875rem;
            border: none;
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-weight: 600;
            font-family: var(--font-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .btn-auth-primary {
            background: var(--primary-color);
            color: var(--text-light);
        }

        .btn-auth-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* Links */
        .auth-links {
            text-align: center;
            margin-top: 1.5rem;
        }

        .auth-links a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .auth-links a:hover {
            color: var(--primary-dark);
        }

        /* Custom SweetAlert2 Styling */
        .terms-popup {
            font-family: var(--font-primary) !important;
        }
        
        .terms-title {
            color: var(--primary-color) !important;
            font-weight: 600 !important;
        }
        
        .terms-content {
            font-size: 14px !important;
        }
        
        .terms-content h5 {
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 8px;
        }
        
        .terms-content h6 {
            font-weight: 600;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .auth-wrapper {
                flex-direction: column;
                max-width: 500px;
                min-height: auto;
                /* Adjusted shadow for mobile */
                box-shadow:
                    0 20px 40px -12px rgba(43, 60, 107, 0.2),
                    0 15px 20px -5px rgba(43, 60, 107, 0.08),
                    0 8px 8px -5px rgba(43, 60, 107, 0.03);
            }
            
            .auth-brand-panel {
                flex: 0 0 auto;
                padding: 2rem;
                min-height: 200px;
            }
            
            .brand-logo {
                width: 80px;
                height: 80px;
                margin-bottom: 1rem;
            }
            
            .brand-title {
                font-size: 1.5rem;
            }
            
            .brand-subtitle {
                font-size: 1rem;
            }
            
            .auth-form-panel {
                padding: 2rem 1.5rem;
            }
            
            .back-to-home {
                position: static;
                margin-bottom: 1rem;
                width: 100%;
                justify-content: center;
            }
            
            .auth-tabs {
                margin-top: 0;
            }
        }

        @media (max-width: 576px) {
            .auth-container {
                padding: 1rem;
            }
            
            .auth-form-panel {
                padding: 1.5rem 1rem;
            }
            
            /* Mobile password criteria adjustments */
            .password-criteria {
                padding: 0.75rem;
                font-size: 0.8rem;
            }
            
            .criteria-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .criteria-title {
                font-size: 0.8rem;
            }
            
            .strength-indicator {
                font-size: 0.7rem;
                padding: 0.2rem 0.4rem;
            }
            
            .criterion span {
                font-size: 0.75rem;
            }
            
            .password-match-indicator {
                padding: 0.5rem;
                font-size: 0.8rem;
            }
            
            .match-status span {
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="auth-container">
        <div class="auth-wrapper">
            <!-- Left Panel - Branding -->
            <div class="auth-brand-panel">
                <div class="brand-content">
                    <img src="{% static 'images/logo_norsu.png' %}" alt="NORSU Logo" class="brand-logo">
                    <h1 class="brand-title">NORSU Alumni Network</h1>
                    <p class="brand-subtitle">Connect with fellow alumni, stay updated with university news, and explore career opportunities in our growing community.</p>
                </div>
            </div>

            <!-- Right Panel - Forms -->
            <div class="auth-form-panel">
                <!-- Back to Home Button -->
                <a href="{% url 'core:home' %}" class="back-to-home" aria-label="Return to home page">
                    <i class="fas fa-home" aria-hidden="true"></i>
                    <span>Back to Home</span>
                </a>

                <!-- Tab Navigation -->
                <div class="auth-tabs">
                    <button class="auth-tab" onclick="switchTab('login')" id="loginTab">
                        <i class="fas fa-sign-in-alt me-2"></i>Login
                    </button>
                    <button class="auth-tab active" onclick="switchTab('signup')" id="signupTab">
                        <i class="fas fa-user-plus me-2"></i>Sign Up
                    </button>
                </div>

                <!-- Form Content -->
                <div class="auth-form-content">
                    <!-- Login Form -->
                    <div class="form-container" id="loginForm">
                        <form class="login" method="POST" action="{% url 'account_login' %}">
                            {% csrf_token %}

                            <div class="form-group">
                                <input type="text" class="form-input" name="login" placeholder=" " required>
                                <label class="form-label">Email or Username</label>
                            </div>

                            <div class="form-group">
                                <input type="password" class="form-input" name="password" placeholder=" " required>
                                <label class="form-label">Password</label>
                            </div>

                            <button class="btn-auth btn-auth-primary" type="submit">
                                <i class="fas fa-sign-in-alt me-2"></i>{% trans "Sign In" %}
                            </button>
                        </form>

                        <div class="auth-links">
                            <p><a href="{% url 'account_reset_password' %}">Forgot Password?</a></p>
                        </div>
                    </div>

                    <!-- Sign Up Form -->
                    <div class="form-container active" id="signupForm">
                        <form class="signup" method="POST" action="{% url 'account_signup' %}">
                            {% csrf_token %}

                            <div class="form-group">
                                <input type="text" class="form-input" name="first_name" placeholder=" " required>
                                <label class="form-label">First Name</label>
                            </div>

                            <div class="form-group">
                                <input type="text" class="form-input" name="last_name" placeholder=" " required>
                                <label class="form-label">Last Name</label>
                            </div>

                            <div class="form-group">
                                <input type="email" class="form-input" name="email" placeholder=" " required>
                                <label class="form-label">Email Address</label>
                            </div>

                            <div class="form-group password-field">
                                <input type="password" class="form-input has-toggle" name="password1" placeholder=" " required id="signupPassword1" oninput="validatePassword()">
                                <label class="form-label">Password</label>
                                <button type="button" class="password-toggle" onclick="togglePassword('signupPassword1', this)" aria-label="Toggle password visibility">
                                    <i class="fas fa-eye" aria-hidden="true"></i>
                                </button>
                                
                                <!-- Password Criteria Indicator -->
                                <div class="password-criteria" id="passwordCriteria">
                                    <div class="criteria-header">
                                        <span class="criteria-title">Password Requirements:</span>
                                        <span class="strength-indicator" id="strengthIndicator">Weak</span>
                                    </div>
                                    <div class="criteria-list">
                                        <div class="criterion" id="lengthCriterion">
                                            <i class="fas fa-times-circle"></i>
                                            <span>At least 8 characters</span>
                                        </div>
                                        <div class="criterion" id="uppercaseCriterion">
                                            <i class="fas fa-times-circle"></i>
                                            <span>One uppercase letter</span>
                                        </div>
                                        <div class="criterion" id="lowercaseCriterion">
                                            <i class="fas fa-times-circle"></i>
                                            <span>One lowercase letter</span>
                                        </div>
                                        <div class="criterion" id="numberCriterion">
                                            <i class="fas fa-times-circle"></i>
                                            <span>One number</span>
                                        </div>
                                        <div class="criterion" id="specialCriterion">
                                            <i class="fas fa-times-circle"></i>
                                            <span>One special character (!@#$%^&*)</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group password-field">
                                <input type="password" class="form-input has-toggle" name="password2" placeholder=" " required id="signupPassword2" oninput="validatePasswordMatch()">
                                <label class="form-label">Confirm Password</label>
                                <button type="button" class="password-toggle" onclick="togglePassword('signupPassword2', this)" aria-label="Toggle password visibility">
                                    <i class="fas fa-eye" aria-hidden="true"></i>
                                </button>
                                
                                <!-- Password Match Indicator -->
                                <div class="password-match-indicator" id="passwordMatchIndicator">
                                    <div class="match-status" id="matchStatus">
                                        <i class="fas fa-times-circle"></i>
                                        <span>Passwords must match</span>
                                    </div>
                                </div>
                            </div>

                            <button class="btn-auth btn-auth-primary" type="button" onclick="showTermsDisclaimer()">
                                <i class="fas fa-user-plus me-2"></i>{% trans "Create Account" %}
                                <small class="d-block mt-1" style="font-size: 0.75rem; opacity: 0.8;">* Terms & Conditions apply</small>
                            </button>
                        </form>

                        <div class="auth-links">
                            <p style="background: #f8fafc; padding: 10px; border-radius: 6px; border-left: 3px solid #2b3c6b; margin: 0;">
                                <small style="color: #4a5568; font-weight: 500;">
                                    <i class="fas fa-info-circle me-1" style="color: #2b3c6b;"></i>
                                    By creating an account, you agree to our Terms of Service and Privacy Policy.
                                </small>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        function switchTab(tabName) {
            // Remove active class from all tabs and forms
            document.querySelectorAll('.auth-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.form-container').forEach(form => form.classList.remove('active'));

            // Add active class to selected tab and form
            document.getElementById(tabName + 'Tab').classList.add('active');
            document.getElementById(tabName + 'Form').classList.add('active');

            // Update URL without page reload for better UX
            if (tabName === 'login') {
                window.history.replaceState(null, null, '{% url "account_login" %}');
            } else {
                window.history.replaceState(null, null, '{% url "account_signup" %}');
            }
        }

        function togglePassword(inputId, button) {
            const input = document.getElementById(inputId);
            const icon = button.querySelector('i');

            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
                button.setAttribute('aria-label', 'Hide password');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
                button.setAttribute('aria-label', 'Show password');
            }
        }

        // Password validation functions
        function validatePassword() {
            const password = document.getElementById('signupPassword1').value;
            const criteria = {
                length: password.length >= 8,
                uppercase: /[A-Z]/.test(password),
                lowercase: /[a-z]/.test(password),
                number: /[0-9]/.test(password),
                special: /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)
            };

            // Update individual criteria
            updateCriterion('lengthCriterion', criteria.length);
            updateCriterion('uppercaseCriterion', criteria.uppercase);
            updateCriterion('lowercaseCriterion', criteria.lowercase);
            updateCriterion('numberCriterion', criteria.number);
            updateCriterion('specialCriterion', criteria.special);

            // Calculate and update strength indicator
            const validCriteria = Object.values(criteria).filter(Boolean).length;
            updateStrengthIndicator(validCriteria);

            // Also validate password match if confirm password has value
            if (document.getElementById('signupPassword2').value) {
                validatePasswordMatch();
            }
        }

        function updateCriterion(criterionId, isValid) {
            const criterion = document.getElementById(criterionId);
            const icon = criterion.querySelector('i');
            
            if (isValid) {
                criterion.classList.add('valid');
                icon.classList.remove('fa-times-circle');
                icon.classList.add('fa-check-circle');
            } else {
                criterion.classList.remove('valid');
                icon.classList.remove('fa-check-circle');
                icon.classList.add('fa-times-circle');
            }
        }

        function updateStrengthIndicator(validCriteria) {
            const indicator = document.getElementById('strengthIndicator');
            
            // Remove all strength classes
            indicator.classList.remove('weak', 'fair', 'good', 'strong');
            
            if (validCriteria < 2) {
                indicator.textContent = 'Weak';
                indicator.classList.add('weak');
            } else if (validCriteria < 3) {
                indicator.textContent = 'Fair';
                indicator.classList.add('fair');
            } else if (validCriteria < 5) {
                indicator.textContent = 'Good';
                indicator.classList.add('good');
            } else {
                indicator.textContent = 'Strong';
                indicator.classList.add('strong');
            }
        }

        function validatePasswordMatch() {
            const password1 = document.getElementById('signupPassword1').value;
            const password2 = document.getElementById('signupPassword2').value;
            const matchStatus = document.getElementById('matchStatus');
            const icon = matchStatus.querySelector('i');
            const text = matchStatus.querySelector('span');

            if (password2.length === 0) {
                matchStatus.classList.remove('valid');
                icon.classList.remove('fa-check-circle');
                icon.classList.add('fa-times-circle');
                text.textContent = 'Passwords must match';
                return false;
            }

            if (password1 === password2) {
                matchStatus.classList.add('valid');
                icon.classList.remove('fa-times-circle');
                icon.classList.add('fa-check-circle');
                text.textContent = 'Passwords match';
                return true;
            } else {
                matchStatus.classList.remove('valid');
                icon.classList.remove('fa-check-circle');
                icon.classList.add('fa-times-circle');
                text.textContent = 'Passwords do not match';
                return false;
            }
        }

        // Enhanced form validation before submission
        function validateForm() {
            const password1 = document.getElementById('signupPassword1').value;
            const password2 = document.getElementById('signupPassword2').value;
            
            // Check password criteria
            const criteria = {
                length: password1.length >= 8,
                uppercase: /[A-Z]/.test(password1),
                lowercase: /[a-z]/.test(password1),
                number: /[0-9]/.test(password1),
                special: /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password1)
            };
            
            const validCriteria = Object.values(criteria).filter(Boolean).length;
            const passwordsMatch = password1 === password2;
            
            if (validCriteria < 3) {
                Swal.fire({
                    title: 'Password Too Weak',
                    text: 'Please ensure your password meets at least 3 of the 5 criteria listed below.',
                    icon: 'warning',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#2b3c6b'
                });
                return false;
            }
            
            if (!passwordsMatch) {
                Swal.fire({
                    title: 'Passwords Do Not Match',
                    text: 'Please ensure both password fields contain the same password.',
                    icon: 'error',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#2b3c6b'
                });
                return false;
            }
            
            return true;
        }

        // Handle form input animations and label positioning
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize password criteria visibility
            const passwordCriteria = document.getElementById('passwordCriteria');
            const passwordMatchIndicator = document.getElementById('passwordMatchIndicator');
            
            if (passwordCriteria) {
                passwordCriteria.style.display = 'block';
                passwordCriteria.style.visibility = 'visible';
            }
            
            if (passwordMatchIndicator) {
                passwordMatchIndicator.style.display = 'block';
                passwordMatchIndicator.style.visibility = 'visible';
            }
            
            // More comprehensive error detection
            const hasErrors = document.querySelector('.alert-danger, .errorlist, .form-error, [class*="error"]');
            const hasFormErrors = document.querySelector('.form-group .error, .form-group .invalid-feedback');
            const hasDjangoErrors = document.querySelector('.errorlist li, .nonfield .errorlist');
            const hasMessages = document.querySelector('.messages .alert-danger, .messages .alert-error');
            const hasUrlErrors = window.location.search.includes('error') || window.location.search.includes('invalid');
            
            // Debug logging
            console.log('Signup - Error detection:', {
                hasErrors: !!hasErrors,
                hasFormErrors: !!hasFormErrors,
                hasDjangoErrors: !!hasDjangoErrors,
                hasMessages: !!hasMessages,
                hasUrlErrors: hasUrlErrors,
                currentUrl: window.location.href,
                sessionStorage: sessionStorage.getItem('norsu_terms_agreed')
            });
            
            // Debug password criteria elements
            console.log('Password criteria elements:', {
                passwordCriteria: !!passwordCriteria,
                passwordMatchIndicator: !!passwordMatchIndicator,
                passwordCriteriaDisplay: passwordCriteria ? passwordCriteria.style.display : 'not found',
                passwordMatchDisplay: passwordMatchIndicator ? passwordMatchIndicator.style.display : 'not found'
            });
            
            // SMART APPROACH: Only clear session storage if there are authentication errors
            // This preserves the user's terms agreement on normal page visits
            const hasAgreedToTerms = sessionStorage.getItem('norsu_terms_agreed');
            
            // Check for authentication errors
            const hasAuthErrors = hasErrors || hasFormErrors || hasDjangoErrors || hasMessages || hasUrlErrors;
            
            if (hasAuthErrors) {
                console.log('Signup - Authentication errors detected, clearing session storage');
                sessionStorage.removeItem('norsu_terms_agreed');
            } else if (hasAgreedToTerms) {
                console.log('Signup - No errors detected, preserving terms agreement');
            } else {
                console.log('Signup - No previous agreement, will show terms disclaimer');
            }
            
            // Show terms disclaimer automatically when page loads (only if no previous agreement)
            const finalHasAgreedToTerms = sessionStorage.getItem('norsu_terms_agreed');
            if (!finalHasAgreedToTerms) {
                showTermsDisclaimer();
            }
            
            const inputs = document.querySelectorAll('.form-input');

            inputs.forEach(input => {
                // Check if input has value on page load
                if (input.value) {
                    input.classList.add('has-value');
                }

                // Handle input events for better label animation
                input.addEventListener('input', function() {
                    if (this.value) {
                        this.classList.add('has-value');
                    } else {
                        this.classList.remove('has-value');
                    }
                });

                input.addEventListener('blur', function() {
                    if (this.value) {
                        this.classList.add('has-value');
                    } else {
                        this.classList.remove('has-value');
                    }
                });

                // Handle focus for immediate label animation
                input.addEventListener('focus', function() {
                    this.classList.add('has-value');
                });

                // Remove has-value on blur if no content
                input.addEventListener('blur', function() {
                    if (!this.value) {
                        this.classList.remove('has-value');
                    }
                });
            });
        });

        // Terms and Conditions Disclaimer
        function showTermsDisclaimer() {
            // Validate form before showing terms
            if (!validateForm()) {
                return;
            }
            
            // Check if user has already agreed to terms in this session
            const hasAgreedToTerms = sessionStorage.getItem('norsu_terms_agreed');
            
            if (hasAgreedToTerms) {
                console.log('Signup - User already agreed to terms, submitting form directly');
                // User already agreed, submit the form directly
                document.querySelector('#signupForm form').submit();
                return;
            }
            
            console.log('Signup - Showing full terms disclaimer');
            
            Swal.fire({
                title: '<strong>Terms and Conditions</strong>',
                html: `
                    <div style="text-align: left; max-height: 450px; overflow-y: auto; padding: 15px; font-family: 'Poppins', sans-serif;">
                        <div style="text-align: center; margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); border-radius: 8px; border-left: 4px solid #2b3c6b;">
                            <h5 style="color: #2b3c6b; margin: 0; font-weight: 600; font-size: 18px;">📋 NORSU Alumni Network</h5>
                            <p style="margin: 5px 0 0 0; color: #4a5568; font-size: 14px;">Terms of Service & Privacy Agreement</p>
                        </div>
                        
                        <div style="background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #e2e8f0;">
                            <h6 style="color: #2b3c6b; margin: 0 0 10px 0; font-weight: 600; font-size: 15px;">🔐 Account Registration</h6>
                            <p style="margin: 0; font-size: 13px; line-height: 1.5; color: #4a5568;">By creating an account, you agree to provide accurate and complete information. You are responsible for maintaining the confidentiality of your account credentials and all activities that occur under your account.</p>
                        </div>
                        
                        <div style="background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #e2e8f0;">
                            <h6 style="color: #2b3c6b; margin: 0 0 10px 0; font-weight: 600; font-size: 15px;">🛡️ Privacy and Data Protection</h6>
                            <p style="margin: 0; font-size: 13px; line-height: 1.5; color: #4a5568;">We collect and process your personal information in accordance with our Privacy Policy. Your data will be used to facilitate alumni connections, share university updates, and provide career opportunities. We never sell your personal information to third parties.</p>
                        </div>
                        
                        <div style="background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #e2e8f0;">
                            <h6 style="color: #2b3c6b; margin: 0 0 10px 0; font-weight: 600; font-size: 15px;">🤝 Community Guidelines</h6>
                            <p style="margin: 0; font-size: 13px; line-height: 1.5; color: #4a5568;">Users must maintain respectful communication, avoid spam or inappropriate content, and respect the intellectual property rights of others. We foster a positive, professional environment for all alumni.</p>
                        </div>
                        
                        <div style="background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #e2e8f0;">
                            <h6 style="color: #2b3c6b; margin: 0 0 10px 0; font-weight: 600; font-size: 15px;">🎯 Platform Usage</h6>
                            <p style="margin: 0; font-size: 13px; line-height: 1.5; color: #4a5568;">This platform is intended for NORSU alumni networking, career development, and university-related activities. Commercial use requires prior approval from the administration.</p>
                        </div>
                        
                        <div style="background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #e2e8f0;">
                            <h6 style="color: #2b3c6b; margin: 0 0 10px 0; font-weight: 600; font-size: 15px;">📄 Content and Intellectual Property</h6>
                            <p style="margin: 0; font-size: 13px; line-height: 1.5; color: #4a5568;">Users retain ownership of their content but grant NORSU Alumni Network a license to use, display, and distribute content within the platform for networking and educational purposes.</p>
                        </div>
                        
                        <div style="background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #e2e8f0;">
                            <h6 style="color: #2b3c6b; margin: 0 0 10px 0; font-weight: 600; font-size: 15px;">⚖️ Limitation of Liability</h6>
                            <p style="margin: 0; font-size: 13px; line-height: 1.5; color: #4a5568;">NORSU Alumni Network is provided "as is" without warranties. We are not liable for any damages arising from platform use, but we strive to maintain a secure and reliable service.</p>
                        </div>
                        
                        <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #2b3c6b 0%, #1a2544 100%); border-radius: 8px; color: white;">
                            <p style="margin: 0; font-size: 13px; font-weight: 500;"><strong>✅ By clicking "I Agree", you acknowledge that you have read, understood, and agree to be bound by these Terms and Conditions.</strong></p>
                        </div>
                    </div>
                `,
                width: '650px',
                showCancelButton: true,
                confirmButtonText: '<i class="fas fa-check-circle"></i> I Agree & Create Account',
                cancelButtonText: '<i class="fas fa-times-circle"></i> Cancel',
                confirmButtonColor: '#2b3c6b',
                cancelButtonColor: '#718096',
                reverseButtons: true,
                allowOutsideClick: false,
                allowEscapeKey: false,
                focusConfirm: true,
                customClass: {
                    popup: 'terms-popup',
                    title: 'terms-title',
                    htmlContainer: 'terms-content'
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    // User agreed to terms, store agreement in session storage
                    sessionStorage.setItem('norsu_terms_agreed', 'true');
                    // Submit the form
                    document.querySelector('#signupForm form').submit();
                } else {
                    // User declined, redirect to landing page
                    Swal.fire({
                        title: 'Registration Cancelled',
                        text: 'You must agree to the Terms and Conditions to create an account.',
                        icon: 'info',
                        confirmButtonText: 'OK',
                        confirmButtonColor: '#2b3c6b'
                    }).then(() => {
                        window.location.href = '/';
                    });
                }
            });
        }
    </script>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
