{% load i18n %}
{% load account %}
{% load crispy_forms_tags %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication - NORSU Alumni Network - EYE ICONS REMOVED</title>
    
    <!-- Google Fonts - Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        /* NORSU Alumni System Variables */
        :root {
            --primary-color: #2b3c6b;
            --primary-dark: #1a2544;
            --secondary-color: #4a5568;
            --ui-background: #f7fafc;
            --ui-surface: #ffffff;
            --ui-border: #e2e8f0;
            --ui-hover: #edf2f7;
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --text-muted: #a0aec0;
            --text-light: #ffffff;
            --feedback-success: #48bb78;
            --feedback-warning: #ed8936;
            --feedback-error: #e53e3e;
            --feedback-info: #4299e1;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            --radius-sm: 0.25rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --font-primary: 'Poppins', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background: linear-gradient(rgba(43, 60, 107, 0.8), rgba(26, 37, 68, 0.9)),
                        url('{% static "images/bg.jpg" %}') no-repeat center center;
            background-size: cover;
            background-attachment: fixed;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Main Container */
        .auth-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .auth-wrapper {
            background: var(--ui-surface);
            border-radius: 0.75rem;
            /* Enhanced multi-layered shadow for depth and professional appearance */
            box-shadow:
                0 25px 50px -12px rgba(43, 60, 107, 0.25),
                0 20px 25px -5px rgba(43, 60, 107, 0.1),
                0 10px 10px -5px rgba(43, 60, 107, 0.04),
                0 4px 6px -2px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            width: 100%;
            max-width: 800px;
            min-height: 500px;
            display: flex;
            position: relative;
        }

        /* Left Panel - Branding */
        .auth-brand-panel {
            flex: 0 0 40%;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%),
                        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><defs><pattern id="campus-pattern" x="0" y="0" width="200" height="200" patternUnits="userSpaceOnUse"><circle cx="100" cy="100" r="3" fill="%23ffffff" opacity="0.1"/><circle cx="50" cy="50" r="2" fill="%23ffffff" opacity="0.05"/><circle cx="150" cy="150" r="2" fill="%23ffffff" opacity="0.05"/></pattern></defs><rect width="1000" height="1000" fill="url(%23campus-pattern)"/></svg>') repeat;
            background-size: cover, 200px 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem 1.5rem;
            color: var(--text-light);
            position: relative;
        }

        .auth-brand-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, 
                rgba(43, 60, 107, 0.2) 0%, 
                rgba(26, 37, 68, 0.3) 50%,
                rgba(43, 60, 107, 0.2) 100%);
            pointer-events: none;
        }

        .brand-content {
            position: relative;
            z-index: 1;
            text-align: center;
        }

        .brand-logo {
            width: 80px;
            height: 80px;
            margin-bottom: 1rem;
            filter: brightness(1.1) drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }

        .brand-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .brand-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            line-height: 1.5;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* Right Panel - Forms */
        .auth-form-panel {
            flex: 1;
            padding: 1.5rem 1.5rem;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Back to Home Button */
        /* Back to Home Button Container */
        .back-to-home-container {
            display: flex;
            justify-content: center;
            margin-top: 2rem;
            width: 100%;
        }

        .back-to-home {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--ui-surface);
            border: 1px solid var(--ui-border);
            color: var(--primary-color);
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-sm);
        }

        .back-to-home:hover {
            background: var(--ui-surface);
            border-color: var(--primary-color);
            color: var(--primary-dark);
            transform: none;
            box-shadow: var(--shadow-sm);
        }

        .back-to-home:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(43, 60, 107, 0.25);
        }

        /* Tab Navigation */
        .auth-tabs {
            display: flex;
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--ui-border);
            margin-top: 1rem;
        }

        .auth-tab {
            flex: 1;
            padding: 0.75rem;
            background: none;
            border: none;
            font-family: var(--font-primary);
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .auth-tab.active {
            color: var(--primary-color);
        }

        .auth-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary-color);
            border-radius: 1px;
        }

        .auth-tab:hover:not(.active) {
            color: var(--text-primary);
        }

        /* Form Content */
        .auth-form-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .form-container {
            display: none;
        }

        .form-container.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Form Field Styling */
        .form-group {
            position: relative;
            margin-bottom: 1rem;
        }
        

        .password-field {
            position: relative;
            overflow: visible;
        }


        /* Show Password Checkbox Styles */
        .show-password-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            padding: 0.5rem;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-md);
            font-size: 0.875rem;
        }

        .show-password-checkbox {
            width: 18px;
            height: 18px;
            accent-color: var(--primary-color);
            cursor: pointer;
        }

        .show-password-label {
            color: var(--text-secondary);
            cursor: pointer;
            user-select: none;
            font-weight: 500;
        }

        /* Password Criteria Styles */
        .password-criteria {
            margin-top: 0.5rem;
            padding: 0.75rem;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-md);
            font-size: 0.75rem;
            font-style: italic;
            transition: all 0.3s ease;
            display: block;
            visibility: visible;
        }

        .criteria-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            padding-bottom: 0.25rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .criteria-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.75rem;
            font-style: italic;
        }

        .strength-indicator {
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .strength-indicator.weak {
            background: #fed7d7;
            color: #c53030;
        }

        .strength-indicator.fair {
            background: #fef5e7;
            color: #dd6b20;
        }

        .strength-indicator.good {
            background: #c6f6d5;
            color: #2f855a;
        }

        .strength-indicator.strong {
            background: #9ae6b4;
            color: #22543d;
        }

        .criteria-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .criterion {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .criterion i {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 0.75rem;
            transition: all 0.3s ease;
        }

        .criterion i.fa-times-circle {
            color: #e53e3e;
            background: #fed7d7;
        }

        .criterion i.fa-check-circle {
            color: #2f855a;
            background: #c6f6d5;
        }

        .criterion span {
            color: var(--text-secondary);
            font-size: 0.75rem;
            font-style: italic;
        }

        .criterion.valid span {
            color: var(--text-primary);
            font-weight: 500;
        }

        /* Password Match Indicator */
        .password-match-indicator {
            margin-top: 0.5rem;
            padding: 0.5rem;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            transition: all 0.3s ease;
            display: block;
            visibility: visible;
        }

        .match-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .match-status i {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 0.75rem;
            transition: all 0.3s ease;
        }

        .match-status i.fa-times-circle {
            color: #e53e3e;
            background: #fed7d7;
        }

        .match-status i.fa-check-circle {
            color: #2f855a;
            background: #c6f6d5;
        }

        .match-status span {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .match-status.valid span {
            color: var(--text-primary);
            font-weight: 500;
        }

        /* Animation for criteria updates */
        .criterion.valid {
            animation: criteriaSuccess 0.5s ease;
        }

        @keyframes criteriaSuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .form-input {
            width: 100%;
            padding: 1rem 0.75rem 0.5rem;
            border: 2px solid var(--ui-border);
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-family: var(--font-primary);
            background: var(--ui-surface);
            transition: all 0.3s ease;
            outline: none;
            box-sizing: border-box;
        }

        .form-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(43, 60, 107, 0.1);
        }

        .form-input:focus + .form-label,
        .form-input:not(:placeholder-shown) + .form-label,
        .form-input.has-value + .form-label {
            transform: translateY(-1.75rem) scale(0.8);
            color: var(--primary-color);
            background: var(--ui-surface);
            padding: 0 0.25rem;
            border-radius: 2px;
            font-weight: 600;
        }

        .form-label {
            position: absolute;
            left: 0.75rem;
            top: 1rem;
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 500;
            pointer-events: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: left top;
            z-index: 1;
        }

        .form-input:focus + .form-label {
            color: var(--primary-color);
        }

        /* Enhanced label visibility for better contrast */
        .form-input:focus + .form-label,
        .form-input:not(:placeholder-shown) + .form-label,
        .form-input.has-value + .form-label {
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
        }

        /* Button Styling */
        .btn-auth {
            width: 100%;
            padding: 0.875rem;
            border: none;
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-weight: 600;
            font-family: var(--font-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 0.75rem;
        }

        .btn-auth-primary {
            background: var(--primary-color);
            color: var(--text-light);
        }

        .btn-auth-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* Links */
        .auth-links {
            text-align: center;
            margin-top: 1rem;
        }

        .auth-links a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .auth-links a:hover {
            color: var(--primary-dark);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .auth-wrapper {
                flex-direction: column;
                max-width: 500px;
                min-height: auto;
                /* Adjusted shadow for mobile */
                box-shadow:
                    0 20px 40px -12px rgba(43, 60, 107, 0.2),
                    0 15px 20px -5px rgba(43, 60, 107, 0.08),
                    0 8px 8px -5px rgba(43, 60, 107, 0.03);
            }
            
            .auth-brand-panel {
                flex: 0 0 auto;
                padding: 2rem;
                min-height: 200px;
            }
            
            .brand-logo {
                width: 80px;
                height: 80px;
                margin-bottom: 1rem;
            }
            
            .brand-title {
                font-size: 1.5rem;
            }
            
            .brand-subtitle {
                font-size: 1rem;
            }
            
            .auth-form-panel {
                padding: 1.5rem 1rem;
            }
            
            
            .auth-tabs {
                margin-top: 0;
            }
        }

        @media (max-width: 576px) {
            .auth-container {
                padding: 1rem;
            }
            
            .auth-form-panel {
                padding: 1rem 0.75rem;
            }
            
            /* Mobile show password adjustments */
            .show-password-container {
                padding: 0.5rem;
                font-size: 0.8rem;
            }
            
            /* Mobile back to home button */
            .back-to-home-container {
                margin-top: 1rem;
            }
            
            .back-to-home {
                padding: 0.5rem 1rem;
                font-size: 0.8rem;
            }
        }

        /* Custom SweetAlert2 Styling for Terms Popup */
        .terms-popup {
            font-family: 'Poppins', sans-serif !important;
        }

        .terms-title {
            color: #2b3c6b !important;
            font-weight: 600 !important;
        }

        .terms-content {
            font-family: 'Poppins', sans-serif !important;
        }

        @media (max-width: 768px) {
            .swal2-popup.terms-popup {
                width: 95% !important;
                max-width: 500px !important;
            }
        }
    </style>
</head>
<body>
    <div class="auth-container">
        <div class="auth-wrapper">
            <!-- Left Panel - Branding -->
            <div class="auth-brand-panel">
                <div class="brand-content">
                    <img src="{% static 'images/logo_norsu.png' %}" alt="NORSU Logo" class="brand-logo">
                    <h1 class="brand-title">NORSU Alumni Network</h1>
                    <p class="brand-subtitle">Connect with fellow alumni, stay updated with university news, and explore career opportunities in our growing community.</p>
                </div>
            </div>

            <!-- Right Panel - Forms -->
            <div class="auth-form-panel">
                <!-- Tab Navigation -->
                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="switchTab('login')" id="loginTab">
                        <i class="fas fa-sign-in-alt me-2"></i>Login
                    </button>
                    <button class="auth-tab" onclick="switchTab('signup')" id="signupTab">
                        <i class="fas fa-user-plus me-2"></i>Sign Up
                    </button>
                </div>

                <!-- Form Content -->
                <div class="auth-form-content">
                    <!-- Login Form -->
                    <div class="form-container active" id="loginForm">
                        <form class="login" method="POST" action="{% url 'account_login' %}">
                            {% csrf_token %}

                            {% if form.errors %}
                            <div class="alert alert-danger" role="alert">
                                {% for field in form %}
                                    {% for error in field.errors %}
                                        <div>{{ field.label }}: {{ error }}</div>
                                    {% endfor %}
                                {% endfor %}
                                {% for error in form.non_field_errors %}
                                    <div>{{ error }}</div>
                                {% endfor %}
                            </div>
                            {% endif %}

                            <div class="form-group">
                                <input type="text" class="form-input" name="login" placeholder=" " required>
                                <label class="form-label">Email or Username</label>
                            </div>

                            <div class="form-group password-field">
                                <input type="password" class="form-input" name="password" placeholder=" " required id="loginPassword">
                                <label class="form-label">Password</label>
                            </div>

                            <!-- Show Password Checkbox -->
                            <div class="show-password-container">
                                <input type="checkbox" id="showPasswordCheckbox" class="show-password-checkbox" onchange="togglePasswordVisibility()">
                                <label for="showPasswordCheckbox" class="show-password-label">
                                    <i class="fas fa-eye me-1"></i>Show Password
                                </label>
                            </div>

                            {% if redirect_field_value %}
                            <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
                            {% endif %}

                            <!-- reCAPTCHA Section -->
                            <div class="form-group">
                                <label class="form-label">Security Verification</label>
                                {{ form.captcha }}
                                <small class="form-text text-muted">
                                    <i class="fas fa-shield-alt"></i> This helps us prevent spam and protect your account
                                </small>
                                {% if form.captcha.errors %}
                                    <div class="text-danger small mt-1">
                                        {% for error in form.captcha.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <button class="btn-auth btn-auth-primary" type="submit">
                                <i class="fas fa-sign-in-alt me-2"></i>{% trans "Sign In" %}
                            </button>
                        </form>

                        {% if messages %}
                        <div class="mt-2">
                            {% for message in messages %}
                                <div class="alert alert-{{ message.tags|default:'info' }}" role="alert">{{ message }}</div>
                            {% endfor %}
                        </div>
                        {% endif %}

                        <div class="auth-links">
                            <p><a href="{% url 'account_reset_password' %}">Forgot Password?</a></p>
                        </div>
                    </div>

                    <!-- Signup Form -->
                    <div class="form-container" id="signupForm">
                        <form class="signup" method="POST" action="{% url 'accounts:enhanced_signup' %}">
                            {% csrf_token %}

                            <div class="form-group">
                                <input type="text" class="form-input" name="first_name" placeholder=" " required>
                                <label class="form-label">First Name</label>
                            </div>

                            <div class="form-group">
                                <input type="text" class="form-input" name="last_name" placeholder=" " required>
                                <label class="form-label">Last Name</label>
                            </div>

                            <div class="form-group">
                                <input type="email" class="form-input" name="email" placeholder=" " required>
                                <label class="form-label">Email Address</label>
                            </div>

                            <div class="form-group password-field">
                                <input type="password" class="form-input" name="password1" placeholder=" " required id="signupPassword1" oninput="validatePassword()">
                                <label class="form-label">Password</label>
                                
                                <!-- Password Criteria Indicator -->
                                <div class="password-criteria" id="passwordCriteria">
                                    <div class="criteria-header">
                                        <span class="criteria-title">Password Requirements:</span>
                                        <span class="strength-indicator" id="strengthIndicator">Weak</span>
                                    </div>
                                    <div class="criteria-list">
                                        <div class="criterion" id="lengthCriterion">
                                            <i class="fas fa-times-circle"></i>
                                            <span>At least 8 characters</span>
                                        </div>
                                        <div class="criterion" id="uppercaseCriterion">
                                            <i class="fas fa-times-circle"></i>
                                            <span>One uppercase letter</span>
                                        </div>
                                        <div class="criterion" id="lowercaseCriterion">
                                            <i class="fas fa-times-circle"></i>
                                            <span>One lowercase letter</span>
                                        </div>
                                        <div class="criterion" id="numberCriterion">
                                            <i class="fas fa-times-circle"></i>
                                            <span>One number</span>
                                        </div>
                                        <div class="criterion" id="specialCriterion">
                                            <i class="fas fa-times-circle"></i>
                                            <span>One special character (!@#$%^&*)</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group password-field">
                                <input type="password" class="form-input" name="password2" placeholder=" " required id="signupPassword2" oninput="validatePasswordMatch()">
                                <label class="form-label">Confirm Password</label>
                                
                                <!-- Password Match Indicator -->
                                <div class="password-match-indicator" id="passwordMatchIndicator">
                                    <div class="match-status" id="matchStatus">
                                        <i class="fas fa-times-circle"></i>
                                        <span>Passwords must match</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Show Password Checkbox for Signup -->
                            <div class="show-password-container">
                                <input type="checkbox" id="showSignupPasswordCheckbox" class="show-password-checkbox" onchange="toggleSignupPasswordVisibility()">
                                <label for="showSignupPasswordCheckbox" class="show-password-label">
                                    <i class="fas fa-eye me-1"></i>Show Passwords
                                </label>
                            </div>

                            <button class="btn-auth btn-auth-primary" type="submit">
                                <i class="fas fa-user-plus me-2"></i>{% trans "Create Account" %}
                            </button>
                        </form>

                        <div class="auth-links">
                            <p><small>By creating an account, you agree to our Terms of Service and Privacy Policy.</small></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Back to Home Button - Outside Container -->
        <div class="back-to-home-container">
            <a href="{% url 'core:home' %}" class="back-to-home" aria-label="Return to home page">
                <i class="fas fa-home" aria-hidden="true"></i>
                <span>Back to Home</span>
            </a>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        function switchTab(tabName) {
            // Remove active class from all tabs and forms
            document.querySelectorAll('.auth-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.form-container').forEach(form => form.classList.remove('active'));

            // Add active class to selected tab and form
            document.getElementById(tabName + 'Tab').classList.add('active');
            document.getElementById(tabName + 'Form').classList.add('active');
            
            // Initialize password criteria visibility when switching to signup tab
            if (tabName === 'signup') {
                const passwordCriteria = document.getElementById('passwordCriteria');
                const passwordMatchIndicator = document.getElementById('passwordMatchIndicator');
                
                if (passwordCriteria) {
                    passwordCriteria.style.display = 'block';
                    passwordCriteria.style.visibility = 'visible';
                }
                
                if (passwordMatchIndicator) {
                    passwordMatchIndicator.style.display = 'block';
                    passwordMatchIndicator.style.visibility = 'visible';
                }
            }
        }

        function togglePasswordVisibility() {
            const checkbox = document.getElementById('showPasswordCheckbox');
            const password = document.getElementById('loginPassword');
            const label = document.querySelector('.show-password-label i');

            if (checkbox.checked) {
                password.type = 'text';
                label.classList.remove('fa-eye');
                label.classList.add('fa-eye-slash');
            } else {
                password.type = 'password';
                label.classList.remove('fa-eye-slash');
                label.classList.add('fa-eye');
            }
        }

        function toggleSignupPasswordVisibility() {
            const checkbox = document.getElementById('showSignupPasswordCheckbox');
            const password1 = document.getElementById('signupPassword1');
            const password2 = document.getElementById('signupPassword2');
            const label = document.querySelector('#showSignupPasswordCheckbox + .show-password-label i');

            if (checkbox.checked) {
                password1.type = 'text';
                password2.type = 'text';
                label.classList.remove('fa-eye');
                label.classList.add('fa-eye-slash');
            } else {
                password1.type = 'password';
                password2.type = 'password';
                label.classList.remove('fa-eye-slash');
                label.classList.add('fa-eye');
            }
        }

        // Password validation functions
        function validatePassword() {
            const password = document.getElementById('signupPassword1').value;
            const criteria = {
                length: password.length >= 8,
                uppercase: /[A-Z]/.test(password),
                lowercase: /[a-z]/.test(password),
                number: /[0-9]/.test(password),
                special: /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)
            };

            // Update individual criteria
            updateCriterion('lengthCriterion', criteria.length);
            updateCriterion('uppercaseCriterion', criteria.uppercase);
            updateCriterion('lowercaseCriterion', criteria.lowercase);
            updateCriterion('numberCriterion', criteria.number);
            updateCriterion('specialCriterion', criteria.special);

            // Calculate and update strength indicator
            const validCriteria = Object.values(criteria).filter(Boolean).length;
            updateStrengthIndicator(validCriteria);

            // Also validate password match if confirm password has value
            if (document.getElementById('signupPassword2').value) {
                validatePasswordMatch();
            }
        }

        function updateCriterion(criterionId, isValid) {
            const criterion = document.getElementById(criterionId);
            const icon = criterion.querySelector('i');
            
            if (isValid) {
                criterion.classList.add('valid');
                icon.classList.remove('fa-times-circle');
                icon.classList.add('fa-check-circle');
            } else {
                criterion.classList.remove('valid');
                icon.classList.remove('fa-check-circle');
                icon.classList.add('fa-times-circle');
            }
        }

        function updateStrengthIndicator(validCriteria) {
            const indicator = document.getElementById('strengthIndicator');
            
            // Remove all strength classes
            indicator.classList.remove('weak', 'fair', 'good', 'strong');
            
            if (validCriteria < 2) {
                indicator.textContent = 'Weak';
                indicator.classList.add('weak');
            } else if (validCriteria < 3) {
                indicator.textContent = 'Fair';
                indicator.classList.add('fair');
            } else if (validCriteria < 5) {
                indicator.textContent = 'Good';
                indicator.classList.add('good');
            } else {
                indicator.textContent = 'Strong';
                indicator.classList.add('strong');
            }
        }

        function validatePasswordMatch() {
            const password1 = document.getElementById('signupPassword1').value;
            const password2 = document.getElementById('signupPassword2').value;
            const matchStatus = document.getElementById('matchStatus');
            const icon = matchStatus.querySelector('i');
            const text = matchStatus.querySelector('span');

            if (password2.length === 0) {
                matchStatus.classList.remove('valid');
                icon.classList.remove('fa-check-circle');
                icon.classList.add('fa-times-circle');
                text.textContent = 'Passwords must match';
                return false;
            }

            if (password1 === password2) {
                matchStatus.classList.add('valid');
                icon.classList.remove('fa-times-circle');
                icon.classList.add('fa-check-circle');
                text.textContent = 'Passwords match';
                return true;
            } else {
                matchStatus.classList.remove('valid');
                icon.classList.remove('fa-check-circle');
                icon.classList.add('fa-times-circle');
                text.textContent = 'Passwords do not match';
                return false;
            }
        }

        // Handle form input animations and label positioning
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize password criteria visibility
            const passwordCriteria = document.getElementById('passwordCriteria');
            const passwordMatchIndicator = document.getElementById('passwordMatchIndicator');
            
            if (passwordCriteria) {
                passwordCriteria.style.display = 'block';
                passwordCriteria.style.visibility = 'visible';
            }
            
            if (passwordMatchIndicator) {
                passwordMatchIndicator.style.display = 'block';
                passwordMatchIndicator.style.visibility = 'visible';
            }
            
            // More comprehensive error detection
            const hasErrors = document.querySelector('.alert-danger, .errorlist, .form-error, [class*="error"]');
            const hasFormErrors = document.querySelector('.form-group .error, .form-group .invalid-feedback');
            const hasDjangoErrors = document.querySelector('.errorlist li, .nonfield .errorlist');
            const hasMessages = document.querySelector('.messages .alert-danger, .messages .alert-error');
            const hasUrlErrors = window.location.search.includes('error') || window.location.search.includes('invalid');
            
            // Debug logging
            console.log('Login - Error detection:', {
                hasErrors: !!hasErrors,
                hasFormErrors: !!hasFormErrors,
                hasDjangoErrors: !!hasDjangoErrors,
                hasMessages: !!hasMessages,
                hasUrlErrors: hasUrlErrors,
                currentUrl: window.location.href,
                sessionStorage: sessionStorage.getItem('norsu_terms_agreed')
            });
            
            // Debug password criteria elements
            console.log('Password criteria elements:', {
                passwordCriteria: !!passwordCriteria,
                passwordMatchIndicator: !!passwordMatchIndicator,
                passwordCriteriaDisplay: passwordCriteria ? passwordCriteria.style.display : 'not found',
                passwordMatchDisplay: passwordMatchIndicator ? passwordMatchIndicator.style.display : 'not found'
            });
            
            // SMART APPROACH: Only clear session storage if there are authentication errors
            // This preserves the user's terms agreement on normal page visits
            const hasAgreedToTerms = sessionStorage.getItem('norsu_terms_agreed');
            
            // Check for authentication errors
            const hasAuthErrors = hasErrors || hasFormErrors || hasDjangoErrors || hasMessages || hasUrlErrors;
            
            if (hasAuthErrors) {
                console.log('Login - Authentication errors detected, clearing session storage');
                sessionStorage.removeItem('norsu_terms_agreed');
            } else if (hasAgreedToTerms) {
                console.log('Login - No errors detected, preserving terms agreement');
            } else {
                console.log('Login - No previous agreement, will show terms disclaimer');
            }
            
            // Show disclaimer automatically when page loads (only if no previous agreement)
            const finalHasAgreedToTerms = sessionStorage.getItem('norsu_terms_agreed');
            if (!finalHasAgreedToTerms) {
                showTermsDisclaimer();
            }
            
            const inputs = document.querySelectorAll('.form-input');

            inputs.forEach(input => {
                // Check if input has value on page load
                if (input.value) {
                    input.classList.add('has-value');
                }

                // Handle input events for better label animation
                input.addEventListener('input', function() {
                    if (this.value) {
                        this.classList.add('has-value');
                    } else {
                        this.classList.remove('has-value');
                    }
                });

                input.addEventListener('blur', function() {
                    if (this.value) {
                        this.classList.add('has-value');
                    } else {
                        this.classList.remove('has-value');
                    }
                });

                // Handle focus for immediate label animation
                input.addEventListener('focus', function() {
                    this.classList.add('has-value');
                });

                // Remove has-value on blur if no content
                input.addEventListener('blur', function() {
                    if (!this.value) {
                        this.classList.remove('has-value');
                    }
                });
            });
        });

        // Terms and Conditions Disclaimer
        function showTermsDisclaimer() {
            // Check if user has already agreed to terms in this session
            const hasAgreedToTerms = sessionStorage.getItem('norsu_terms_agreed');
            
            if (hasAgreedToTerms) {
                console.log('Login - User already agreed to terms, showing welcome message');
                // User already agreed, just show a confirmation message
                Swal.fire({
                    icon: 'success',
                    title: 'Welcome Back!',
                    text: 'You have already agreed to our Terms and Conditions.',
                    confirmButtonText: 'Continue',
                    confirmButtonColor: '#2b3c6b',
                    timer: 2000,
                    showConfirmButton: true
                });
                return;
            }
            
            console.log('Login - Showing full terms disclaimer');
            
            Swal.fire({
                title: '<strong>Terms and Conditions</strong>',
                html: `
                    <div style="text-align: left; max-height: 450px; overflow-y: auto; padding: 15px; font-family: 'Poppins', sans-serif;">
                        <div style="text-align: center; margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); border-radius: 8px; border-left: 4px solid #2b3c6b;">
                            <h5 style="color: #2b3c6b; margin: 0; font-weight: 600; font-size: 18px;">üìã NORSU Alumni Network</h5>
                            <p style="margin: 5px 0 0 0; color: #4a5568; font-size: 14px;">Terms of Service & Privacy Agreement</p>
                        </div>
                        
                        <div style="background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #e2e8f0;">
                            <h6 style="color: #2b3c6b; margin: 0 0 10px 0; font-weight: 600; font-size: 15px;">üîê Account Registration</h6>
                            <p style="margin: 0; font-size: 13px; line-height: 1.5; color: #4a5568;">By creating an account, you agree to provide accurate and complete information. You are responsible for maintaining the confidentiality of your account credentials and all activities that occur under your account.</p>
                        </div>
                        
                        <div style="background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #e2e8f0;">
                            <h6 style="color: #2b3c6b; margin: 0 0 10px 0; font-weight: 600; font-size: 15px;">üõ°Ô∏è Privacy and Data Protection</h6>
                            <p style="margin: 0; font-size: 13px; line-height: 1.5; color: #4a5568;">We collect and process your personal information in accordance with our Privacy Policy. Your data will be used to facilitate alumni connections, share university updates, and provide career opportunities. We never sell your personal information to third parties.</p>
                        </div>
                        
                        <div style="background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #e2e8f0;">
                            <h6 style="color: #2b3c6b; margin: 0 0 10px 0; font-weight: 600; font-size: 15px;">ü§ù Community Guidelines</h6>
                            <p style="margin: 0; font-size: 13px; line-height: 1.5; color: #4a5568;">Users must maintain respectful communication, avoid spam or inappropriate content, and respect the intellectual property rights of others. We foster a positive, professional environment for all alumni.</p>
                        </div>
                        
                        <div style="background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #e2e8f0;">
                            <h6 style="color: #2b3c6b; margin: 0 0 10px 0; font-weight: 600; font-size: 15px;">üéØ Platform Usage</h6>
                            <p style="margin: 0; font-size: 13px; line-height: 1.5; color: #4a5568;">This platform is intended for NORSU alumni networking, career development, and university-related activities. Commercial use requires prior approval from the administration.</p>
                        </div>
                        
                        <div style="background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #e2e8f0;">
                            <h6 style="color: #2b3c6b; margin: 0 0 10px 0; font-weight: 600; font-size: 15px;">üìÑ Content and Intellectual Property</h6>
                            <p style="margin: 0; font-size: 13px; line-height: 1.5; color: #4a5568;">Users retain ownership of their content but grant NORSU Alumni Network a license to use, display, and distribute content within the platform for networking and educational purposes.</p>
                        </div>
                        
                        <div style="background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #e2e8f0;">
                            <h6 style="color: #2b3c6b; margin: 0 0 10px 0; font-weight: 600; font-size: 15px;">‚öñÔ∏è Limitation of Liability</h6>
                            <p style="margin: 0; font-size: 13px; line-height: 1.5; color: #4a5568;">NORSU Alumni Network is provided "as is" without warranties. We are not liable for any damages arising from platform use, but we strive to maintain a secure and reliable service.</p>
                        </div>
                        
                        <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #2b3c6b 0%, #1a2544 100%); border-radius: 8px; color: white;">
                            <p style="margin: 0; font-size: 13px; font-weight: 500;"><strong>‚úÖ By clicking "I Agree", you acknowledge that you have read, understood, and agree to be bound by these Terms and Conditions.</strong></p>
                        </div>
                    </div>
                `,
                width: '650px',
                showCancelButton: true,
                confirmButtonText: '<i class="fas fa-check-circle"></i> I Agree & Continue',
                cancelButtonText: '<i class="fas fa-times-circle"></i> Cancel',
                confirmButtonColor: '#2b3c6b',
                cancelButtonColor: '#718096',
                reverseButtons: true,
                allowOutsideClick: false,
                allowEscapeKey: false,
                focusConfirm: true,
                customClass: {
                    popup: 'terms-popup',
                    title: 'terms-title',
                    htmlContainer: 'terms-content'
                }
            }).then((result) => {
                 if (result.isConfirmed) {
                     // User agreed to terms, store agreement in session storage
                     sessionStorage.setItem('norsu_terms_agreed', 'true');
                     console.log('User agreed to terms and conditions');
                 } else {
                     // User declined, redirect to landing page
                     Swal.fire({
                         title: 'Access Denied',
                         text: 'You must agree to the Terms and Conditions to access the NORSU Alumni Network.',
                         icon: 'info',
                         confirmButtonText: 'OK',
                         confirmButtonColor: '#2b3c6b'
                     }).then(() => {
                         window.location.href = '/';
                     });
                 }
             });
        }
    </script>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- reCAPTCHA callback functions -->
    <script>
        // reCAPTCHA callback functions - define globally
        window.onRecaptchaSuccess = function(token) {
            console.log('reCAPTCHA success:', token);
        };
        
        window.onRecaptchaExpired = function() {
            console.log('reCAPTCHA expired');
        };
        
        window.onRecaptchaError = function(error) {
            // Suppress undefined errors as they're harmless initialization issues
            if (error && error !== 'undefined' && error !== undefined) {
                console.warn('reCAPTCHA encountered an error:', error);
            }
            // Silently handle undefined errors - they don't affect functionality
        };
        
        // Also define as global functions for compatibility
        function onRecaptchaSuccess(token) {
            console.log('reCAPTCHA success:', token);
        }
        
        function onRecaptchaExpired() {
            console.log('reCAPTCHA expired');
        }
        
        function onRecaptchaError(error) {
            // Suppress undefined errors as they're harmless initialization issues
            if (error && error !== 'undefined' && error !== undefined) {
                console.warn('reCAPTCHA encountered an error:', error);
            }
            // Silently handle undefined errors - they don't affect functionality
        }
        
        // Load reCAPTCHA after DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Load reCAPTCHA script dynamically
            var script = document.createElement('script');
            script.src = 'https://www.google.com/recaptcha/api.js?render={{ recaptcha_public_key|default:"" }}';
            script.async = true;
            script.defer = true;
            document.head.appendChild(script);
        });
    </script>
</body>
</html>
