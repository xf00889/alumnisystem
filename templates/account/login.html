{% load i18n %}
{% load account %}
{% load socialaccount %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    
    <!-- SEO Meta Tags -->
    {% include 'components/seo/seo_meta_tags.html' %}
    
    <title>{{ seo.title|default:"Sign In - NORSU Alumni Network" }}</title>
    
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <!-- Notyf Toast Notifications -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css">
    
    {% if recaptcha_enabled %}
    <!-- Google reCAPTCHA v3 -->
    <script src="https://www.google.com/recaptcha/api.js?render={{ recaptcha_site_key }}"></script>
    {% endif %}
    
    <!-- reCAPTCHA Mobile Fix -->
    <link rel="stylesheet" href="{% static 'css/recaptcha-mobile-fix.css' %}">
    
    <style>
        /* Modern Premium Design System */
        :root {
            /* Colors */
            --primary: #2b3c6b;
            --primary-dark: #1a2544;
            --primary-light: #3d4f7f;
            --surface: #ffffff;
            --background: #f8f9fb;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --text-tertiary: #94a3b8;
            --border: #e2e8f0;
            --border-light: #f1f5f9;
            --success: #10b981;
            --error: #ef4444;
            --focus: rgba(43, 60, 107, 0.12);
            
            /* Spacing (8px system) */
            --space-1: 0.5rem;
            --space-2: 1rem;
            --space-3: 1.5rem;
            --space-4: 2rem;
            --space-5: 2.5rem;
            --space-6: 3rem;
            
            /* Border Radius */
            --radius-sm: 0.5rem;
            --radius-md: 1rem;
            --radius-lg: 1.25rem;
            --radius-xl: 1.5rem;
            --radius-full: 9999px;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-card: 0 0 0 1px rgba(0, 0, 0, 0.05), 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            
            /* Typography */
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background: linear-gradient(rgba(15, 23, 42, 0.92), rgba(10, 15, 30, 0.96)), 
                        url('{% static "images/bg.jpg" %}') no-repeat center center;
            background-size: cover;
            background-attachment: fixed;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-2);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .auth-container {
            width: 100%;
            max-width: 420px;
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Header Section */
        .auth-header {
            text-align: center;
            margin-bottom: var(--space-4);
        }

        .logo-container {
            position: relative;
            display: inline-block;
            margin-bottom: var(--space-3);
        }

        .logo-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, rgba(43, 60, 107, 0.4) 0%, transparent 70%);
            filter: blur(20px);
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
        }

        .logo {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: var(--radius-lg);
            object-fit: contain;
            background: var(--surface);
            padding: var(--space-1);
            box-shadow: var(--shadow-lg);
        }

        .auth-title {
            color: var(--surface);
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: var(--space-1);
            letter-spacing: -0.01em;
        }

        .auth-subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.875rem;
            font-weight: 400;
            line-height: 1.5;
        }

        /* Card */
        .auth-card {
            background: var(--surface);
            border-radius: var(--radius-xl);
            padding: var(--space-4);
            box-shadow: var(--shadow-card);
            backdrop-filter: blur(10px);
        }

        /* Tabs */
        .auth-tabs {
            display: flex;
            gap: var(--space-1);
            margin-bottom: var(--space-4);
            background: var(--background);
            padding: 0.25rem;
            border-radius: var(--radius-md);
        }

        .auth-tab {
            flex: 1;
            padding: var(--space-1) var(--space-2);
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            position: relative;
        }

        .auth-tab.active {
            background: var(--surface);
            color: var(--text-primary);
            font-weight: 600;
            /* Enhanced shadow with multiple layers for depth */
            box-shadow: 
                0 1px 2px rgba(0, 0, 0, 0.06),
                0 2px 4px rgba(0, 0, 0, 0.08),
                0 4px 8px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.8),
                inset 0 -1px 0 rgba(0, 0, 0, 0.05);
            /* Emboss effect with subtle gradient */
            background: linear-gradient(
                to bottom,
                rgba(255, 255, 255, 1) 0%,
                rgba(255, 255, 255, 0.98) 50%,
                rgba(248, 249, 251, 1) 100%
            );
            /* Slight elevation */
            transform: translateY(-1px);
        }

        .auth-tab:hover:not(.active) {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.5);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        /* Form Container */
        .form-container {
            display: none;
        }

        .form-container.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Form Groups */
        .form-group {
            position: relative;
            margin-bottom: var(--space-3);
        }

        .form-input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 1.5px solid var(--border);
            border-radius: var(--radius-md);
            font-size: 0.9375rem;
            font-weight: 400;
            color: var(--text-primary);
            background: var(--surface);
            transition: all 0.2s ease;
            outline: none;
        }

        .form-input::placeholder {
            color: var(--text-tertiary);
        }

        .form-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px var(--focus);
        }

        /* Password Field */
        .password-field {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-tertiary);
            cursor: pointer;
            padding: 0.5rem;
            transition: color 0.2s ease;
        }

        .password-toggle:hover {
            color: var(--text-secondary);
        }

        /* Checkbox */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: var(--space-1);
            margin-bottom: var(--space-3);
        }

        .checkbox-input {
            width: 1.125rem;
            height: 1.125rem;
            border: 1.5px solid var(--border);
            border-radius: 0.25rem;
            cursor: pointer;
            accent-color: var(--primary);
        }

        .checkbox-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            cursor: pointer;
            user-select: none;
        }

        /* Buttons */
        .btn-primary {
            width: 100%;
            padding: 0.875rem 1.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--surface);
            border: none;
            border-radius: var(--radius-md);
            font-size: 0.9375rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(43, 60, 107, 0.2);
            margin-bottom: var(--space-3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(43, 60, 107, 0.3);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-google {
            width: 100%;
            padding: 0.875rem 1.5rem;
            background: var(--surface);
            color: var(--text-primary);
            border: 1.5px solid var(--border);
            border-radius: var(--radius-md);
            font-size: 0.9375rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-1);
            text-decoration: none;
        }

        .btn-google:hover {
            background: var(--background);
            border-color: var(--text-tertiary);
            box-shadow: var(--shadow-sm);
        }

        /* Divider */
        .divider {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin: var(--space-3) 0;
        }

        .divider-line {
            flex: 1;
            height: 1px;
            background: var(--border-light);
        }

        .divider-text {
            color: var(--text-tertiary);
            font-size: 0.8125rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Links */
        .forgot-password {
            display: block;
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.875rem;
            text-decoration: none;
            margin-top: var(--space-2);
            transition: color 0.2s ease;
        }

        .forgot-password:hover {
            color: var(--primary);
        }

        .back-home {
            display: block;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.875rem;
            text-decoration: none;
            margin-top: var(--space-3);
            transition: color 0.2s ease;
        }

        .back-home:hover {
            color: rgba(255, 255, 255, 1);
        }

        /* Responsive */
        @media (max-width: 480px) {
            body {
                padding: var(--space-1);
            }

            .auth-card {
                padding: var(--space-3);
            }

            .logo {
                width: 64px;
                height: 64px;
            }

            .auth-title {
                font-size: 1rem;
            }

            .auth-subtitle {
                font-size: 0.8125rem;
            }

            .form-input,
            .btn-primary,
            .btn-google {
                font-size: 0.875rem;
            }
        }

        /* Loading State */
        .btn-primary:disabled,
        .btn-google:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Terms Link */
        .terms-link {
            text-align: center;
            margin-top: var(--space-2);
            font-size: 0.8125rem;
            color: var(--text-secondary);
        }

        .terms-link a {
            color: var(--primary);
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .terms-link a:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }

        /* Password Requirements */
        .password-requirements {
            margin-top: 0.75rem;
            padding: 0.875rem;
            background: var(--background);
            border: 1.5px solid var(--border);
            border-radius: var(--radius-md);
            font-size: 0.8125rem;
            display: none;
        }

        .password-requirements.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .password-requirements-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .requirement {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.375rem 0;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }

        .requirement-icon {
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.625rem;
            flex-shrink: 0;
            background: var(--border);
            color: var(--text-tertiary);
            transition: all 0.2s ease;
        }

        .requirement.met {
            color: var(--success);
        }

        .requirement.met .requirement-icon {
            background: var(--success);
            color: white;
        }

        .requirement.failed {
            color: var(--error);
        }

        .requirement.failed .requirement-icon {
            background: var(--error);
            color: white;
        }

        .password-strength {
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid var(--border);
        }

        .password-strength-label {
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 0.375rem;
            color: var(--text-secondary);
        }

        .password-strength-bar {
            height: 0.375rem;
            background: var(--border);
            border-radius: var(--radius-full);
            overflow: hidden;
            position: relative;
        }

        .password-strength-fill {
            height: 100%;
            width: 0%;
            transition: all 0.3s ease;
            border-radius: var(--radius-full);
        }

        .password-strength-fill.weak {
            width: 33%;
            background: var(--error);
        }

        .password-strength-fill.medium {
            width: 66%;
            background: var(--warning);
        }

        .password-strength-fill.strong {
            width: 100%;
            background: var(--success);
        }

        .password-strength-text {
            font-size: 0.75rem;
            margin-top: 0.25rem;
            font-weight: 500;
        }

        .password-strength-text.weak {
            color: var(--error);
        }

        .password-strength-text.medium {
            color: var(--warning);
        }

        .password-strength-text.strong {
            color: var(--success);
        }

        /* Alert Styling */
        .alert {
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            border: 1px solid;
        }
        
        .alert-error {
            background: #fee;
            border-color: #fcc;
            color: #c00;
        }
        
        .alert-success {
            background: #efe;
            border-color: #cfc;
            color: #0a0;
        }
        
        .alert-warning {
            background: #ffe;
            border-color: #fec;
            color: #c80;
        }
        
        .alert-info {
            background: #eef;
            border-color: #ccf;
            color: #00c;
        }
    </style>
</head>
<body>
    <div class="auth-container">
        <!-- Header -->
        <div class="auth-header">
            <div class="logo-container">
                <div class="logo-glow"></div>
                <img src="{% static 'images/alumni_logo.png' %}" alt="NORSU Alumni Logo" class="logo">
            </div>
            <h1 class="auth-title">NORSU Alumni Network</h1>
            <p class="auth-subtitle">Connect with fellow alumni and stay updated</p>
        </div>

        <!-- Card -->
        <div class="auth-card">
            <!-- Tabs -->
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchTab('login')" id="loginTab">
                    Login
                </button>
                <button class="auth-tab" onclick="switchTab('signup')" id="signupTab">
                    Sign Up
                </button>
            </div>

            <!-- Login Form -->
            <div class="form-container active" id="loginForm">
                <form method="POST" action="{% url 'account_login' %}" id="loginFormElement">
                    {% csrf_token %}
                    
                    <div class="form-group">
                        <input type="email" class="form-input" name="login" placeholder="Email Address" required id="loginEmail">
                    </div>

                    <div class="form-group password-field">
                        <input type="password" class="form-input" name="password" placeholder="Password" required id="loginPassword">
                        <button type="button" class="password-toggle" onclick="togglePassword('loginPassword', this)">
                            <i class="far fa-eye"></i>
                        </button>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" name="remember" id="rememberMe">
                        <label class="checkbox-label" for="rememberMe">Remember me</label>
                    </div>

                    {% if recaptcha_enabled %}
                    <!-- reCAPTCHA v3 Badge will appear here -->
                    <div class="g-recaptcha" 
                         data-sitekey="{{ recaptcha_site_key }}" 
                         data-callback="onLoginSubmit" 
                         data-action="login"
                         data-size="invisible"></div>
                    {% endif %}

                    <button type="submit" class="btn-primary" id="loginSubmitBtn">
                        Sign In
                    </button>

                    {% if 'google' in enabled_sso_providers %}
                    <div class="divider">
                        <div class="divider-line"></div>
                        <span class="divider-text">or</span>
                        <div class="divider-line"></div>
                    </div>

                    <a href="/accounts/google/login/" class="btn-google">
                        <svg width="18" height="18" viewBox="0 0 18 18">
                            <path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z"/>
                            <path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.184l-2.908-2.258c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332C2.438 15.983 5.482 18 9 18z"/>
                            <path fill="#FBBC05" d="M3.964 10.707c-.18-.54-.282-1.117-.282-1.707 0-.593.102-1.17.282-1.709V4.958H.957C.347 6.173 0 7.548 0 9c0 1.452.348 2.827.957 4.042l3.007-2.335z"/>
                            <path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.958L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z"/>
                        </svg>
                        Continue with Google
                    </a>
                    {% endif %}

                    <a href="{% url 'account_reset_password' %}" class="forgot-password">
                        Forgot your password?
                    </a>
                </form>
            </div>

            <!-- Signup Form -->
            <div class="form-container" id="signupForm">
                <form method="POST" action="{% url 'accounts:enhanced_signup' %}" id="signupFormElement">
                    {% csrf_token %}
                    
                    <div class="form-group">
                        <input type="text" class="form-input" name="first_name" placeholder="First Name" required id="signupFirstName">
                    </div>

                    <div class="form-group">
                        <input type="text" class="form-input" name="last_name" placeholder="Last Name" required id="signupLastName">
                    </div>

                    <div class="form-group">
                        <input type="email" class="form-input" name="email" placeholder="Email Address" required id="signupEmail">
                    </div>

                    <div class="form-group password-field">
                        <input type="password" class="form-input" name="password1" placeholder="Password" required id="signupPassword1">
                        <button type="button" class="password-toggle" onclick="togglePassword('signupPassword1', this)">
                            <i class="far fa-eye"></i>
                        </button>
                    </div>

                    <!-- Password Requirements -->
                    <div class="password-requirements" id="passwordRequirements">
                        <div class="password-requirements-title">Password Requirements:</div>
                        <div class="requirement" id="req-length">
                            <span class="requirement-icon">
                                <i class="fas fa-circle" style="font-size: 0.375rem;"></i>
                            </span>
                            <span>At least 8 characters</span>
                        </div>
                        <div class="requirement" id="req-uppercase">
                            <span class="requirement-icon">
                                <i class="fas fa-circle" style="font-size: 0.375rem;"></i>
                            </span>
                            <span>One uppercase letter (A-Z)</span>
                        </div>
                        <div class="requirement" id="req-lowercase">
                            <span class="requirement-icon">
                                <i class="fas fa-circle" style="font-size: 0.375rem;"></i>
                            </span>
                            <span>One lowercase letter (a-z)</span>
                        </div>
                        <div class="requirement" id="req-number">
                            <span class="requirement-icon">
                                <i class="fas fa-circle" style="font-size: 0.375rem;"></i>
                            </span>
                            <span>One number (0-9)</span>
                        </div>
                        <div class="requirement" id="req-special">
                            <span class="requirement-icon">
                                <i class="fas fa-circle" style="font-size: 0.375rem;"></i>
                            </span>
                            <span>One special character (!@#$%^&*)</span>
                        </div>
                        
                        <!-- Password Strength Indicator -->
                        <div class="password-strength">
                            <div class="password-strength-label">Password Strength:</div>
                            <div class="password-strength-bar">
                                <div class="password-strength-fill" id="strengthFill"></div>
                            </div>
                            <div class="password-strength-text" id="strengthText"></div>
                        </div>
                    </div>

                    <div class="form-group password-field">
                        <input type="password" class="form-input" name="password2" placeholder="Confirm Password" required id="signupPassword2">
                        <button type="button" class="password-toggle" onclick="togglePassword('signupPassword2', this)">
                            <i class="far fa-eye"></i>
                        </button>
                    </div>

                    {% if recaptcha_enabled %}
                    <!-- reCAPTCHA v3 Badge will appear here -->
                    <div class="g-recaptcha" 
                         data-sitekey="{{ recaptcha_site_key }}" 
                         data-callback="onSignupSubmit" 
                         data-action="signup"
                         data-size="invisible"></div>
                    {% endif %}

                    <button type="submit" class="btn-primary" id="signupSubmitBtn">
                        Create Account
                    </button>

                    {% if 'google' in enabled_sso_providers %}
                    <div class="divider">
                        <div class="divider-line"></div>
                        <span class="divider-text">or</span>
                        <div class="divider-line"></div>
                    </div>

                    <a href="/accounts/google/login/" class="btn-google">
                        <svg width="18" height="18" viewBox="0 0 18 18">
                            <path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z"/>
                            <path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.184l-2.908-2.258c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332C2.438 15.983 5.482 18 9 18z"/>
                            <path fill="#FBBC05" d="M3.964 10.707c-.18-.54-.282-1.117-.282-1.707 0-.593.102-1.17.282-1.709V4.958H.957C.347 6.173 0 7.548 0 9c0 1.452.348 2.827.957 4.042l3.007-2.335z"/>
                            <path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.958L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z"/>
                        </svg>
                        Sign up with Google
                    </a>
                    {% endif %}

                    <div class="terms-link">
                        <small>By creating an account, you agree to our <a href="javascript:void(0)" onclick="showTermsPopup()">Terms of Service and Privacy Policy</a>.</small>
                    </div>
                </form>
            </div>
        </div>

        <a href="{% url 'core:home' %}" class="back-home">
            <i class="fas fa-home"></i> Back to Home
        </a>
    </div>

    <script>
        // Tab Switching
        function switchTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tab + 'Tab').classList.add('active');
            
            document.querySelectorAll('.form-container').forEach(f => f.classList.remove('active'));
            document.getElementById(tab + 'Form').classList.add('active');
        }

        // Password Toggle
        function togglePassword(inputId, button) {
            const input = document.getElementById(inputId);
            const icon = button.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        // Password Requirements Validation
        function validatePassword(password) {
            const requirements = {
                length: password.length >= 8,
                uppercase: /[A-Z]/.test(password),
                lowercase: /[a-z]/.test(password),
                number: /[0-9]/.test(password),
                special: /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)
            };

            // Update requirement indicators
            updateRequirement('req-length', requirements.length);
            updateRequirement('req-uppercase', requirements.uppercase);
            updateRequirement('req-lowercase', requirements.lowercase);
            updateRequirement('req-number', requirements.number);
            updateRequirement('req-special', requirements.special);

            // Calculate password strength
            const metCount = Object.values(requirements).filter(Boolean).length;
            updatePasswordStrength(metCount, password.length);

            // Return true if all requirements are met
            return Object.values(requirements).every(Boolean);
        }

        function updateRequirement(elementId, isMet) {
            const element = document.getElementById(elementId);
            const icon = element.querySelector('.requirement-icon i');
            
            element.classList.remove('met', 'failed');
            
            if (isMet) {
                element.classList.add('met');
                icon.className = 'fas fa-check';
            } else {
                element.classList.add('failed');
                icon.className = 'fas fa-circle';
                icon.style.fontSize = '0.375rem';
            }
        }

        function updatePasswordStrength(metCount, length) {
            const strengthFill = document.getElementById('strengthFill');
            const strengthText = document.getElementById('strengthText');
            
            strengthFill.className = 'password-strength-fill';
            strengthText.className = 'password-strength-text';
            
            if (metCount === 0 || length === 0) {
                strengthText.textContent = '';
                return;
            }
            
            if (metCount <= 2) {
                strengthFill.classList.add('weak');
                strengthText.classList.add('weak');
                strengthText.textContent = 'Weak';
            } else if (metCount <= 4) {
                strengthFill.classList.add('medium');
                strengthText.classList.add('medium');
                strengthText.textContent = 'Medium';
            } else {
                strengthFill.classList.add('strong');
                strengthText.classList.add('strong');
                strengthText.textContent = 'Strong';
            }
        }

        // Terms Popup
        function showTermsPopup() {
            Swal.fire({
                title: '<strong>Terms of Service and Privacy Policy</strong>',
                html: `
                    <div style="text-align: left; max-height: 400px; overflow-y: auto; padding: 20px; font-size: 0.875rem; line-height: 1.6;">
                        <p style="margin-bottom: 1rem;"><strong>Effective Date:</strong> February 12, 2026</p>
                        
                        <h6 style="color: #2b3c6b; margin: 1.5rem 0 0.75rem 0; font-size: 1rem;">1. Acceptance of Terms</h6>
                        <p>By accessing and using the NORSU Alumni Network platform, you acknowledge that you have read, understood, and agree to be bound by these Terms of Service and Privacy Policy.</p>
                        
                        <h6 style="color: #2b3c6b; margin: 1.5rem 0 0.75rem 0; font-size: 1rem;">2. Account Security</h6>
                        <p>You are responsible for maintaining the confidentiality of your account credentials and for all activities that occur under your account.</p>
                        
                        <h6 style="color: #2b3c6b; margin: 1.5rem 0 0.75rem 0; font-size: 1rem;">3. Privacy and Data Protection</h6>
                        <p>We collect and process personal information in accordance with the Data Privacy Act of 2012 (Republic Act No. 10173). Your data will be used exclusively for facilitating alumni connections, university updates, and career development opportunities.</p>
                        
                        <h6 style="color: #2b3c6b; margin: 1.5rem 0 0.75rem 0; font-size: 1rem;">4. Acceptable Use</h6>
                        <p>Users must maintain professional and respectful communication. Prohibited activities include posting offensive content, harassment, spam, or attempting to compromise platform security.</p>
                        
                        <p style="margin-top: 1.5rem; font-weight: 600;">By proceeding, you acknowledge that you have read and agree to these terms.</p>
                    </div>
                `,
                width: '600px',
                confirmButtonText: 'I Understand',
                confirmButtonColor: '#2b3c6b',
                customClass: {
                    popup: 'terms-popup'
                }
            });
        }

        // Handle Django messages
        document.addEventListener('DOMContentLoaded', function() {
            // Password validation for signup form
            const signupPassword1 = document.getElementById('signupPassword1');
            const signupPassword2 = document.getElementById('signupPassword2');
            const passwordRequirements = document.getElementById('passwordRequirements');
            const signupSubmitBtn = document.getElementById('signupSubmitBtn');

            if (signupPassword1) {
                // Show requirements when password field is focused
                signupPassword1.addEventListener('focus', function() {
                    passwordRequirements.classList.add('show');
                });

                // Validate password on input
                signupPassword1.addEventListener('input', function() {
                    const password = this.value;
                    if (password.length > 0) {
                        passwordRequirements.classList.add('show');
                        validatePassword(password);
                    } else {
                        passwordRequirements.classList.remove('show');
                    }
                });

                // Keep requirements visible if password has value
                signupPassword1.addEventListener('blur', function() {
                    if (this.value.length === 0) {
                        passwordRequirements.classList.remove('show');
                    }
                });
            }

            // Validate password match on confirm password input
            if (signupPassword2) {
                signupPassword2.addEventListener('input', function() {
                    const password1 = signupPassword1.value;
                    const password2 = this.value;
                    
                    if (password2.length > 0) {
                        if (password1 !== password2) {
                            this.style.borderColor = '#ef4444';
                        } else {
                            this.style.borderColor = '#10b981';
                        }
                    } else {
                        this.style.borderColor = '';
                    }
                });
            }

            // Signup form submission
            const signupFormElement = document.getElementById('signupFormElement');
            if (signupFormElement) {
                signupFormElement.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const password1 = signupPassword1.value;
                    const password2 = signupPassword2.value;
                    
                    // Check if password meets all requirements
                    if (!validatePassword(password1)) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Invalid Password',
                            text: 'Please ensure your password meets all the requirements.',
                            confirmButtonColor: '#2b3c6b'
                        });
                        return;
                    }
                    
                    // Check if passwords match
                    if (password1 !== password2) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Passwords Do Not Match',
                            text: 'Please make sure both passwords are identical.',
                            confirmButtonColor: '#2b3c6b'
                        });
                        return;
                    }
                    
                    // Disable submit button and show loading
                    if (signupSubmitBtn) {
                        signupSubmitBtn.disabled = true;
                        signupSubmitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Please wait...';
                    }
                    
                    {% if recaptcha_enabled %}
                    // Execute reCAPTCHA v3 for signup
                    grecaptcha.ready(function() {
                        grecaptcha.execute('{{ recaptcha_site_key }}', {action: 'signup'}).then(function(token) {
                            // Add token to form
                            let tokenInput = document.createElement('input');
                            tokenInput.type = 'hidden';
                            tokenInput.name = 'g-recaptcha-response';
                            tokenInput.value = token;
                            signupFormElement.appendChild(tokenInput);
                            
                            // Submit form
                            signupFormElement.submit();
                        }).catch(function(error) {
                            console.error('reCAPTCHA error:', error);
                            // Allow form submission even if reCAPTCHA fails
                            signupFormElement.submit();
                        });
                    });
                    {% else %}
                    // No reCAPTCHA, submit directly
                    signupFormElement.submit();
                    {% endif %}
                });
            }

            {% if messages %}
                {% for message in messages %}
                    {# Filter out logout, login success, and OAuth error messages #}
                    {% with message_text=message|lower %}
                        {% if 'signed out' not in message_text and 'logged out' not in message_text and 'sign out' not in message_text and 'log out' not in message_text and 'logout' not in message_text and 'signed in' not in message_text and 'logged in' not in message_text and 'google sign-in' not in message_text and 'cancelled' not in message_text and 'access_denied' not in message_text %}
                            {% if message.tags == 'error' %}
                                ToastUtils.showError('{{ message|escapejs }}');
                            {% elif message.tags == 'warning' %}
                                ToastUtils.showWarning('{{ message|escapejs }}');
                            {% elif message.tags == 'success' %}
                                ToastUtils.showSuccess('{{ message|escapejs }}');
                            {% else %}
                                ToastUtils.showInfo('{{ message|escapejs }}');
                            {% endif %}
                        {% endif %}
                    {% endwith %}
                {% endfor %}
            {% endif %}

            {% if recaptcha_enabled %}
            // reCAPTCHA v3 callbacks
            window.onLoginSubmit = function(token) {
                // Token received, submit the form
                document.getElementById('loginFormElement').submit();
            };
            
            window.onSignupSubmit = function(token) {
                // Token received, submit the form
                document.getElementById('signupFormElement').submit();
            };
            
            window.onRecaptchaExpired = function() {
                console.warn('reCAPTCHA expired, please try again');
            };
            
            window.onRecaptchaError = function() {
                console.error('reCAPTCHA error occurred');
            };
            {% endif %}
            
            // Login form submission
            const loginFormElement = document.getElementById('loginFormElement');
            if (loginFormElement) {
                loginFormElement.addEventListener('submit', function(e) {
                    {% if recaptcha_enabled %}
                    e.preventDefault();
                    
                    const submitBtn = document.getElementById('loginSubmitBtn');
                    if (submitBtn) {
                        submitBtn.disabled = true;
                        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Please wait...';
                    }
                    
                    // Execute reCAPTCHA v3 for login
                    grecaptcha.ready(function() {
                        grecaptcha.execute('{{ recaptcha_site_key }}', {action: 'login'}).then(function(token) {
                            // Add token to form
                            let tokenInput = document.createElement('input');
                            tokenInput.type = 'hidden';
                            tokenInput.name = 'g-recaptcha-response';
                            tokenInput.value = token;
                            loginFormElement.appendChild(tokenInput);
                            
                            // Submit form
                            loginFormElement.submit();
                        }).catch(function(error) {
                            console.error('reCAPTCHA error:', error);
                            // Allow form submission even if reCAPTCHA fails
                            loginFormElement.submit();
                        });
                    });
                    {% endif %}
                });
            }
        });
    </script>

    <!-- Notyf Toast Notifications -->
    <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>
    <script src="{% static 'js/utils/toast-notifications.js' %}"></script>
    
    <!-- reCAPTCHA Mobile Helper -->
    <script src="{% static 'js/recaptcha-mobile-helper.js' %}"></script>
</body>
</html>
