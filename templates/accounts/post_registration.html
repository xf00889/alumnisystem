{% load i18n %}
{% load crispy_forms_tags %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% trans "Complete Your Alumni Profile" %} - NORSU Alumni Network</title>

    <!-- Google Fonts - Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

    <style>
        /* NORSU Alumni System Variables */
        :root {
            --primary-color: #2b3c6b;
            --primary-dark: #1a2544;
            --secondary-color: #4a5568;
            --ui-background: #f7fafc;
            --ui-surface: #ffffff;
            --ui-border: #e2e8f0;
            --ui-hover: #edf2f7;
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --text-muted: #a0aec0;
            --text-light: #ffffff;
            --feedback-success: #48bb78;
            --feedback-warning: #ed8936;
            --feedback-error: #e53e3e;
            --feedback-info: #4299e1;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --radius-sm: 0.25rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --font-primary: 'Poppins', sans-serif;
        }

        body {
            font-family: var(--font-primary);
            background: linear-gradient(rgba(43, 60, 107, 0.8), rgba(26, 37, 68, 0.9)),
                        url('{% static "images/bg.jpg" %}') no-repeat center center;
            background-size: cover;
            background-attachment: fixed;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Main Container */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .auth-wrapper {
            background: var(--ui-surface);
            border-radius: 1rem;
            /* Enhanced multi-layered shadow for depth and professional appearance */
            box-shadow:
                0 25px 50px -12px rgba(43, 60, 107, 0.25),
                0 20px 25px -5px rgba(43, 60, 107, 0.1),
                0 10px 10px -5px rgba(43, 60, 107, 0.04),
                0 4px 6px -2px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            width: 100%;
            max-width: 850px;
            min-height: 600px;
            display: flex;
            position: relative;
        }

        /* Left Panel - Branding */
        .auth-brand-panel {
            flex: 0 0 45%;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%),
                        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><defs><pattern id="campus-pattern" x="0" y="0" width="200" height="200" patternUnits="userSpaceOnUse"><circle cx="100" cy="100" r="3" fill="%23ffffff" opacity="0.1"/><circle cx="50" cy="50" r="2" fill="%23ffffff" opacity="0.05"/><circle cx="150" cy="150" r="2" fill="%23ffffff" opacity="0.05"/></pattern></defs><rect width="1000" height="1000" fill="url(%23campus-pattern)"/></svg>') repeat;
            background-size: cover, 200px 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 3rem 2rem;
            color: var(--text-light);
            position: relative;
        }

        .auth-brand-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, 
                rgba(43, 60, 107, 0.2) 0%, 
                rgba(26, 37, 68, 0.3) 50%,
                rgba(43, 60, 107, 0.2) 100%);
            pointer-events: none;
        }

        .brand-content {
            position: relative;
            z-index: 1;
            text-align: center;
        }

        .brand-logo {
            width: 120px;
            height: 120px;
            margin-bottom: 2rem;
            filter: brightness(1.1) drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }

        .brand-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .brand-subtitle {
            font-size: 1.125rem;
            opacity: 0.9;
            line-height: 1.6;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* Right Panel - Forms */
        .auth-form-panel {
            flex: 1;
            padding: 2.5rem 2rem;
            position: relative;
            overflow-y: auto;
        }



        /* Form Header */
        .form-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .form-title {
            color: var(--primary-color);
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .form-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
            line-height: 1.5;
        }

        /* Form Styling */
        .form-container {
            width: 100%;
        }

        .form-group {
            margin-bottom: 1.5rem;
            position: relative;
        }

        /* Crispy Forms Integration */
        .form-control {
            border: 2px solid var(--ui-border);
            border-radius: var(--radius-md);
            padding: 0.875rem 1rem;
            font-size: 1rem;
            font-family: var(--font-primary);
            background: var(--ui-surface);
            color: var(--text-primary);
            transition: all 0.3s ease;
            width: 100%;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(43, 60, 107, 0.1);
        }

        .form-select {
            border: 2px solid var(--ui-border);
            border-radius: var(--radius-md);
            padding: 0.875rem 1rem;
            font-size: 1rem;
            font-family: var(--font-primary);
            background: var(--ui-surface);
            color: var(--text-primary);
            transition: all 0.3s ease;
            width: 100%;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(43, 60, 107, 0.1);
        }

        .form-label {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .help-text {
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }

        .invalid-feedback {
            color: var(--feedback-error);
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }

        .form-input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--ui-border);
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-family: var(--font-primary);
            background: var(--ui-surface);
            color: var(--text-primary);
            transition: all 0.3s ease;
            position: relative;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(43, 60, 107, 0.1);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        /* Button Styling */
        .btn-submit {
            width: 100%;
            padding: 0.875rem 1.5rem;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: var(--text-light);
            border: none;
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-weight: 600;
            font-family: var(--font-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(43, 60, 107, 0.3);
        }

        .btn-submit:active {
            transform: translateY(0);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .auth-wrapper {
                flex-direction: column;
                max-width: 100%;
                margin: 1rem;
                min-height: auto;
            }

            .auth-brand-panel {
                flex: none;
                padding: 2rem 1rem;
            }

            .brand-logo {
                width: 80px;
                height: 80px;
                margin-bottom: 1rem;
            }

            .brand-title {
                font-size: 1.5rem;
            }

            .brand-subtitle {
                font-size: 1rem;
            }

            .auth-form-panel {
                padding: 2rem 1.5rem;
            }
        }

        @media (max-width: 576px) {
            .auth-container {
                padding: 1rem;
            }

            .auth-wrapper {
                margin: 0.5rem;
                border-radius: 0.75rem;
            }

            .auth-brand-panel {
                padding: 1.5rem 1rem;
            }

            .auth-form-panel {
                padding: 1.5rem 1rem;
            }
        }

        /* Cascading Dropdown Enhancements */
        .form-control:disabled {
            background-color: #f8f9fa !important;
            border-color: #dee2e6 !important;
            color: #6c757d !important;
            cursor: not-allowed;
        }

        .form-control.college-selected {
            border-color: #28a745 !important;
            background-color: #f8fff9 !important;
        }

        .form-control.course-selected {
            border-color: #28a745 !important;
            background-color: #f8fff9 !important;
        }

        .form-control.other-program {
            border-color: #ffc107 !important;
            background-color: #fffbf0 !important;
        }

        .cascade-message {
            font-size: 0.875rem !important;
            margin-top: 0.5rem !important;
            padding: 0.5rem 0.75rem !important;
        }

        .cascade-message .fas {
            opacity: 0.8;
        }

        /* Field dependency indicators */
        .form-group {
            position: relative;
        }

        .dependency-indicator {
            position: absolute;
            top: 0;
            right: 0;
            background: #17a2b8;
            color: white;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0 var(--radius-md) 0 0.5rem;
            z-index: 10;
        }

        .dependency-indicator.disabled {
            background: #6c757d;
        }

        /* Smooth transitions for form state changes */
        .form-control {
            transition: all 0.3s ease !important;
        }

        /* Loading state for course dropdown */
        .form-control.loading {
            background-image: url("data:image/svg+xml,%3csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3e%3cg fill='none' fill-rule='evenodd'%3e%3cg fill='%236c757d' fill-opacity='0.6'%3e%3cpath d='M10 3v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6z'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 16px 16px;
        }
    </style>
</head>
<body>
    <div class="auth-container">
        <div class="auth-wrapper">
            <!-- Left Panel - Branding -->
            <div class="auth-brand-panel">
                <div class="brand-content">
                    <img src="{% static 'images/logo_norsu.png' %}" alt="NORSU Logo" class="brand-logo">
                    <h1 class="brand-title">NORSU Alumni Network</h1>
                    <p class="brand-subtitle">Complete your alumni profile to join our growing community and connect with fellow graduates.</p>
                </div>
            </div>

            <!-- Right Panel - Forms -->
            <div class="auth-form-panel">


                <!-- Form Header -->
                <div class="form-header mb-4">
                    <h2 class="form-title">Complete Your Alumni Profile</h2>
                    <p class="form-subtitle">Please provide your academic and employment information to join our alumni network</p>
                </div>

                <form method="post" class="post-reg-form">
                    {% csrf_token %}
                    {{ form|crispy }}
                    <button type="submit" class="btn-submit">
                        <i class="fas fa-check-circle me-2"></i>Complete Registration
                    </button>
                </form>
            </div>
        </div>
    </div>

<!-- Bootstrap 5 JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Cascading Dropdown Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Courses organized by college for cascading dropdown
    const coursesByCollege = {
        'CAS': [  // College of Arts and Sciences
            ['BSIT', 'BS in Information Technology'],
            ['BSCS', 'BS in Computer Science'],
            ['BSP', 'BS in Psychology'],
            ['BSM', 'BS in Mathematics'],
            ['BSPHY', 'BS in Physics'],
            ['BSBIO', 'BS in Biology']
        ],
        'CBA': [  // College of Business Administration
            ['BSA', 'BS in Accountancy'],
            ['BSBA-FM', 'BSBA in Financial Management'],
            ['BSBA-MM', 'BSBA in Marketing Management'],
            ['BSBA-HRM', 'BSBA in Human Resource Management']
        ],
        'CTE': [  // College of Teacher Education
            ['BEED', 'Bachelor of Elementary Education'],
            ['BSED-ENG', 'BS in Education - English'],
            ['BSED-MATH', 'BS in Education - Mathematics'],
            ['BSED-SCI', 'BS in Education - Science'],
            ['BSED-SS', 'BS in Education - Social Studies']
        ],
        'CNPAHS': [  // College of Nursing, Pharmacy and Allied Health Sciences
            ['BSN', 'BS in Nursing'],
            ['BSP', 'BS in Pharmacy'],
            ['BSMT', 'BS in Medical Technology']
        ],
        'CCJE': [  // College of Criminal Justice Education
            ['BSCRIM', 'BS in Criminology']
        ],
        'CTHM': [  // College of Tourism and Hospitality Management
            ['BSHRM', 'BS in Hotel and Restaurant Management'],
            ['BSTM', 'BS in Tourism Management']
        ],
        'CEA': [  // College of Engineering and Architecture
            ['BSCE', 'BS in Civil Engineering'],
            ['BSEE', 'BS in Electrical Engineering'],
            ['BSME', 'BS in Mechanical Engineering'],
            ['BSARCH', 'BS in Architecture']
        ],
        'CAFF': [  // College of Agriculture, Forestry and Fishery
            ['BSA-AGRI', 'BS in Agriculture'],
            ['BSF', 'BS in Forestry'],
            ['BSFT', 'BS in Fisheries Technology']
        ],
        'CIT': [  // College of Industrial Technology
            ['BSIT-AT', 'BS in Industrial Technology - Automotive'],
            ['BSIT-ET', 'BS in Industrial Technology - Electronics'],
            ['BSIT-FPSM', 'BS in Industrial Technology - Food Processing']
        ],
        'COL': [  // College of Law
            ['JD', 'Juris Doctor'],
            ['LLB', 'Bachelor of Laws']
        ]
    };

    const collegeSelect = document.getElementById('id_college');
    const courseSelect = document.getElementById('id_course_graduated');

    if (collegeSelect && courseSelect) {
        // Handle college selection change
        collegeSelect.addEventListener('change', function() {
            const selectedCollege = this.value;

            // Add loading state
            courseSelect.classList.add('loading');

            // Clear existing course options
            courseSelect.innerHTML = '';

            // Remove previous CSS classes
            courseSelect.classList.remove('college-selected', 'course-selected', 'other-program');
            this.classList.remove('college-selected');

            if (selectedCollege === '') {
                // No college selected - disable course dropdown
                courseSelect.disabled = true;
                courseSelect.classList.remove('loading');

                // Add placeholder option
                const placeholderOption = document.createElement('option');
                placeholderOption.value = '';
                placeholderOption.textContent = '-- Select your college first --';
                courseSelect.appendChild(placeholderOption);

                showMessage('Please select your college first to see available programs.', 'info', courseSelect);

                // Update dependency indicator
                updateDependencyIndicator(courseSelect, 'disabled');
            } else {
                // College selected - enable course dropdown and populate with courses
                setTimeout(() => {  // Simulate brief loading for better UX
                    courseSelect.disabled = false;
                    courseSelect.classList.remove('loading');
                    courseSelect.classList.add('college-selected');

                    // Add default option
                    const defaultOption = document.createElement('option');
                    defaultOption.value = '';
                    defaultOption.textContent = '-- Select your program --';
                    courseSelect.appendChild(defaultOption);

                    // Add courses for selected college
                    const courses = coursesByCollege[selectedCollege] || [];
                    courses.forEach(([courseCode, courseName]) => {
                        const option = document.createElement('option');
                        option.value = courseCode;
                        option.textContent = courseName;
                        courseSelect.appendChild(option);
                    });

                    // Add "Other Program" option
                    const otherOption = document.createElement('option');
                    otherOption.value = 'OTHER';
                    otherOption.textContent = 'Other Program';
                    courseSelect.appendChild(otherOption);

                    // Show success message
                    const courseCount = courses.length;
                    showMessage(`${courseCount} programs available for the selected college.`, 'success', courseSelect);

                    // Add visual feedback to college field
                    this.classList.add('college-selected');

                    // Update dependency indicator
                    updateDependencyIndicator(courseSelect, 'enabled');
                }, 300);
            }
        });

        // Handle course selection change
        courseSelect.addEventListener('change', function() {
            const selectedCourse = this.value;

            // Remove previous CSS classes
            this.classList.remove('course-selected', 'other-program');

            if (selectedCourse === 'OTHER') {
                this.classList.add('other-program');
                showMessage('You selected "Other Program". Please ensure your college selection is correct.', 'warning', this);
            } else if (selectedCourse !== '') {
                this.classList.add('course-selected');
                showMessage('Course selected successfully!', 'success', this);
            }
        });

        // Initialize form state
        if (collegeSelect.value === '') {
            courseSelect.disabled = true;
            updateDependencyIndicator(courseSelect, 'disabled');
        } else {
            updateDependencyIndicator(courseSelect, 'enabled');
        }

        // Add dependency indicators on page load
        addDependencyIndicators();
    }

    function updateDependencyIndicator(element, state) {
        const indicator = element.parentNode.querySelector('.dependency-indicator');
        if (indicator) {
            indicator.className = `dependency-indicator ${state}`;
            indicator.textContent = state === 'disabled' ? 'Select college first' : 'Dependent on college';
        }
    }

    function addDependencyIndicators() {
        // Add indicator to course field
        const courseContainer = courseSelect.closest('.form-group') || courseSelect.parentNode;
        if (!courseContainer.querySelector('.dependency-indicator')) {
            const indicator = document.createElement('div');
            indicator.className = 'dependency-indicator disabled';
            indicator.textContent = 'Select college first';
            courseContainer.style.position = 'relative';
            courseContainer.appendChild(indicator);
        }
    }

    function showMessage(message, type, targetElement) {
        // Remove any existing message for this element
        const existingMessage = targetElement.parentNode.querySelector('.cascade-message');
        if (existingMessage) {
            existingMessage.remove();
        }

        // Choose appropriate icon based on message type
        let icon = 'fa-info-circle';
        if (type === 'success') icon = 'fa-check-circle';
        else if (type === 'warning') icon = 'fa-exclamation-triangle';
        else if (type === 'danger') icon = 'fa-times-circle';

        // Create new message element
        const messageDiv = document.createElement('div');
        messageDiv.className = `alert alert-${type} alert-dismissible fade show cascade-message`;
        messageDiv.innerHTML = `
            <i class="fas ${icon} me-2"></i>${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;

        // Insert after target field
        const fieldContainer = targetElement.closest('.form-group') || targetElement.parentNode;
        fieldContainer.appendChild(messageDiv);

        // Auto-hide after different durations based on type
        const duration = type === 'success' ? 3000 : type === 'info' ? 4000 : 5000;
        setTimeout(() => {
            if (messageDiv && messageDiv.parentNode) {
                messageDiv.classList.remove('show');
                setTimeout(() => {
                    if (messageDiv && messageDiv.parentNode) {
                        messageDiv.remove();
                    }
                }, 150);
            }
        }, duration);
    }
});
</script>
</body>
</html>