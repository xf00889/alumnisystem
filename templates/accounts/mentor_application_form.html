{% extends 'base.html' %}
{% load static %}

{% block title %}Apply to be a Mentor{% endblock %}

{% block extra_css %}
<style>
    /* CSS Variables */
    :root {
        --primary-color: #2b3c6b;
        --secondary-color: #4a5568;
        --text-light: #ffffff;
        --radius-md: 0.375rem;
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    /* Container Fluid Styling */
    .container-fluid {
        padding: 0;
        width: 100%;
        max-width: 100%;
    }

    /* Dashboard Header - Using container-fluid styling */
    .directory-header {
        background: var(--primary-color);
        color: var(--text-light);
        padding: 2rem;
        border-radius: var(--radius-md);
        margin-bottom: 1.5rem;
        margin-left: 1.5rem;
        margin-right: 1.5rem;
        box-shadow: var(--shadow-sm);
        text-align: center;
        font-family: 'Poppins', sans-serif;
        width: calc(100% - 3rem);
        box-sizing: border-box;
    }

    .directory-title {
        font-size: 2rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        font-family: 'Poppins', sans-serif;
        color: var(--text-light);
    }

    .directory-subtitle {
        opacity: 0.9;
        font-size: 1rem;
        margin: 0;
        font-family: 'Poppins', sans-serif;
        color: var(--text-light);
    }

    .progressive-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 2rem;
    }
    
    .step-indicator {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 3rem;
        flex-wrap: wrap;
        gap: 1rem;
    }
    
    .step {
        display: flex;
        align-items: center;
        margin: 0 0.5rem;
    }
    
    .step-number {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #e2e8f0;
        color: #718096;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin-right: 0.5rem;
        font-size: 1rem;
        transition: all 0.3s ease;
    }
    
    .step.active .step-number {
        background: #2b3c6b;
        color: white;
        transform: scale(1.1);
    }
    
    .step.completed .step-number {
        background: #48bb78;
        color: white;
    }
    
    .step-title {
        font-weight: 600;
        color: #2d3748;
        font-size: 0.9rem;
    }
    
    .step.active .step-title {
        color: #2b3c6b;
    }
    
    .step-connector {
        width: 60px;
        height: 2px;
        background: #e2e8f0;
        margin: 0 0.5rem;
    }
    
    .step.completed + .step-connector {
        background: #48bb78;
    }
    
    .phase-container {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
    }
    
    .phase-header {
        text-align: center;
        margin-bottom: 2rem;
    }
    
    .phase-title {
        font-size: 1.5rem;
        font-weight: bold;
        color: #2d3748;
        margin-bottom: 0.5rem;
    }
    
    .phase-subtitle {
        color: #718096;
        font-size: 1rem;
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-label {
        display: block;
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 0.5rem;
        font-size: 0.95rem;
    }
    
    .form-control {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.2s;
        font-family: 'Poppins', sans-serif;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #2b3c6b;
        box-shadow: 0 0 0 3px rgba(43, 60, 107, 0.1);
    }
    
    textarea.form-control {
        resize: vertical;
        min-height: 100px;
    }
    
    .form-text {
        color: #718096;
        font-size: 0.875rem;
        margin-top: 0.5rem;
    }
    
    .invalid-feedback {
        display: block;
        color: #e53e3e;
        font-size: 0.875rem;
        margin-top: 0.5rem;
    }
    
    .btn-primary {
        background: #2b3c6b;
        color: white;
        padding: 0.75rem 2rem;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.2s;
        font-family: 'Poppins', sans-serif;
    }
    
    .btn-primary:hover {
        background: #1a2332;
    }
    
    .btn-secondary {
        background: #718096;
        color: white;
        padding: 0.75rem 2rem;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.2s;
        margin-right: 1rem;
        font-family: 'Poppins', sans-serif;
    }
    
    .btn-secondary:hover {
        background: #4a5568;
    }
    
    .form-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 2rem;
        flex-wrap: wrap;
        gap: 1rem;
    }
    
    .progress-info {
        background: #edf2f7;
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        border-left: 4px solid #2b3c6b;
    }
    
    .progress-info h4 {
        margin: 0 0 0.5rem 0;
        color: #2d3748;
        font-size: 1.1rem;
    }
    
    .progress-info p {
        margin: 0;
        color: #718096;
        font-size: 0.95rem;
    }
    
    .alert {
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1.5rem;
    }
    
    .alert-info {
        background: #e6f3ff;
        border: 1px solid #b3d9ff;
        color: #004085;
    }
    
    .alert-danger {
        background: #fee;
        border: 1px solid #fcc;
        color: #c33;
    }
    
    .step-content {
        display: none;
    }
    
    .step-content.active {
        display: block;
    }
    
    .file-upload-hint {
        font-size: 0.875rem;
        color: #718096;
        margin-top: 0.25rem;
    }
    
    @media (max-width: 768px) {
        body {
            font-size: 0.875rem !important;
            overflow-x: hidden !important;
        }

        .container-fluid {
            padding: 0 !important;
            overflow-x: hidden !important;
        }

        .progressive-container {
            padding: 1rem !important;
            max-width: 100% !important;
            overflow-x: hidden !important;
        }
        
        .step-indicator {
            flex-direction: row !important;
            gap: 0.5rem;
            width: 100%;
            justify-content: center;
            flex-wrap: nowrap;
        }
        
        .step {
            flex-direction: column;
            align-items: center;
            margin: 0;
        }

        .step-number {
            margin-right: 0 !important;
            margin-bottom: 0.25rem;
        }
        
        .step-connector {
            width: 30px !important;
            height: 2px !important;
            align-self: center;
            margin-top: -1.5rem;
        }
        
        .directory-title {
            font-size: 1.25rem !important;
        }

        .directory-subtitle {
            font-size: 0.875rem !important;
        }
        
        .directory-header {
            margin-left: 0.75rem !important;
            margin-right: 0.75rem !important;
            width: calc(100% - 1.5rem) !important;
            padding: 1.25rem !important;
            box-sizing: border-box !important;
        }

        .step-title {
            font-size: 0.75rem !important;
            text-align: center;
        }

        .step-number {
            width: 36px !important;
            height: 36px !important;
            font-size: 0.9375rem !important;
        }

        .form-section {
            width: 100% !important;
            box-sizing: border-box !important;
            overflow-x: hidden !important;
        }

        .form-section h3 {
            font-size: 1.125rem !important;
        }

        .form-section p {
            font-size: 0.875rem !important;
        }

        label {
            font-size: 0.875rem !important;
        }

        .form-control, .form-select, textarea {
            font-size: 0.875rem !important;
            width: 100% !important;
            box-sizing: border-box !important;
        }
        
        .form-actions {
            flex-direction: column;
            width: 100% !important;
        }
        
        .btn-secondary, .btn-primary {
            width: 100% !important;
            margin: 0 0 0.5rem 0 !important;
            font-size: 0.875rem !important;
            box-sizing: border-box !important;
        }

        .info-box {
            padding: 1rem !important;
            font-size: 0.875rem !important;
            width: 100% !important;
            box-sizing: border-box !important;
        }

        .progress-info {
            padding: 0.875rem !important;
            margin-bottom: 1rem !important;
        }

        .progress-info h4 {
            font-size: 0.875rem !important;
            margin-bottom: 0.375rem !important;
        }

        .progress-info h4 i {
            font-size: 0.8125rem !important;
        }

        .progress-info p {
            font-size: 0.75rem !important;
            line-height: 1.3 !important;
        }
    }

    @media (max-width: 576px) {
        body {
            font-size: 0.8125rem !important;
            overflow-x: hidden !important;
        }

        .container-fluid {
            padding: 0 !important;
        }

        .progressive-container {
            padding: 0.75rem !important;
            margin: 0 !important;
            max-width: 100% !important;
        }

        .step-indicator {
            gap: 0.375rem;
        }

        .step {
            flex: 1;
            min-width: 0;
        }

        .step-connector {
            width: 20px !important;
        }

        .directory-title {
            font-size: 1.125rem !important;
        }

        .directory-subtitle {
            font-size: 0.8125rem !important;
        }

        .directory-header {
            padding: 1rem !important;
            margin-left: 0.5rem !important;
            margin-right: 0.5rem !important;
            width: calc(100% - 1rem) !important;
        }

        .step-title {
            font-size: 0.6875rem !important;
        }

        .step-number {
            width: 32px !important;
            height: 32px !important;
            font-size: 0.875rem !important;
        }

        .form-section {
            padding: 1rem !important;
        }

        .form-section h3 {
            font-size: 1rem !important;
            margin-bottom: 0.75rem !important;
        }

        .form-section p {
            font-size: 0.8125rem !important;
        }

        label {
            font-size: 0.8125rem !important;
        }

        .form-control, .form-select, textarea {
            font-size: 0.8125rem !important;
            padding: 0.625rem !important;
        }

        .btn-secondary, .btn-primary {
            font-size: 0.8125rem !important;
            padding: 0.625rem 1rem !important;
        }

        .info-box {
            padding: 0.875rem !important;
            font-size: 0.8125rem !important;
        }

        .info-box i {
            font-size: 1rem !important;
        }

        .progress-info {
            padding: 0.75rem !important;
            margin-bottom: 0.875rem !important;
        }

        .progress-info h4 {
            font-size: 0.8125rem !important;
            margin-bottom: 0.3rem !important;
        }

        .progress-info h4 i {
            font-size: 0.75rem !important;
        }

        .progress-info p {
            font-size: 0.6875rem !important;
            line-height: 1.3 !important;
        }

        small, .form-text {
            font-size: 0.75rem !important;
        }
    }

    @media (max-width: 375px) {
        body {
            font-size: 0.75rem !important;
        }

        .progressive-container {
            padding: 0.5rem !important;
        }

        .step-connector {
            width: 15px !important;
        }

        .directory-title {
            font-size: 1rem !important;
        }

        .directory-subtitle {
            font-size: 0.75rem !important;
        }

        .directory-header {
            padding: 0.875rem !important;
            margin-left: 0.375rem !important;
            margin-right: 0.375rem !important;
            width: calc(100% - 0.75rem) !important;
        }

        .step-title {
            font-size: 0.625rem !important;
        }

        .step-number {
            width: 28px !important;
            height: 28px !important;
            font-size: 0.8125rem !important;
        }

        .form-section h3 {
            font-size: 0.9375rem !important;
        }

        .form-section p {
            font-size: 0.75rem !important;
        }

        label {
            font-size: 0.75rem !important;
        }

        .form-control, .form-select, textarea {
            font-size: 0.75rem !important;
            padding: 0.5rem !important;
        }

        .btn-secondary, .btn-primary {
            font-size: 0.75rem !important;
            padding: 0.5rem 0.875rem !important;
        }

        .info-box {
            font-size: 0.75rem !important;
            padding: 0.75rem !important;
        }

        .progress-info {
            padding: 0.625rem !important;
            margin-bottom: 0.75rem !important;
        }

        .progress-info h4 {
            font-size: 0.75rem !important;
            margin-bottom: 0.25rem !important;
        }

        .progress-info h4 i {
            font-size: 0.6875rem !important;
        }

        .progress-info p {
            font-size: 0.625rem !important;
            line-height: 1.3 !important;
        }

        small, .form-text {
            font-size: 0.6875rem !important;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header with container-fluid styling -->
    <div class="directory-header">
        <h1 class="directory-title">
            <i class="fas fa-chalkboard-teacher me-2"></i>
            Mentor Application
        </h1>
        <p class="directory-subtitle">Let's guide you through the application process step by step</p>
    </div>

    <div class="progressive-container">
        <!-- Step Indicator -->
        <div class="step-indicator">
            <div class="step active" data-step="1">
                <div class="step-number">1</div>
                <div class="step-title">Expertise</div>
            </div>
            <div class="step-connector"></div>
            <div class="step" data-step="2">
                <div class="step-number">2</div>
                <div class="step-title">Documents</div>
            </div>
            <div class="step-connector"></div>
            <div class="step" data-step="3">
                <div class="step-number">3</div>
                <div class="step-title">Summary</div>
            </div>
        </div>
        
        <!-- Progress Info -->
        <div class="progress-info">
            <h4><i class="fas fa-info-circle me-2"></i>Application Process</h4>
            <p>Please complete all steps to submit your mentor application. Your application will be reviewed by our administrators.</p>
        </div>

        <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate id="mentorApplicationForm">
            {% csrf_token %}
            
            {% if form.non_field_errors %}
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-circle me-2"></i>
                {% for error in form.non_field_errors %}
                <p class="mb-0">{{ error }}</p>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Step 1: Expertise & Experience -->
            <div class="phase-container step-content active" id="step1">
                <div class="phase-header">
                    <h2 class="phase-title">Step 1: Expertise & Experience</h2>
                    <p class="phase-subtitle">Tell us about your professional background</p>
                </div>

                <div class="form-group">
                    <label for="{{ form.expertise_areas.id_for_label }}" class="form-label">
                        Areas of Expertise
                        <span class="text-danger">*</span>
                    </label>
                    {{ form.expertise_areas }}
                    {% if form.expertise_areas.help_text %}
                    <div class="form-text">{{ form.expertise_areas.help_text }}</div>
                    {% endif %}
                    {% if form.expertise_areas.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.expertise_areas.errors %}
                        {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="{{ form.years_of_experience.id_for_label }}" class="form-label">
                        Years of Experience
                        <span class="text-danger">*</span>
                    </label>
                    {{ form.years_of_experience }}
                    {% if form.years_of_experience.help_text %}
                    <div class="form-text">{{ form.years_of_experience.help_text }}</div>
                    {% endif %}
                    {% if form.years_of_experience.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.years_of_experience.errors %}
                        {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <div class="form-actions">
                    <a href="{% url 'accounts:profile_detail' %}" class="btn-secondary">
                        <i class="fas fa-times me-2"></i>Cancel
                    </a>
                    <button type="button" class="btn-primary" onclick="nextStep(2)">
                        Next: Documents <i class="fas fa-arrow-right ms-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 2: Documents -->
            <div class="phase-container step-content" id="step2">
                <div class="phase-header">
                    <h2 class="phase-title">Step 2: Documents & Certifications</h2>
                    <p class="phase-subtitle">Upload your professional documents</p>
                </div>

                <div class="form-group">
                    <label for="{{ form.certifications.id_for_label }}" class="form-label">
                        Certifications
                        <span class="text-danger">*</span>
                    </label>
                    {{ form.certifications }}
                    {% if form.certifications.help_text %}
                    <div class="form-text">{{ form.certifications.help_text }}</div>
                    {% endif %}
                    <div class="file-upload-hint">
                        <i class="fas fa-file-pdf me-1"></i>PDF files only, maximum 5MB
                    </div>
                    {% if form.certifications.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.certifications.errors %}
                        {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="{{ form.training_documents.id_for_label }}" class="form-label">
                        Training Documents
                        <span class="text-danger">*</span>
                    </label>
                    {{ form.training_documents }}
                    {% if form.training_documents.help_text %}
                    <div class="form-text">{{ form.training_documents.help_text }}</div>
                    {% endif %}
                    <div class="file-upload-hint">
                        <i class="fas fa-file-pdf me-1"></i>PDF files only, maximum 5MB
                    </div>
                    {% if form.training_documents.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.training_documents.errors %}
                        {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="previousStep(1)">
                        <i class="fas fa-arrow-left me-2"></i>Previous
                    </button>
                    <button type="button" class="btn-primary" onclick="nextStep(3)">
                        Next: Summary <i class="fas fa-arrow-right ms-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 3: Summary -->
            <div class="phase-container step-content" id="step3">
                <div class="phase-header">
                    <h2 class="phase-title">Step 3: Competency Summary</h2>
                    <p class="phase-subtitle">Describe your expertise and how you can help mentees</p>
                </div>

                <div class="form-group">
                    <label for="{{ form.competency_summary.id_for_label }}" class="form-label">
                        Competency Summary
                        <span class="text-danger">*</span>
                    </label>
                    {{ form.competency_summary }}
                    {% if form.competency_summary.help_text %}
                    <div class="form-text">{{ form.competency_summary.help_text }}</div>
                    {% endif %}
                    {% if form.competency_summary.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.competency_summary.errors %}
                        {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="previousStep(2)">
                        <i class="fas fa-arrow-left me-2"></i>Previous
                    </button>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-paper-plane me-2"></i>Submit Application
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block page_specific_js %}
<script>
    // Make functions globally available
    window.currentStep = 1;
    window.totalSteps = 3;

    window.updateStepIndicator = function(step) {
        // Update step indicators
        document.querySelectorAll('.step').forEach((stepEl, index) => {
            const stepNum = index + 1;
            if (stepNum < step) {
                stepEl.classList.add('completed');
                stepEl.classList.remove('active');
            } else if (stepNum === step) {
                stepEl.classList.add('active');
                stepEl.classList.remove('completed');
            } else {
                stepEl.classList.remove('active', 'completed');
            }
        });
    };

    window.showStep = function(step) {
        // Hide all steps
        document.querySelectorAll('.step-content').forEach(content => {
            content.classList.remove('active');
        });
        
        // Show current step
        const stepContent = document.getElementById('step' + step);
        if (stepContent) {
            stepContent.classList.add('active');
            window.currentStep = step;
            window.updateStepIndicator(step);
            
            // Scroll to top of form
            stepContent.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    };

    window.nextStep = function(step) {
        // Validate current step before proceeding
        const currentStepContent = document.getElementById('step' + window.currentStep);
        const form = document.getElementById('mentorApplicationForm');
        
        if (!currentStepContent) {
            console.error('Current step content not found');
            return;
        }
        
        // Get all required fields in current step
        const requiredFields = currentStepContent.querySelectorAll('[required]');
        let isValid = true;
        
        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                isValid = false;
                field.classList.add('is-invalid');
            } else {
                field.classList.remove('is-invalid');
            }
        });
        
        if (isValid) {
            window.showStep(step);
        } else {
            alert('Please fill in all required fields before proceeding.');
        }
    };

    window.previousStep = function(step) {
        window.showStep(step);
    };

    // File input validation
    document.querySelectorAll('input[type="file"]').forEach(input => {
        input.addEventListener('change', function() {
            if (this.files[0]) {
                const file = this.files[0];
                const fileSize = file.size / 1024 / 1024; // Size in MB
                
                if (!file.name.toLowerCase().endsWith('.pdf')) {
                    this.value = '';
                    alert('Please upload only PDF files.');
                    this.classList.add('is-invalid');
                } else if (fileSize > 5) {
                    this.value = '';
                    alert('File size must be under 5MB.');
                    this.classList.add('is-invalid');
                } else {
                    this.classList.remove('is-invalid');
                    // Show file name
                    const label = this.parentElement.querySelector('.form-label');
                    if (label) {
                        const fileName = document.createElement('small');
                        fileName.className = 'file-name text-success';
                        fileName.textContent = `âœ“ ${file.name}`;
                        fileName.style.display = 'block';
                        fileName.style.marginTop = '0.5rem';
                        
                        // Remove previous file name if exists
                        const prevFileName = label.parentElement.querySelector('.file-name');
                        if (prevFileName) {
                            prevFileName.remove();
                        }
                        
                        label.parentElement.appendChild(fileName);
                    }
                }
            }
        });
    });

    // Initialize step indicator
    document.addEventListener('DOMContentLoaded', function() {
        window.updateStepIndicator(1);
    });
</script>
{% endblock %}
