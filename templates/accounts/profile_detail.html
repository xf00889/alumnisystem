{% extends "base.html" %}
{% load i18n %}
{% load static %}
{% load profile_filters %}
{% load string_filters %}
{% load crispy_forms_tags %}

{% block title %}My Profile - NORSU Alumni{% endblock %}

{% block page_title %}My Profile{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item active">Profile</li>
{% endblock %}

{% block extra_css %}
<style>
    /* Core Theme Variables */
    :root {
        --primary-color: #063970;
        --primary-light: #0a4f94;
        --primary-dark: #1a2544;
        --secondary-color: #6c757d;
        --success-color: #28a745;
        --danger-color: #dc3545;
        --warning-color: #ffc107;
        --info-color: #17a2b8;
        --text-primary: #2c3e50;
        --text-secondary: #6c757d;
        --text-light: #f8f9fa;
        --border-radius: 15px;
        --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        --transition: all 0.3s ease;
        --card-border-radius: 16px;
        --profile-card-shadow: rgba(17, 12, 46, 0.1) 0px 10px 30px;
        --hover-transition: all 0.3s ease;
        --icon-btn-size: 32px;
        --icon-size: 14px;
        --danger-hover: #dc3545;
        --primary-hover: #0a4f94;
    }

    /* Profile Header */
    .profile-header {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
        padding: 6rem 0 10rem;
        position: relative;
        overflow: hidden;
    }

    .profile-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg width="20" height="20" xmlns="http://www.w3.org/2000/svg"><rect width="20" height="20" fill="none"/><circle cx="3" cy="3" r="1" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
    }

    .profile-header::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 180px;
        background: white;
        clip-path: ellipse(65% 65% at 50% 100%);
    }

    .profile-avatar-wrapper {
        position: relative;
        width: 180px;
        height: 180px;
        margin: 0 auto;
    }

    .profile-avatar {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        border: 6px solid white;
        box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        object-fit: cover;
        background: white;
    }

    .profile-name {
        font-size: 2.5rem;
        font-weight: 800;
        margin: var(--spacing-unit) 0;
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    /* Content Layout */
    .profile-content {
        margin-top: -5rem;
        position: relative;
        z-index: 1;
        padding-bottom: 4rem;
    }

    /* Profile Card Enhancements */
    .profile-card {
        background: white;
        border-radius: var(--card-border-radius);
        padding: 1.75rem;
        box-shadow: var(--profile-card-shadow);
        border: 1px solid rgba(0, 0, 0, 0.05);
        margin-bottom: 1.75rem;
        transition: var(--hover-transition);
    }

    .profile-card:hover {
        box-shadow: rgba(17, 12, 46, 0.15) 0px 15px 35px;
        transform: translateY(-2px);
    }

    /* Card Headers and Titles */
    .profile-card h5.section-title,
    .profile-card h5.card-title {
        color: var(--primary-color);
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        position: relative;
        padding-bottom: 1rem;
        border-bottom: 2px solid rgba(43, 60, 107, 0.1);
    }

    .profile-card h5.section-title i,
    .profile-card h5.card-title i {
        color: var(--primary-light);
        font-size: 1.2em;
        opacity: 0.9;
    }

    /* Timeline Enhancements */
    .timeline-container {
        position: relative;
        padding-left: 1.5rem;
    }

    .timeline-item {
        position: relative;
        padding-bottom: 2rem;
        border-left: 2px solid rgba(43, 60, 107, 0.15);
        padding-left: 1.5rem;
    }

    .timeline-item:last-child {
        padding-bottom: 0;
        border-left: 2px solid transparent;
    }

    .timeline-item.current-position {
        border-left: 2px solid var(--success-color);
    }

    .timeline-marker {
        position: absolute;
        left: -0.5rem;
        top: 0;
        width: 1rem;
        height: 1rem;
        border-radius: 50%;
        background: #fff;
        border: 2px solid var(--primary-color);
        box-shadow: 0 0 0 4px rgba(43, 60, 107, 0.1);
        z-index: 1;
    }

    .timeline-item.current-position .timeline-marker {
        background: #fff;
        border: 2px solid var(--success-color);
        box-shadow: 0 0 0 4px rgba(40, 167, 69, 0.2);
    }

    .timeline-content {
        background: #ffffff;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: rgba(0, 0, 0, 0.04) 0px 4px 16px;
        border: 1px solid rgba(0, 0, 0, 0.05);
        transition: var(--hover-transition);
    }

    .timeline-content:hover {
        box-shadow: rgba(0, 0, 0, 0.08) 0px 8px 24px;
        transform: translateY(-2px);
    }

    .timeline-title {
        color: var(--text-primary);
        font-weight: 600;
        font-size: 1.2rem;
        margin-bottom: 0.2rem;
        line-height: 1.4;
    }

    .timeline-subtitle {
        color: var(--primary-color);
        font-weight: 500;
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
    }

    .timeline-info {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin: 0.75rem 0;
        font-size: 0.9rem;
        color: var(--text-secondary);
    }

    .timeline-info .date-range,
    .timeline-info .location {
        display: flex;
        align-items: center;
    }

    .timeline-info i {
        margin-right: 0.4rem;
        opacity: 0.7;
    }

    .timeline-actions {
        display: flex;
        gap: 0.5rem;
    }

    .timeline-achievements h6,
    .timeline-skills h6 {
        font-size: 0.95rem;
        margin-bottom: 0.75rem;
        color: var(--primary-color);
        font-weight: 600;
        display: flex;
        align-items: center;
    }

    .timeline-achievements .card,
    .timeline-body .card {
        border: none;
        background-color: #f8f9fa;
        border-radius: 8px;
    }

    .timeline-achievements .card-body,
    .timeline-body .card-body {
        padding: 1rem;
        font-size: 0.95rem;
        color: var(--text-primary);
    }

    .skill-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .skill-tags .badge {
        padding: 0.5rem 0.75rem;
        font-weight: 500;
        background-color: #e9ecef;
        color: var(--text-primary);
        border-radius: 6px;
    }

    /* Enhanced Empty State */
    .empty-state {
        text-align: center;
        padding: 2.5rem;
        background: #f8f9fa;
        border-radius: 12px;
        margin-bottom: 1rem;
    }

    .empty-state i {
        font-size: 2.5rem;
        color: #adb5bd;
        margin-bottom: 1.25rem;
    }

    .empty-state p {
        color: var(--text-secondary);
        margin-bottom: 1.25rem;
        font-size: 1.1rem;
    }

    .empty-state .btn {
        min-width: 140px;
    }

    /* Consistent Button Styling */
    .btn-primary {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
    }

    .btn-primary:hover {
        background-color: var(--primary-hover);
        border-color: var(--primary-hover);
    }

    .btn-outline-primary {
        color: var(--primary-color);
        border-color: var(--primary-color);
    }

    .btn-outline-primary:hover {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
    }

    /* Badge Styling */
    .badge {
        font-weight: 500;
        padding: 0.4rem 0.7rem;
        border-radius: 6px;
    }

    .badge.bg-success {
        background-color: #28a745 !important;
    }

    .badge.bg-info {
        background-color: #17a2b8 !important;
    }

    .badge.bg-light {
        background-color: #f8f9fa !important;
        color: var(--text-primary) !important;
        border: 1px solid #e9ecef;
    }

    .badge.bg-primary {
        background-color: var(--primary-color) !important;
    }

    /* Tab Navigation */
    .nav-tabs {
        border-bottom: 1px solid rgba(0,0,0,0.1);
        margin-bottom: 1.5rem;
    }

    .nav-tabs .nav-link {
        color: var(--text-secondary);
        padding: 0.75rem 1.25rem;
        border: none;
        border-bottom: 3px solid transparent;
        font-weight: 500;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .nav-tabs .nav-link i {
        font-size: 0.9rem;
    }

    .nav-tabs .nav-link:hover {
        color: var(--primary-color);
        border-bottom-color: rgba(6, 57, 112, 0.3);
    }

    .nav-tabs .nav-link.active {
        color: var(--primary-color);
        border-bottom-color: var(--primary-color);
        background-color: transparent;
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
        .profile-header {
            padding: 4rem 0 8rem;
        }

        .profile-card {
            padding: 1.25rem;
        }

        .timeline-content {
            padding: 1.25rem;
        }

        .timeline-info {
            flex-direction: column;
            gap: 0.5rem;
        }

        .nav-tabs .nav-link {
            padding: 0.5rem 0.75rem;
            font-size: 0.9rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Profile Header Card - Compact Version -->
    <div class="profile-card mb-4">
        <div class="row g-0 align-items-center">
            <div class="col-auto">
                {% if profile.avatar %}
                    <img src="{{ profile.avatar.url }}" alt="Profile Avatar" class="rounded-circle" style="width: 100px; height: 100px; object-fit: cover; border: 3px solid #fff; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
                {% else %}
                    <div class="rounded-circle bg-light d-flex align-items-center justify-content-center" style="width: 100px; height: 100px; border: 3px solid #fff; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
                        <i class="fas fa-user fa-2x text-secondary"></i>
                    </div>
                {% endif %}
            </div>
            <div class="col ps-4">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="d-flex align-items-center">
                        <h3 class="mb-1">{{ profile.user.get_full_name }}</h3>
                            {% if is_mentor %}
                            <span class="badge bg-success ms-2" style="font-size: 0.7rem; padding: 0.35rem 0.65rem;">
                                <i class="fas fa-check-circle me-1"></i> Verified Mentor
                            </span>
                            {% endif %}
                        </div>
                        <p class="text-muted mb-2">{{ profile.user.email }}</p>
                    </div>
                    <div>
                        {% if is_own_profile %}
                        <div class="d-flex gap-2">
                        <a href="{% url 'accounts:edit_profile' %}" class="btn btn-primary">
                                <i class="fas fa-edit me-1"></i> Edit Profile
                            </a>
                            {% if not is_mentor and not has_pending_application %}
                            <a href="{% url 'accounts:apply_mentor' %}" class="btn btn-success">
                                <i class="fas fa-chalkboard-teacher me-1"></i> Apply as Mentor
                            </a>
                            {% elif has_pending_application %}
                            <a href="{% url 'accounts:mentor_application_status' %}" class="btn btn-warning">
                                <i class="fas fa-hourglass-half me-1"></i> Application Status
                        </a>
                        {% endif %}
                        </div>
                        {% endif %}
                        <div class="social-links mt-2 d-flex gap-2">
                            {% if profile.linkedin_profile %}
                                <a href="{{ profile.linkedin_profile }}" class="btn btn-sm btn-outline-primary" target="_blank">
                                    <i class="fab fa-linkedin-in"></i>
                                </a>
                            {% endif %}
                            {% if profile.facebook_profile %}
                                <a href="{{ profile.facebook_profile }}" class="btn btn-sm btn-outline-primary" target="_blank">
                                    <i class="fab fa-facebook-f"></i>
                                </a>
                            {% endif %}
                            {% if profile.twitter_profile %}
                                <a href="{{ profile.twitter_profile }}" class="btn btn-sm btn-outline-primary" target="_blank">
                                    <i class="fab fa-twitter"></i>
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% if profile.bio %}
                    <p class="small text-muted mb-0">{{ profile.bio|truncatewords:30 }}</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="row g-4">
        <!-- Left Column - Essential Information -->
        <div class="col-lg-4">
            <!-- Personal Information -->
            <div class="profile-card">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="section-title mb-0">
                        <i class="fas fa-user"></i> Personal Information
                    </h5>
                    <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editPersonalInfoModal">
                        <i class="fas fa-edit me-1"></i> Edit
                    </button>
                </div>
                <div class="info-list">
                <div class="row g-3">
                    <div class="col-md-6">
                            <div class="info-item">
                        <label class="text-muted small mb-1">Email</label>
                        <div class="d-flex align-items-center">
                            <i class="fas fa-envelope text-primary me-2"></i>
                                    <a href="mailto:{{ profile.user.email }}" class="text-decoration-none text-body">{{ profile.user.email }}</a>
                                </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                            <div class="info-item">
                        <label class="text-muted small mb-1">Phone</label>
                        <div class="d-flex align-items-center">
                            <i class="fas fa-phone text-primary me-2"></i>
                            {% if profile.phone_number %}
                                    <a href="tel:{{ profile.phone_number }}" class="text-decoration-none text-body">{{ profile.phone_number }}</a>
                            {% else %}
                            <span class="text-muted">Not provided</span>
                            {% endif %}
                                </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                            <div class="info-item">
                        <label class="text-muted small mb-1">Date of Birth</label>
                        <div class="d-flex align-items-center">
                            <i class="fas fa-calendar text-primary me-2"></i>
                                    {% if profile.birth_date %}
                                    <span>{{ profile.birth_date|date:"F d, Y" }}</span>
                                    {% else %}
                                    <span class="text-muted">Not provided</span>
                                    {% endif %}
                                </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                            <div class="info-item">
                        <label class="text-muted small mb-1">Gender</label>
                        <div class="d-flex align-items-center">
                            <i class="fas fa-venus-mars text-primary me-2"></i>
                                    {% if profile.gender %}
                                    <span>{{ profile.get_gender_display }}</span>
                                    {% else %}
                                    <span class="text-muted">Not provided</span>
                                    {% endif %}
                                </div>
                        </div>
                    </div>
                    <div class="col-12">
                            <div class="info-item">
                        <label class="text-muted small mb-1">Address</label>
                        <div class="d-flex align-items-center">
                            <i class="fas fa-map-marker-alt text-primary me-2"></i>
                                    {% if profile.address %}
                                    <span>{{ profile.address }}, {{ profile.city }}, {{ profile.state }}, {{ profile.country.name }}</span>
                                    {% else %}
                                    <span class="text-muted">Not provided</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {% if is_mentor %}
            <!-- Mentor Information -->
            <div class="profile-card">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="section-title mb-0">
                        <i class="fas fa-chalkboard-teacher"></i> Mentor Information
                    </h5>
                    {% if is_own_profile %}
                    <a href="{% url 'mentorship:mentor_dashboard' %}" class="btn btn-success btn-sm">
                        <i class="fas fa-tachometer-alt"></i> Mentor Dashboard
                    </a>
                    {% endif %}
                </div>
                <div class="row g-3">
                    <div class="col-12">
                        <div class="d-flex align-items-center mb-3">
                            <span class="badge bg-success me-2">
                                <i class="fas fa-check-circle"></i>
                            </span>
                            <span class="fw-bold">Verified Mentor</span>
                        </div>
                        <div class="mb-3">
                            <label class="text-muted small mb-1">Expertise Areas</label>
                            <div class="d-flex flex-wrap gap-1 mt-1">
                                {% for area in profile.user.mentor.expertise_areas.all %}
                                <span class="badge bg-info">{{ area.name }}</span>
                                {% empty %}
                                <span class="text-muted">No expertise areas specified</span>
                                {% endfor %}
                            </div>
                        </div>
                        {% if not is_own_profile %}
                        <div class="mt-3">
                            <a href="{% url 'mentorship:request_mentorship' profile.user.id %}" class="btn btn-primary btn-sm">
                                <i class="fas fa-user-plus"></i> Request Mentorship
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Skills Section -->
            <div class="profile-card">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="section-title mb-0">
                        <i class="fas fa-star"></i> Skills
                    </h5>
                    <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addSkillModal">
                        <i class="fas fa-plus me-1"></i> Add Skill
                    </button>
                </div>
                {% if skill_list %}
                    {% regroup skill_list by get_skill_type_display as skill_list_grouped %}
                    {% for skill_type in skill_list_grouped %}
                        <div class="mb-3">
                            <h6 class="mb-2 text-primary">
                                <i class="fas fa-layer-group me-2"></i>{{ skill_type.grouper }}
                            </h6>
                            <div class="skill-tags">
                            {% for skill in skill_type.list %}
                                    <span class="badge bg-light mb-2 me-2 p-2">
                                        {{ skill.name }}
                                        <span class="badge bg-primary ms-1">{{ skill.get_proficiency_level_display }}</span>
                                    </span>
                                {% endfor %}
                                    </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-star"></i>
                        <p>No skills added yet</p>
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addSkillModal">
                            <i class="fas fa-plus me-1"></i> Add Skill
                        </button>
                    </div>
                {% endif %}
            </div>

            <!-- Documents Section -->
            <div class="profile-card">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="section-title mb-0">
                        <i class="fas fa-file-alt"></i> Documents
                    </h5>
                    <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addDocumentModal">
                        <i class="fas fa-plus me-1"></i> Add Document
                    </button>
                </div>
                {% if profile.documents.all %}
                    <div class="document-list">
                    {% for document in profile.documents.all %}
                        <div class="document-item mb-3 p-3 bg-light rounded d-flex align-items-center">
                            <div class="document-icon me-3">
                                <i class="fas fa-file-pdf fa-2x text-primary"></i>
                                </div>
                            <div class="document-info">
                                <h6 class="mb-1">{{ document.title }}</h6>
                                <div class="small text-muted">
                                    <span class="badge bg-secondary me-2">{{ document.get_document_type_display }}</span>
                                    <span>Uploaded: {{ document.created_at|date:"M d, Y" }}</span>
                                </div>
                            </div>
                            <div class="ms-auto">
                                <a href="{{ document.file.url }}" class="btn btn-sm btn-outline-primary me-2" target="_blank">
                                        <i class="fas fa-download"></i>
                                    </a>
                                    <form action="{% url 'accounts:document_delete' document.pk %}" method="post" class="d-inline">
                                        {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-outline-danger">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </form>
                            </div>
                        </div>
                    {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-file-alt"></i>
                        <p>No documents uploaded yet</p>
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addDocumentModal">
                            <i class="fas fa-plus me-1"></i> Add Document
                        </button>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Right Column - Experience & Education -->
        <div class="col-lg-8">
            <!-- Education Section -->
            <div class="profile-card">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="section-title mb-0">
                        <i class="fas fa-graduation-cap"></i> Education
                    </h5>
                    <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addEducationModal">
                        <i class="fas fa-plus me-1"></i> Add Education
                    </button>
                </div>
                
                {% if education_list %}
                    <div class="timeline-container">
                        {% for education in education_list %}
                            <div class="timeline-item {% if education.is_primary %}current-position{% endif %}">
                                <div class="timeline-marker"></div>
                                <div class="timeline-content">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h4 class="timeline-title">{{ education.program }}</h4>
                                            <h5 class="timeline-subtitle">{{ education.school }}</h5>
                                            {% if education.major %}
                                            <div class="text-muted mb-1">Major in {{ education.major }}</div>
                                            {% endif %}
                                        </div>
                                        {% if is_own_profile %}
                                        <div class="timeline-actions">
                                            <button type="button" class="btn btn-sm btn-outline-primary" 
                                                    data-bs-toggle="modal" 
                                                    data-bs-target="#editEducationModal{{ education.id }}">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            {% if not education.is_primary %}
                                            <button type="button" class="btn btn-sm btn-outline-danger delete-button" 
                                                        data-bs-toggle="modal" 
                                                        data-bs-target="#confirmDeleteModal"
                                                        data-item-id="{{ education.id }}"
                                                        data-item-type="education">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            {% endif %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="timeline-info">
                                        <span class="date-range">
                                            <i class="far fa-calendar-alt"></i>
                                            Graduated {{ education.graduation_year }}
                                        </span>
                                        {% if education.location %}
                                        <span class="location">
                                            <i class="fas fa-map-marker-alt"></i>
                                            {{ education.location }}
                                        </span>
                                        {% endif %}
                                        {% if education.is_primary %}
                                        <span class="badge bg-primary">Primary Education</span>
                {% endif %}
            </div>

                                    {% if education.achievements %}
                                    <div class="timeline-achievements mt-3">
                                        <h6>
                                            <i class="fas fa-trophy me-2"></i>Achievements
                                        </h6>
                                        <div class="card">
                                            <div class="card-body">
                                                {{ education.achievements|linebreaks }}
                </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-graduation-cap"></i>
                        <p>No education history added yet</p>
                        {% if is_own_profile %}
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addEducationModal">
                            <i class="fas fa-plus me-1"></i> Add Education
                        </button>
                        {% endif %}
                    </div>
                {% endif %}
            </div>

            <!-- Professional Experience -->
            <div class="profile-card">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="section-title mb-0">
                        <i class="fas fa-briefcase"></i> Professional Experience
                    </h5>
                    {% if is_own_profile %}
                    <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addExperienceModal">
                        <i class="fas fa-plus me-1"></i> Add Experience
                    </button>
                    {% endif %}
                </div>
                
                <ul class="nav nav-tabs" id="experienceTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="all-experience-tab" data-bs-toggle="tab" data-bs-target="#all-experience" type="button" role="tab" aria-controls="all-experience" aria-selected="true">
                            <i class="fas fa-th-list"></i> All Experience
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="career-path-tab" data-bs-toggle="tab" data-bs-target="#career-path" type="button" role="tab" aria-controls="career-path" aria-selected="false">
                            <i class="fas fa-route"></i> Career Path
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="work-experience-tab" data-bs-toggle="tab" data-bs-target="#work-experience" type="button" role="tab" aria-controls="work-experience" aria-selected="false">
                            <i class="fas fa-building"></i> Work Experience
                        </button>
                    </li>
                </ul>
                <div class="tab-content" id="experienceTabsContent">
                    <!-- All Experience Tab -->
                    <div class="tab-pane fade show active" id="all-experience" role="tabpanel" aria-labelledby="all-experience-tab">
                        {% if unified_experience %}
                        <div class="timeline-container">
                            {% for exp in unified_experience %}
                            <div class="timeline-item {% if exp.is_current %}current-position{% endif %}">
                                <div class="timeline-marker"></div>
                                <div class="timeline-content">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h4 class="timeline-title">{{ exp.position }}</h4>
                                            <h5 class="timeline-subtitle">{{ exp.company }}</h5>
                                                </div>
                                        {% if is_own_profile %}
                                        <div class="timeline-actions">
                                            <button type="button" class="btn btn-sm btn-outline-primary" 
                                                    data-item-id="{{ exp.id }}" 
                                                    data-item-type="experience"
                                                    data-bs-toggle="modal" 
                                                    data-bs-target="#editExperienceModal{{ exp.id }}">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button type="button" class="btn btn-sm btn-outline-danger" 
                                                    data-item-id="{{ exp.id }}" 
                                                    data-item-type="experience"
                                                    data-bs-toggle="modal" 
                                                    data-bs-target="#deleteExperienceModal{{ exp.id }}">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="timeline-info">
                                        <span class="date-range">
                                            <i class="far fa-calendar-alt"></i>
                                            {{ exp.start_date|date:"M Y" }}{% if exp.end_date %} - {{ exp.end_date|date:"M Y" }}{% elif exp.is_current %} - <span class="badge bg-success">Present</span>{% endif %}
                                        </span>
                                        {% if exp.location %}
                                        <span class="location">
                                            <i class="fas fa-map-marker-alt"></i>
                                            {{ exp.location }}
                                        </span>
                                        {% endif %}
                                        {% if exp.career_significance != 'REGULAR' %}
                                        <span class="badge bg-info">{{ exp.get_career_significance_display }}</span>
                                        {% endif %}
                                </div>
                                    
                                    {% if exp.description %}
                                    <div class="timeline-body mt-3">
                                        <div class="card">
                                            <div class="card-body">
                                                {{ exp.description|linebreaks }}
                            </div>
                    </div>
                                    </div>
                {% endif %}
                                    
                                    {% if exp.achievements %}
                                    <div class="timeline-achievements mt-3">
                                        <h6>
                                            <i class="fas fa-trophy me-2"></i>Key Achievements
                                        </h6>
                                        <div class="card">
                                            <div class="card-body">
                                                {{ exp.achievements|linebreaks }}
            </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                    
                                    {% if exp.skills_gained %}
                                    <div class="timeline-skills mt-3">
                                        <h6>
                                            <i class="fas fa-tools me-2"></i>Skills Gained
                                        </h6>
                                        <div class="skill-tags">
                                            {% for skill in exp.skills_gained|split:"," %}
                                            <span class="badge bg-light">{{ skill|strip }}</span>
                                            {% endfor %}
                </div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                                        {% else %}
                        <div class="empty-state">
                            <i class="fas fa-briefcase"></i>
                            <p>No professional experience added yet</p>
                            {% if is_own_profile %}
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addExperienceModal">
                                <i class="fas fa-plus me-1"></i> Add Experience
                            </button>
                                        {% endif %}
                                    </div>
                                        {% endif %}
                                    </div>
                    
                    <!-- Career Path Tab -->
                    <div class="tab-pane fade" id="career-path" role="tabpanel" aria-labelledby="career-path-tab">
                        {% if career_path %}
                        <div class="timeline-container">
                            {% for exp in career_path %}
                            <div class="timeline-item {% if exp.is_current %}current-position{% endif %}">
                                <div class="timeline-marker"></div>
                                <div class="timeline-content">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h4 class="timeline-title">{{ exp.position }}</h4>
                                            <h5 class="timeline-subtitle">{{ exp.company }}</h5>
                                        </div>
                                        {% if is_own_profile %}
                                        <div class="timeline-actions">
                                            <button type="button" class="btn btn-sm btn-outline-primary" 
                                                    data-item-id="{{ exp.id }}" 
                                                    data-item-type="experience"
                                                data-bs-toggle="modal" 
                                                    data-bs-target="#editExperienceModal{{ exp.id }}">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-danger" 
                                                    data-item-id="{{ exp.id }}" 
                                                    data-item-type="experience"
                                                data-bs-toggle="modal" 
                                                    data-bs-target="#deleteExperienceModal{{ exp.id }}">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                        {% endif %}
                                </div>
                                    
                                    <div class="timeline-info">
                                        <span class="date-range">
                                            <i class="far fa-calendar-alt"></i>
                                            {{ exp.start_date|date:"M Y" }}{% if exp.end_date %} - {{ exp.end_date|date:"M Y" }}{% elif exp.is_current %} - <span class="badge bg-success">Present</span>{% endif %}
                                        </span>
                                        {% if exp.location %}
                                        <span class="location">
                                            <i class="fas fa-map-marker-alt"></i>
                                            {{ exp.location }}
                                        </span>
                                {% endif %}
                                        {% if exp.career_significance != 'REGULAR' %}
                                        <span class="badge bg-info">{{ exp.get_career_significance_display }}</span>
                                        {% endif %}
                                    </div>
                                    
                                    {% if exp.description %}
                                    <div class="timeline-body mt-3">
                                        <div class="card">
                                            <div class="card-body">
                                                {{ exp.description|linebreaks }}
                            </div>
                    </div>
            </div>
                                {% endif %}
                                    
                                    {% if exp.achievements %}
                                    <div class="timeline-achievements mt-3">
                                        <h6>
                                            <i class="fas fa-trophy me-2"></i>Key Achievements
                                        </h6>
                                        <div class="card">
                                            <div class="card-body">
                                                {{ exp.achievements|linebreaks }}
                            </div>
                            </div>
                            </div>
                        {% endif %}
                                    
                                    {% if exp.skills_gained %}
                                    <div class="timeline-skills mt-3">
                                        <h6>
                                            <i class="fas fa-tools me-2"></i>Skills Gained
                                        </h6>
                                        <div class="skill-tags">
                                            {% for skill in exp.skills_gained|split:"," %}
                                            <span class="badge bg-light">{{ skill|strip }}</span>
                                            {% endfor %}
                    </div>
                </div>
                                    {% endif %}
            </div>
        </div>
                            {% endfor %}
    </div>
                        {% else %}
                        <div class="empty-state">
                            <i class="fas fa-route"></i>
                            <p>No career path information added yet</p>
                            {% if is_own_profile %}
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addExperienceModal">
                                <i class="fas fa-plus me-1"></i> Add Career Path
                            </button>
                            {% endif %}
                        </div>
                        {% endif %}
</div>

                    <!-- Work Experience Tab -->
                    <div class="tab-pane fade" id="work-experience" role="tabpanel" aria-labelledby="work-experience-tab">
                        {% if work_experience %}
                        <div class="timeline-container">
                            {% for exp in work_experience %}
                            <div class="timeline-item {% if exp.is_current %}current-position{% endif %}">
                                <div class="timeline-marker"></div>
                                <div class="timeline-content">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h4 class="timeline-title">{{ exp.position }}</h4>
                                            <h5 class="timeline-subtitle">{{ exp.company }}</h5>
            </div>
                                        {% if is_own_profile %}
                                        <div class="timeline-actions">
                                            <button type="button" class="btn btn-sm btn-outline-primary" 
                                                    data-item-id="{{ exp.id }}" 
                                                    data-item-type="experience"
                                                    data-bs-toggle="modal" 
                                                    data-bs-target="#editExperienceModal{{ exp.id }}">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button type="button" class="btn btn-sm btn-outline-danger" 
                                                    data-item-id="{{ exp.id }}" 
                                                    data-item-type="experience"
                                                    data-bs-toggle="modal" 
                                                    data-bs-target="#deleteExperienceModal{{ exp.id }}">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                        {% endif %}
                    </div>

                                    <div class="timeline-info">
                                        <span class="date-range">
                                            <i class="far fa-calendar-alt"></i>
                                            {{ exp.start_date|date:"M Y" }}{% if exp.end_date %} - {{ exp.end_date|date:"M Y" }}{% elif exp.is_current %} - <span class="badge bg-success">Present</span>{% endif %}
                                        </span>
                                        {% if exp.location %}
                                        <span class="location">
                                            <i class="fas fa-map-marker-alt"></i>
                                            {{ exp.location }}
                                        </span>
                                        {% endif %}
                    </div>

                                    {% if exp.description %}
                                    <div class="timeline-body mt-3">
                                        <div class="card">
                                            <div class="card-body">
                                                {{ exp.description|linebreaks }}
                    </div>
            </div>
            </div>
                                    {% endif %}
                                    
                                    {% if exp.achievements %}
                                    <div class="timeline-achievements mt-3">
                                        <h6>
                                            <i class="fas fa-trophy me-2"></i>Key Achievements
                                        </h6>
                                        <div class="card">
                                            <div class="card-body">
                                                {{ exp.achievements|linebreaks }}
            </div>
                    </div>
                    </div>
                                    {% endif %}
                                    
                                    {% if exp.skills_gained %}
                                    <div class="timeline-skills mt-3">
                                        <h6>
                                            <i class="fas fa-tools me-2"></i>Skills Gained
                                        </h6>
                                        <div class="skill-tags">
                                            {% for skill in exp.skills_gained|split:"," %}
                                            <span class="badge bg-light">{{ skill|strip }}</span>
                                            {% endfor %}
                    </div>
                            </div>
                                    {% endif %}
                        </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="empty-state">
                            <i class="fas fa-building"></i>
                            <p>No work experience added yet</p>
                            {% if is_own_profile %}
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addExperienceModal">
                                <i class="fas fa-plus me-1"></i> Add Experience
                            </button>
                            {% endif %}
                    </div>
                        {% endif %}
                        </div>
                    </div>
                    </div>
        </div>
    </div>
</div>

<!-- Add Experience Modal -->
<div class="modal fade" id="addExperienceModal" tabindex="-1" aria-labelledby="experienceModalLabel" aria-modal="true" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="experienceModalLabel">Add Work Experience</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="experienceForm" method="post" action="{% url 'accounts:update_experience' %}" class="needs-validation">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label for="id_company" class="form-label">Company</label>
                        <input type="text" name="company" id="id_company" class="form-control" required>
                    </div>
                        </div>
                        <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label for="id_position" class="form-label">Position</label>
                        <input type="text" name="position" id="id_position" class="form-control" required>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label for="id_location" class="form-label">Location</label>
                        <input type="text" name="location" id="id_location" class="form-control">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="id_career_significance" class="form-label">Type of Position</label>
                                <select name="career_significance" id="id_career_significance" class="form-select">
                                    <option value="REGULAR">Regular Position</option>
                                    <option value="PROMOTION">Promotion</option>
                                    <option value="LATERAL">Lateral Move</option>
                                    <option value="NEW_ROLE">New Role</option>
                                    <option value="COMPANY_CHANGE">Company Change</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-5">
                            <div class="form-group mb-3">
                                <label for="id_start_date" class="form-label">Start Date</label>
                                <input type="date" name="start_date" id="id_start_date" class="form-control" required>
                            </div>
                        </div>
                        <div class="col-md-5">
                            <div class="form-group mb-3">
                                <label for="id_end_date" class="form-label">End Date</label>
                                <input type="date" name="end_date" id="id_end_date" class="form-control">
                            </div>
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                    <div class="form-group mb-3">
                        <div class="form-check">
                            <input type="checkbox" name="is_current" id="id_is_current" class="form-check-input">
                                    <label for="id_is_current" class="form-check-label">Current Job</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_salary_range" class="form-label">Salary Range (Optional)</label>
                        <input type="text" name="salary_range" id="id_salary_range" class="form-control" placeholder="e.g., $50,000-$70,000">
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_description" class="form-label">Job Description</label>
                        <textarea name="description" id="id_description" class="form-control" rows="3" required></textarea>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_achievements" class="form-label">Key Achievements</label>
                        <textarea name="achievements" id="id_achievements" class="form-control" rows="3" placeholder="List your key achievements in this role"></textarea>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_skills_gained" class="form-label">Skills Gained</label>
                        <textarea name="skills_gained" id="id_skills_gained" class="form-control" rows="2" placeholder="Enter skills separated by commas"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" form="experienceForm">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Document Modal -->
<div class="modal fade" id="addDocumentModal" tabindex="-1" aria-labelledby="documentModalLabel" aria-modal="true" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="documentModalLabel">Add Document</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="documentForm" method="post" action="{% url 'accounts:update_documents' %}" class="needs-validation" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="form-group mb-3">
                        <label for="id_title" class="form-label">Document Title</label>
                        <input type="text" name="title" id="id_title" class="form-control" required>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_document_type" class="form-label">Document Type</label>
                        <select name="document_type" id="id_document_type" class="form-select" required>
                            <option value="">Select document type</option>
                            <option value="certificate">Certificate</option>
                            <option value="transcript">Transcript</option>
                            <option value="resume">Resume/CV</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_file" class="form-label">File</label>
                        <input type="file" name="file" id="id_file" class="form-control" required>
                        <div class="form-text">Maximum file size: 5MB. Supported formats: PDF, DOC, DOCX</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" form="documentForm">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Education Edit Modals -->
{% for education in education_list %}
<div class="modal fade" id="editEducationModal{{ education.id }}" tabindex="-1" aria-labelledby="editEducationModalLabel{{ education.id }}" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editEducationModalLabel{{ education.id }}">Edit Education</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editEducationForm{{ education.id }}" method="post" action="{% url 'accounts:edit_education' education.id %}" class="needs-validation">
                    {% csrf_token %}
                    <div class="form-group mb-3">
                        <label for="id_program{{ education.id }}" class="form-label">Program</label>
                        <select name="program" id="id_program{{ education.id }}" class="form-select" required>
                            <option value="">Select program</option>
                            <option value="BSIT" {% if education.program == 'BSIT' %}selected{% endif %}>Bachelor of Science in Information Technology</option>
                            <option value="BSCS" {% if education.program == 'BSCS' %}selected{% endif %}>Bachelor of Science in Computer Science</option>
                            <option value="BSIS" {% if education.program == 'BSIS' %}selected{% endif %}>Bachelor of Science in Information Systems</option>
                            <option value="BSA" {% if education.program == 'BSA' %}selected{% endif %}>Bachelor of Science in Accountancy</option>
                            <option value="BSBA" {% if education.program == 'BSBA' %}selected{% endif %}>Bachelor of Science in Business Administration</option>
                            <option value="BEED" {% if education.program == 'BEED' %}selected{% endif %}>Bachelor of Elementary Education</option>
                            <option value="BSED" {% if education.program == 'BSED' %}selected{% endif %}>Bachelor of Secondary Education</option>
                            <option value="BSN" {% if education.program == 'BSN' %}selected{% endif %}>Bachelor of Science in Nursing</option>
                            <option value="BSCRIM" {% if education.program == 'BSCRIM' %}selected{% endif %}>Bachelor of Science in Criminology</option>
                            <option value="BSHRM" {% if education.program == 'BSHRM' %}selected{% endif %}>Bachelor of Science in Hotel and Restaurant Management</option>
                            <option value="BSTM" {% if education.program == 'BSTM' %}selected{% endif %}>Bachelor of Science in Tourism Management</option>
                            <option value="BSE" {% if education.program == 'BSE' %}selected{% endif %}>Bachelor of Science in Engineering</option>
                            <option value="BSP" {% if education.program == 'BSP' %}selected{% endif %}>Bachelor of Science in Psychology</option>
                            <option value="OTHER" {% if education.program == 'OTHER' %}selected{% endif %}>Other Program</option>
                        </select>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_major{{ education.id }}" class="form-label">Major/Specialization</label>
                        <input type="text" name="major" id="id_major{{ education.id }}" class="form-control" value="{{ education.major }}">
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_school{{ education.id }}" class="form-label">School/Campus</label>
                        <select name="school" id="id_school{{ education.id }}" class="form-select" required>
                            <option value="">Select campus</option>
                            <option value="NORSU-G" {% if education.school == 'NORSU-G' %}selected{% endif %}>NORSU Guihulngan</option>
                            <option value="NORSU-BC" {% if education.school == 'NORSU-BC' %}selected{% endif %}>NORSU Bais City</option>
                            <option value="NORSU-MB" {% if education.school == 'NORSU-MB' %}selected{% endif %}>NORSU Mabinay</option>
                            <option value="NORSU-SC" {% if education.school == 'NORSU-SC' %}selected{% endif %}>NORSU Siaton</option>
                            <option value="NORSU-PC" {% if education.school == 'NORSU-PC' %}selected{% endif %}>NORSU Pamplona</option>
                            <option value="NORSU-SCC" {% if education.school == 'NORSU-SCC' %}selected{% endif %}>NORSU Sta. Catalina</option>
                            <option value="NORSU-VC" {% if education.school == 'NORSU-VC' %}selected{% endif %}>NORSU Valencia</option>
                            <option value="OTHER" {% if education.school == 'OTHER' %}selected{% endif %}>Other Campus</option>
                        </select>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_graduation_year{{ education.id }}" class="form-label">Graduation Year</label>
                        <input type="number" name="graduation_year" id="id_graduation_year{{ education.id }}" class="form-control" min="1950" max="2099" value="{{ education.graduation_year }}" required>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_achievements{{ education.id }}" class="form-label">Achievements</label>
                        <textarea name="achievements" id="id_achievements{{ education.id }}" class="form-control" rows="3">{{ education.achievements }}</textarea>
                    </div>

                    <div class="form-group mb-3">
                        <div class="form-check">
                            <input type="checkbox" name="is_primary" id="id_is_primary{{ education.id }}" class="form-check-input" {% if education.is_primary %}checked{% endif %}>
                            <label for="id_is_primary{{ education.id }}" class="form-check-label">This is my primary education</label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" form="editEducationForm{{ education.id }}">Save Changes</button>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<!-- Add Career Path Modal -->
<div class="modal fade" id="addCareerPathModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Career Path</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="careerPathForm" method="post" action="{% url 'accounts:add_career_path' %}">
                    {% csrf_token %}
                    <div class="form-group mb-3">
                        <label for="company" class="form-label">Company</label>
                        <input type="text" name="company" id="company" class="form-control" required>
                    </div>
                    <div class="form-group mb-3">
                        <label for="position" class="form-label">Position</label>
                        <input type="text" name="position" id="position" class="form-control" required>
                    </div>
                    <div class="form-group mb-3">
                        <label for="location" class="form-label">Location</label>
                        <input type="text" name="location" id="location" class="form-control">
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="start_date" class="form-label">Start Date</label>
                                <input type="date" name="start_date" id="start_date" class="form-control" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="end_date" class="form-label">End Date</label>
                                <input type="date" name="end_date" id="end_date" class="form-control">
                            </div>
                        </div>
                    </div>
                    <div class="form-group mb-3">
                        <div class="form-check">
                            <input type="checkbox" name="is_current" id="is_current" class="form-check-input">
                            <label for="is_current" class="form-check-label">Current Position</label>
                        </div>
                    </div>
                    <div class="form-group mb-3">
                        <label for="career_significance" class="form-label">Type of Change</label>
                        <select name="career_significance" id="career_significance" class="form-select">
                            <option value="">Select type</option>
                            <option value="PROMOTION">Promotion</option>
                            <option value="LATERAL">Lateral Move</option>
                            <option value="NEW_ROLE">New Role</option>
                            <option value="COMPANY_CHANGE">Company Change</option>
                        </select>
                    </div>
                    <div class="form-group mb-3">
                        <label for="salary_range" class="form-label">Salary Range (Optional)</label>
                        <input type="text" name="salary_range" id="salary_range" class="form-control">
                    </div>
                    <div class="form-group mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea name="description" id="description" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="form-group mb-3">
                        <label for="achievements" class="form-label">Key Achievements</label>
                        <textarea name="achievements" id="achievements" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="form-group mb-3">
                        <label for="skills_gained" class="form-label">Skills Gained</label>
                        <input type="text" name="skills_gained" id="skills_gained" class="form-control" placeholder="Enter skills separated by commas">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" form="careerPathForm">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Achievement Modal -->
<div class="modal fade" id="addAchievementModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Achievement</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="achievementForm" method="post" action="{% url 'accounts:add_achievement' %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="form-group mb-3">
                        <label for="title" class="form-label">Achievement Title</label>
                        <input type="text" name="title" id="title" class="form-control" required>
                    </div>
                    <div class="form-group mb-3">
                        <label for="achievement_type" class="form-label">Type</label>
                        <select name="achievement_type" id="achievement_type" class="form-select" required>
                            <option value="">Select type</option>
                            <option value="AWARD">Award</option>
                            <option value="CERTIFICATION">Certification</option>
                            <option value="PUBLICATION">Publication</option>
                            <option value="PROJECT">Project</option>
                            <option value="RECOGNITION">Recognition</option>
                            <option value="OTHER">Other</option>
                        </select>
                    </div>
                    <div class="form-group mb-3">
                        <label for="date_achieved" class="form-label">Date Achieved</label>
                        <input type="date" name="date_achieved" id="date_achieved" class="form-control" required>
                    </div>
                    <div class="form-group mb-3">
                        <label for="issuer" class="form-label">Issuer/Organization</label>
                        <input type="text" name="issuer" id="issuer" class="form-control">
                    </div>
                    <div class="form-group mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea name="description" id="description" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="form-group mb-3">
                        <label for="url" class="form-label">URL (Optional)</label>
                        <input type="url" name="url" id="url" class="form-control">
                    </div>
                    <div class="form-group mb-3">
                        <label for="attachment" class="form-label">Attachment</label>
                        <input type="file" name="attachment" id="attachment" class="form-control" accept=".pdf,.jpg,.jpeg,.png">
                        <div class="form-text">Supported formats: PDF, JPG, PNG (Max size: 5MB)</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" form="achievementForm">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Confirm Delete Modal -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmDeleteModalLabel">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this item? This action cannot be undone.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Experience Modals -->
{% for exp in unified_experience %}
<div class="modal fade" id="editExperienceModal{{ exp.id }}" tabindex="-1" aria-labelledby="editExperienceModalLabel{{ exp.id }}" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editExperienceModalLabel{{ exp.id }}">Edit Experience</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editExperienceForm{{ exp.id }}" method="post" action="{% url 'accounts:edit_experience' exp.id %}" class="needs-validation">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="id_company{{ exp.id }}" class="form-label">Company</label>
                                <input type="text" name="company" id="id_company{{ exp.id }}" class="form-control" value="{{ exp.company }}" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="id_position{{ exp.id }}" class="form-label">Position</label>
                                <input type="text" name="position" id="id_position{{ exp.id }}" class="form-control" value="{{ exp.position }}" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_location{{ exp.id }}" class="form-label">Location</label>
                        <input type="text" name="location" id="id_location{{ exp.id }}" class="form-control" value="{{ exp.location }}">
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="id_start_date{{ exp.id }}" class="form-label">Start Date</label>
                                <input type="date" name="start_date" id="id_start_date{{ exp.id }}" class="form-control" value="{{ exp.start_date|date:'Y-m-d' }}" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="id_end_date{{ exp.id }}" class="form-label">End Date</label>
                                <input type="date" name="end_date" id="id_end_date{{ exp.id }}" class="form-control" value="{% if exp.end_date %}{{ exp.end_date|date:'Y-m-d' }}{% endif %}" {% if exp.is_current %}disabled{% endif %}>
                            </div>
                        </div>
                    </div>

                    <div class="form-group mb-3">
                        <div class="form-check">
                            <input type="checkbox" name="is_current" id="id_is_current{{ exp.id }}" class="form-check-input" {% if exp.is_current %}checked{% endif %}>
                            <label for="id_is_current{{ exp.id }}" class="form-check-label">Currently Working Here</label>
                        </div>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_career_significance{{ exp.id }}" class="form-label">Career Significance</label>
                        <select name="career_significance" id="id_career_significance{{ exp.id }}" class="form-select">
                            <option value="REGULAR" {% if exp.career_significance == 'REGULAR' %}selected{% endif %}>Regular Position</option>
                            <option value="PROMOTION" {% if exp.career_significance == 'PROMOTION' %}selected{% endif %}>Promotion</option>
                            <option value="LATERAL" {% if exp.career_significance == 'LATERAL' %}selected{% endif %}>Lateral Move</option>
                            <option value="NEW_ROLE" {% if exp.career_significance == 'NEW_ROLE' %}selected{% endif %}>New Role</option>
                            <option value="COMPANY_CHANGE" {% if exp.career_significance == 'COMPANY_CHANGE' %}selected{% endif %}>Company Change</option>
                        </select>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_description{{ exp.id }}" class="form-label">Description</label>
                        <textarea name="description" id="id_description{{ exp.id }}" class="form-control" rows="3">{{ exp.description }}</textarea>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_salary_range{{ exp.id }}" class="form-label">Salary Range</label>
                        <input type="text" name="salary_range" id="id_salary_range{{ exp.id }}" class="form-control" value="{{ exp.salary_range }}">
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_achievements{{ exp.id }}" class="form-label">Key Achievements</label>
                        <textarea name="achievements" id="id_achievements{{ exp.id }}" class="form-control" rows="3">{{ exp.achievements }}</textarea>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_skills_gained{{ exp.id }}" class="form-label">Skills Gained</label>
                        <textarea name="skills_gained" id="id_skills_gained{{ exp.id }}" class="form-control" rows="2">{{ exp.skills_gained }}</textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" form="editExperienceForm{{ exp.id }}">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Experience Modal -->
<div class="modal fade" id="deleteExperienceModal{{ exp.id }}" tabindex="-1" aria-labelledby="deleteExperienceModalLabel{{ exp.id }}" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteExperienceModalLabel{{ exp.id }}">Delete Experience</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this experience? This action cannot be undone.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger delete-confirm-btn" data-item-id="{{ exp.id }}" data-item-type="experience">Delete</button>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<!-- Education Delete Modals -->
{% for education in education_list %}
{% if not education.is_primary %}
<div class="modal fade" id="deleteEducationModal{{ education.id }}" tabindex="-1" aria-labelledby="deleteEducationModalLabel{{ education.id }}" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteEducationModalLabel{{ education.id }}">Delete Education</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this education record? This action cannot be undone.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger delete-confirm-btn" data-item-id="{{ education.id }}" data-item-type="education">Delete</button>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endfor %}

<!-- Add Education Modal -->
<div class="modal fade" id="addEducationModal" tabindex="-1" aria-labelledby="addEducationModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addEducationModalLabel">Add Education</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="educationForm" method="post" action="{% url 'accounts:update_education' %}" class="needs-validation">
                    {% csrf_token %}
                    <div class="form-group mb-3">
                        <label for="id_program" class="form-label">Program</label>
                        <select name="program" id="id_program" class="form-select" required>
                            <option value="">Select program</option>
                            <option value="BSIT">Bachelor of Science in Information Technology</option>
                            <option value="BSCS">Bachelor of Science in Computer Science</option>
                            <option value="BSIS">Bachelor of Science in Information Systems</option>
                            <option value="BSA">Bachelor of Science in Accountancy</option>
                            <option value="BSBA">Bachelor of Science in Business Administration</option>
                            <option value="BEED">Bachelor of Elementary Education</option>
                            <option value="BSED">Bachelor of Secondary Education</option>
                            <option value="BSN">Bachelor of Science in Nursing</option>
                            <option value="BSCRIM">Bachelor of Science in Criminology</option>
                            <option value="BSHRM">Bachelor of Science in Hotel and Restaurant Management</option>
                            <option value="BSTM">Bachelor of Science in Tourism Management</option>
                            <option value="BSE">Bachelor of Science in Engineering</option>
                            <option value="BSP">Bachelor of Science in Psychology</option>
                            <option value="OTHER">Other Program</option>
                        </select>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_major" class="form-label">Major/Specialization</label>
                        <input type="text" name="major" id="id_major" class="form-control">
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_school" class="form-label">School/Campus</label>
                        <select name="school" id="id_school" class="form-select" required>
                            <option value="">Select campus</option>
                            <option value="NORSU-G">NORSU Guihulngan</option>
                            <option value="NORSU-BC">NORSU Bais City</option>
                            <option value="NORSU-MB">NORSU Mabinay</option>
                            <option value="NORSU-SC">NORSU Siaton</option>
                            <option value="NORSU-PC">NORSU Pamplona</option>
                            <option value="NORSU-SCC">NORSU Sta. Catalina</option>
                            <option value="NORSU-VC">NORSU Valencia</option>
                            <option value="OTHER">Other Campus</option>
                        </select>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_graduation_year" class="form-label">Graduation Year</label>
                        <input type="number" name="graduation_year" id="id_graduation_year" class="form-control" min="1950" max="2099" required>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_achievements" class="form-label">Achievements</label>
                        <textarea name="achievements" id="id_achievements" class="form-control" rows="3"></textarea>
                    </div>

                    <div class="form-group mb-3">
                        <div class="form-check">
                            <input type="checkbox" name="is_primary" id="id_is_primary" class="form-check-input">
                            <label for="id_is_primary" class="form-check-label">This is my primary education</label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" form="educationForm">Save</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle form submissions
    const forms = ['skillForm', 'educationForm', 'experienceForm', 'documentForm', 'editEducationForm'];
    
    forms.forEach(formId => {
        const form = document.getElementById(formId);
        if (!form) return;

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Show loading state
            const submitButton = form.querySelector('button[type="submit"]');
            const originalText = submitButton.innerHTML;
            submitButton.disabled = true;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';

            // Get the modal if form is in a modal
            const modal = form.closest('.modal');
            
            // Create and submit the form data
            const formData = new FormData(form);
            fetch(form.action, {
                method: 'POST',
                body: formData,
                    headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                }
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(data => {
                        throw new Error(data.message || 'Form submission failed');
                    });
                }
                return response.json();
            })
            .then(data => {
                if (data.status === 'success') {
                    console.log('Success response received:', data);
                    
                    // Close modal if it exists
                    if (modal) {
                        const modalInstance = bootstrap.Modal.getInstance(modal);
                        modalInstance.hide();
                    }
                    
                    // Show success toast
                    const toastContainer = document.createElement('div');
                    toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';
                    toastContainer.style.zIndex = '1056';
                    
                    const toastElement = document.createElement('div');
                    toastElement.className = 'toast align-items-center text-white bg-success border-0';
                    toastElement.setAttribute('role', 'alert');
                    toastElement.setAttribute('aria-live', 'assertive');
                    toastElement.setAttribute('aria-atomic', 'true');
                    
                    toastElement.innerHTML = `
                        <div class="d-flex">
                            <div class="toast-body">
                                <i class="fas fa-check-circle me-2"></i> Successfully saved!
                            </div>
                            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                        </div>
                    `;
                    
                    toastContainer.appendChild(toastElement);
                    document.body.appendChild(toastContainer);
                    
                    const successToast = new bootstrap.Toast(toastElement, {
                        animation: true,
                        autohide: true,
                        delay: 3000
                    });
                    successToast.show();
                    
                    // Reset form and button state
                    form.reset();
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalText;
                    
                    // Reload the page after a short delay
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                } else {
                    throw new Error(data.message || 'Form submission failed');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                // Reset button state
                submitButton.disabled = false;
                submitButton.innerHTML = originalText;
                
                // Show error toast
                const toastContainer = document.createElement('div');
                toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';
                toastContainer.style.zIndex = '1056';
                
                const toastElement = document.createElement('div');
                toastElement.className = 'toast align-items-center text-white bg-danger border-0';
                toastElement.setAttribute('role', 'alert');
                toastElement.setAttribute('aria-live', 'assertive');
                toastElement.setAttribute('aria-atomic', 'true');
                
                toastElement.innerHTML = `
                    <div class="d-flex">
                        <div class="toast-body">
                            <i class="fas fa-exclamation-circle me-2"></i> Error saving changes: ${error.message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                `;
                
                toastContainer.appendChild(toastElement);
                document.body.appendChild(toastContainer);
                
                const errorToast = new bootstrap.Toast(toastElement, {
                    animation: true,
                    autohide: true,
                    delay: 5000
                });
                errorToast.show();
            });
        });
    });

    // Handle education form with IDs
    document.querySelectorAll('[id^="editEducationForm"]').forEach(form => {
        if (!form) return;

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Show loading state
            const submitButton = form.querySelector('button[type="submit"]');
            const originalText = submitButton.innerHTML;
            submitButton.disabled = true;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';

            // Get the modal
            const modal = form.closest('.modal');
            
            // Create and submit the form data
            const formData = new FormData(form);
            fetch(form.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                }
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(data => {
                        throw new Error(data.errors ? Object.values(data.errors).join(', ') : 'Form submission failed');
                    });
                }
                return response.json();
            })
            .then(data => {
                if (data.status === 'success') {
                    // Close modal
                    const modalInstance = bootstrap.Modal.getInstance(modal);
                    modalInstance.hide();
                    
                    // Show success toast
                    const toastContainer = document.createElement('div');
                    toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';
                    toastContainer.style.zIndex = '1056';
                    
                    const toastElement = document.createElement('div');
                    toastElement.className = 'toast align-items-center text-white bg-success border-0';
                    toastElement.setAttribute('role', 'alert');
                    toastElement.setAttribute('aria-live', 'assertive');
                    toastElement.setAttribute('aria-atomic', 'true');
                    
                    toastElement.innerHTML = `
                        <div class="d-flex">
                            <div class="toast-body">
                                <i class="fas fa-check-circle me-2"></i> Successfully saved!
                            </div>
                            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                        </div>
                    `;
                    
                    toastContainer.appendChild(toastElement);
                    document.body.appendChild(toastContainer);
                    
                    const successToast = new bootstrap.Toast(toastElement, {
                        animation: true,
                        autohide: true,
                        delay: 3000
                    });
                    successToast.show();
                    
                    // Reload the page after a short delay
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                } else {
                    throw new Error(data.message || 'Form submission failed');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                // Reset button state
                submitButton.disabled = false;
                submitButton.innerHTML = originalText;
                
                // Show error toast
                const toastContainer = document.createElement('div');
                toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';
                toastContainer.style.zIndex = '1056';
                
                const toastElement = document.createElement('div');
                toastElement.className = 'toast align-items-center text-white bg-danger border-0';
                toastElement.setAttribute('role', 'alert');
                toastElement.setAttribute('aria-live', 'assertive');
                toastElement.setAttribute('aria-atomic', 'true');
                
                toastElement.innerHTML = `
                    <div class="d-flex">
                        <div class="toast-body">
                            <i class="fas fa-exclamation-circle me-2"></i> Error saving changes: ${error.message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                `;
                
                toastContainer.appendChild(toastElement);
                document.body.appendChild(toastContainer);
                
                const errorToast = new bootstrap.Toast(toastElement, {
                    animation: true,
                    autohide: true,
                    delay: 5000
                });
                errorToast.show();
            });
        });
    });

    // Handle delete buttons
    document.querySelectorAll('.delete-button').forEach(button => {
        button.addEventListener('click', function() {
            deleteItemId = this.dataset.itemId;
            deleteItemType = this.dataset.itemType;
            
            // Update modal text
            const modalBody = document.querySelector('#confirmDeleteModal .modal-body');
            if (deleteItemType === 'experience') {
                modalBody.textContent = 'Are you sure you want to delete this work experience? This action cannot be undone.';
            } else if (deleteItemType === 'education') {
                modalBody.textContent = 'Are you sure you want to delete this education record? This action cannot be undone.';
            } else {
                modalBody.textContent = 'Are you sure you want to delete this item? This action cannot be undone.';
            }
        });
    });
    
    // Handle confirm delete button
    const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
    if (confirmDeleteBtn) {
        confirmDeleteBtn.addEventListener('click', function() {
            if (!deleteItemId || !deleteItemType) return;
            
            let url = '';
            if (deleteItemType === 'experience') {
                url = `/accounts/update/experience/${deleteItemId}/delete/`;
            } else if (deleteItemType === 'education') {
                url = `/accounts/update/education/${deleteItemId}/delete/`;
            } else {
                return;
            }
            
            // Show loading state
            const originalText = this.innerHTML;
            this.disabled = true;
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Deleting...';
            
            fetch(url, {
                method: 'POST',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // Close modal
                    const modalInstance = bootstrap.Modal.getInstance(document.getElementById('confirmDeleteModal'));
                    modalInstance.hide();
                    
                    // Show success message and reload
                    setTimeout(() => {
                        window.location.reload();
                    }, 500);
                } else {
                    throw new Error(data.message || 'Delete operation failed');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                // Reset button state
                this.disabled = false;
                this.innerHTML = originalText;
                
                // Show error toast
                alert('Error deleting item: ' + error.message);
            });
        });
    }
    
    // Initialize variables for delete functionality
    let deleteItemId = null;
    let deleteItemType = null;
});
</script>
{% endblock extra_js %}