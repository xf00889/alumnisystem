{% extends "base.html" %}
{% load i18n %}
{% load static %}
{% load profile_filters %}
{% load string_filters %}
{% load crispy_forms_tags %}

{% block title %}My Profile - NORSU Alumni{% endblock %}





{% block extra_css %}
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
    /* System Color Scheme */
    :root {
        /* Primary Colors */
        --primary-color: #2b3c6b;
        --primary-light: #0a4f94;
        --primary-dark: #1a2544;
        
        /* Secondary Colors */
        --secondary-color: #4a5568;
        
        /* UI Colors */
        --ui-background: #f7fafc;
        --ui-surface: #ffffff;
        --ui-border: #e2e8f0;
        --ui-hover: #edf2f7;
        
        /* Text Colors */
        --text-primary: #2d3748;
        --text-secondary: #718096;
        --text-muted: #a0aec0;
        --text-light: #ffffff;
        
        /* Feedback Colors */
        --feedback-success: #48bb78;
        --feedback-warning: #ed8936;
        --feedback-error: #e53e3e;
        --feedback-info: #4299e1;
        
        /* Shadows */
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
        --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
        
        /* Border Radius */
        --radius-sm: 0.25rem;
        --radius-md: 0.375rem;
        --radius-lg: 0.5rem;
        
        /* Legacy Variables for Compatibility */
        --success-color: #48bb78;
        --danger-color: #e53e3e;
        --warning-color: #ed8936;
        --info-color: #4299e1;
        --border-radius: 15px;
        --card-shadow: var(--shadow-sm);
        --transition: all 0.3s ease;
        --card-border-radius: var(--radius-md);
        --profile-card-shadow: var(--shadow-sm);
        --hover-transition: all 0.3s ease;
        --icon-btn-size: 32px;
        --icon-size: 14px;
        --danger-hover: #e53e3e;
        --primary-hover: #0a4f94;
    }
    
    /* Global Styling */
    body {
        background-color: var(--ui-background);
        font-size: 0.875rem;
        font-family: 'Poppins', sans-serif;
    }
    
    /* Dashboard Header */
    .dashboard-header {
        background: var(--primary-color);
        color: var(--text-light);
        padding: 1.75rem;
        border-radius: var(--radius-md);
        margin-bottom: 1.25rem;
        box-shadow: var(--shadow-sm);
        font-size: 0.875rem;
        font-family: 'Poppins', sans-serif;
    }
    
    .dashboard-header h1 {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 0.25rem;
    }
    
    .dashboard-header p {
        opacity: 0.9;
        font-size: 0.875rem;
    }

    /* Profile Header */
    .profile-header {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
        padding: 6rem 0 10rem;
        position: relative;
        overflow: hidden;
    }

    .profile-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg width="20" height="20" xmlns="http://www.w3.org/2000/svg"><rect width="20" height="20" fill="none"/><circle cx="3" cy="3" r="1" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
    }

    .profile-header::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 180px;
        background: white;
        clip-path: ellipse(65% 65% at 50% 100%);
    }

    .profile-avatar-wrapper {
        position: relative;
        width: 180px;
        height: 180px;
        margin: 0 auto;
    }

    .profile-avatar {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        border: 6px solid white;
        box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        object-fit: cover;
        background: white;
    }

    .profile-name {
        font-size: 2.5rem;
        font-weight: 800;
        margin: var(--spacing-unit) 0;
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    /* Content Layout */
    .profile-content {
        margin-top: -5rem;
        position: relative;
        z-index: 1;
        padding-bottom: 4rem;
    }

    /* Profile Card Enhancements */
    .profile-card {
        background: var(--ui-surface);
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-sm);
        padding: 2rem;
        margin-bottom: 1.5rem;
        border: 1px solid var(--ui-border);
        font-size: 1rem;
        font-family: 'Poppins', sans-serif;
        transition: var(--hover-transition);
    }

    .profile-card:hover {
        box-shadow: var(--shadow-md);
        transform: translateY(-2px);
    }

    /* Card Headers and Titles */
    .profile-card h5.section-title,
    .profile-card h5.card-title {
        color: var(--text-primary);
        font-size: 1.125rem;
        font-weight: 600;
        font-family: 'Poppins', sans-serif;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        position: relative;
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--ui-border);
    }

    .profile-card h5.section-title i,
    .profile-card h5.card-title i {
        color: var(--primary-color);
        font-size: 1.1em;
        opacity: 0.9;
    }

    /* Timeline Enhancements */
    .timeline-container {
        position: relative;
        padding-left: 1.5rem;
    }

    .timeline-item {
        position: relative;
        padding-bottom: 2rem;
        border-left: 2px solid rgba(43, 60, 107, 0.15);
        padding-left: 1.5rem;
    }

    .timeline-item:last-child {
        padding-bottom: 0;
        border-left: 2px solid transparent;
    }

    .timeline-item.current-position {
        border-left: 2px solid var(--success-color);
    }

    .timeline-marker {
        position: absolute;
        left: -0.5rem;
        top: 0;
        width: 1rem;
        height: 1rem;
        border-radius: 50%;
        background: #fff;
        border: 2px solid var(--primary-color);
        box-shadow: 0 0 0 4px rgba(43, 60, 107, 0.1);
        z-index: 1;
    }

    .timeline-item.current-position .timeline-marker {
        background: #fff;
        border: 2px solid var(--success-color);
        box-shadow: 0 0 0 4px rgba(40, 167, 69, 0.2);
    }

    .timeline-content {
        background: var(--ui-surface);
        padding: 1.5rem;
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--ui-border);
        font-family: 'Poppins', sans-serif;
        transition: var(--hover-transition);
    }

    .timeline-content:hover {
        box-shadow: var(--shadow-md);
        transform: translateY(-2px);
    }

    .timeline-title {
        color: var(--text-primary);
        font-weight: 600;
        font-size: 1.2rem;
        margin-bottom: 0.2rem;
        line-height: 1.4;
    }

    .timeline-subtitle {
        color: var(--primary-color);
        font-weight: 500;
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
    }

    .timeline-info {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin: 0.75rem 0;
        font-size: 0.9rem;
        color: var(--text-secondary);
    }

    .timeline-info .date-range,
    .timeline-info .location {
        display: flex;
        align-items: center;
    }

    .timeline-info i {
        margin-right: 0.4rem;
        opacity: 0.7;
    }

    .timeline-actions {
        display: flex;
        gap: 0.5rem;
    }

    .timeline-achievements h6,
    .timeline-skills h6 {
        font-size: 0.95rem;
        margin-bottom: 0.75rem;
        color: var(--primary-color);
        font-weight: 600;
        display: flex;
        align-items: center;
    }

    .timeline-achievements .card,
    .timeline-body .card {
        border: 1px solid var(--ui-border);
        background-color: var(--ui-hover);
        border-radius: var(--radius-sm);
    }

    .timeline-achievements .card-body,
    .timeline-body .card-body {
        padding: 1rem;
        font-size: 0.875rem;
        font-family: 'Poppins', sans-serif;
        color: var(--text-primary);
    }

    .skill-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .skill-tags .badge {
        padding: 0.5rem 0.75rem;
        font-weight: 500;
        background-color: var(--ui-hover);
        color: var(--text-primary);
        border-radius: var(--radius-sm);
        border: 1px solid var(--ui-border);
        font-family: 'Poppins', sans-serif;
        font-size: 0.75rem;
    }

    /* Enhanced Empty State */
    .empty-state {
        text-align: center;
        padding: 2.5rem;
        background: var(--ui-hover);
        border-radius: var(--radius-md);
        margin-bottom: 1rem;
        border: 1px solid var(--ui-border);
    }

    .empty-state i {
        font-size: 2.5rem;
        color: var(--text-muted);
        margin-bottom: 1.25rem;
    }

    .empty-state p {
        color: var(--text-secondary);
        margin-bottom: 1.25rem;
        font-size: 1rem;
        font-family: 'Poppins', sans-serif;
    }



    /* Consistent Button Styling */
    .btn {
        font-family: 'Poppins', sans-serif;
        font-weight: 500;
        border-radius: var(--radius-md);
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
        transition: var(--transition);
    }
    
    .btn-primary {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
        color: var(--text-light);
    }

    .btn-primary:hover {
        background-color: var(--primary-hover);
        border-color: var(--primary-hover);
        color: var(--text-light);
    }

    .btn-outline-primary {
        color: var(--primary-color);
        border-color: var(--primary-color);
        background-color: transparent;
    }

    .btn-outline-primary:hover {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
        color: var(--text-light);
    }
    
    .btn-success {
        background-color: var(--feedback-success);
        border-color: var(--feedback-success);
        color: var(--text-light);
    }
    
    .btn-warning {
        background-color: var(--feedback-warning);
        border-color: var(--feedback-warning);
        color: var(--text-light);
    }
    
    .btn-light {
        background-color: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: var(--text-light);
        border-radius: var(--radius-md);
        transition: all 0.3s ease;
    }
    
    .btn-light:hover {
        background-color: rgba(255, 255, 255, 0.25);
        border-color: rgba(255, 255, 255, 0.3);
        color: var(--text-light);
        transform: translateY(-1px);
    }

    /* Badge Styling */
    .badge {
        font-weight: 500;
        padding: 0.4rem 0.7rem;
        border-radius: var(--radius-sm);
        font-family: 'Poppins', sans-serif;
        font-size: 0.75rem;
    }

    .badge.bg-success {
        background-color: var(--feedback-success) !important;
        color: var(--text-light) !important;
    }

    .badge.bg-info {
        background-color: var(--feedback-info) !important;
        color: var(--text-light) !important;
    }

    .badge.bg-light {
        background-color: var(--ui-hover) !important;
        color: var(--text-primary) !important;
        border: 1px solid var(--ui-border);
    }

    .badge.bg-primary {
        background-color: var(--primary-color) !important;
        color: var(--text-light) !important;
    }
    
    .badge.bg-warning {
        background-color: var(--feedback-warning) !important;
        color: var(--text-light) !important;
    }

    /* Tab Navigation */
    .nav-tabs {
        border-bottom: 1px solid var(--ui-border);
        margin-bottom: 1.5rem;
    }

    .nav-tabs .nav-link {
        color: var(--text-secondary);
        padding: 0.75rem 1.25rem;
        border: none;
        border-bottom: 3px solid transparent;
        font-weight: 500;
        font-family: 'Poppins', sans-serif;
        font-size: 0.875rem;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .nav-tabs .nav-link i {
        font-size: 0.9rem;
    }

    .nav-tabs .nav-link:hover {
        color: var(--primary-color);
        border-bottom-color: rgba(6, 57, 112, 0.3);
        background-color: var(--ui-hover);
    }

    .nav-tabs .nav-link.active {
        color: var(--primary-color);
        border-bottom-color: var(--primary-color);
        background-color: transparent;
        font-weight: 600;
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
        .profile-header {
            padding: 4rem 0 8rem;
        }

        .profile-card {
            padding: 1.25rem;
        }

        .timeline-content {
            padding: 1.25rem;
        }

        .timeline-info {
            flex-direction: column;
            gap: 0.5rem;
        }

        .nav-tabs .nav-link {
            padding: 0.5rem 0.75rem;
            font-size: 0.9rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="mb-2"><i class="fas fa-user me-3"></i>User Profile</h1>
                <p class="mb-0">View and manage profile information, education, experience, and skills.</p>
            </div>
            <div class="col-md-4 text-end">
                {% if is_own_profile %}
                <div class="d-flex gap-2 justify-content-end">
                    <a href="{% url 'accounts:edit_profile' %}" class="btn btn-light">
                        <i class="fas fa-edit me-1"></i> Edit Profile
                    </a>
                    {% if not is_mentor and not has_pending_application %}
                    <a href="{% url 'accounts:apply_mentor' %}" class="btn btn-success">
                        <i class="fas fa-chalkboard-teacher me-1"></i> Apply as Mentor
                    </a>
                    {% elif has_pending_application %}
                    <a href="{% url 'accounts:mentor_application_status' %}" class="btn btn-warning">
                        <i class="fas fa-hourglass-half me-1"></i> Application Status
                    </a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Profile Header Card - Compact Version -->
    <div class="profile-card mb-4">
        <div class="row g-0 align-items-center">
            <div class="col-auto">
                {% if profile.avatar %}
                    <img src="{{ profile.avatar.url }}" alt="Profile Avatar" class="rounded-circle" style="width: 100px; height: 100px; object-fit: cover; border: 3px solid #fff; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
                {% else %}
                    <div class="rounded-circle bg-light d-flex align-items-center justify-content-center" style="width: 100px; height: 100px; border: 3px solid #fff; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
                        <i class="fas fa-user fa-2x text-secondary"></i>
                    </div>
                {% endif %}
            </div>
            <div class="col ps-4">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="d-flex align-items-center">
                        <h3 class="mb-1">{{ profile.user.get_full_name }}</h3>
                            {% if is_mentor %}
                            <span class="badge bg-success ms-2" style="font-size: 0.7rem; padding: 0.35rem 0.65rem;">
                                <i class="fas fa-check-circle me-1"></i> Verified Mentor
                            </span>
                            {% endif %}
                        </div>
                        <p class="text-muted mb-2">{{ profile.user.email }}</p>
                    </div>
                    <div>
                        <div class="social-links mt-2 d-flex gap-2">
                            {% if profile.linkedin_profile %}
                                <a href="{{ profile.linkedin_profile }}" class="btn btn-sm btn-outline-primary" target="_blank">
                                    <i class="fab fa-linkedin-in"></i>
                                </a>
                            {% endif %}
                            {% if profile.facebook_profile %}
                                <a href="{{ profile.facebook_profile }}" class="btn btn-sm btn-outline-primary" target="_blank">
                                    <i class="fab fa-facebook-f"></i>
                                </a>
                            {% endif %}
                            {% if profile.twitter_profile %}
                                <a href="{{ profile.twitter_profile }}" class="btn btn-sm btn-outline-primary" target="_blank">
                                    <i class="fab fa-twitter"></i>
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% if profile.bio %}
                    <p class="small text-muted mb-0">{{ profile.bio|truncatewords:30 }}</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="row">
        <div class="col-12">
            <!-- Profile Tabs Navigation -->
            <ul class="nav nav-tabs mb-4" id="profileTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="personal-tab" data-bs-toggle="tab" data-bs-target="#personal" type="button" role="tab" aria-controls="personal" aria-selected="true">
                        <i class="fas fa-user"></i> Personal Info
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="education-tab" data-bs-toggle="tab" data-bs-target="#education" type="button" role="tab" aria-controls="education" aria-selected="false">
                        <i class="fas fa-graduation-cap"></i> Education
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="experience-tab" data-bs-toggle="tab" data-bs-target="#experience" type="button" role="tab" aria-controls="experience" aria-selected="false">
                        <i class="fas fa-briefcase"></i> Experience
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="skills-tab" data-bs-toggle="tab" data-bs-target="#skills" type="button" role="tab" aria-controls="skills" aria-selected="false">
                        <i class="fas fa-star"></i> Skills
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="documents-tab" data-bs-toggle="tab" data-bs-target="#documents" type="button" role="tab" aria-controls="documents" aria-selected="false">
                        <i class="fas fa-file-alt"></i> Documents
                    </button>
                </li>
                {% if is_mentor %}
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="mentor-tab" data-bs-toggle="tab" data-bs-target="#mentor" type="button" role="tab" aria-controls="mentor" aria-selected="false">
                        <i class="fas fa-chalkboard-teacher"></i> Mentor Info
                    </button>
                </li>
                {% endif %}
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="profileTabsContent">
                <!-- Personal Information Tab -->
                <div class="tab-pane fade show active" id="personal" role="tabpanel" aria-labelledby="personal-tab">
                    <div class="profile-card">
                        <div class="mb-4">
                            <h5 class="section-title mb-0">
                                <i class="fas fa-user"></i> Personal Information
                            </h5>
                        </div>
                <div class="info-list">
                <div class="row g-3">
                    <div class="col-md-6">
                            <div class="info-item">
                        <label class="text-muted small mb-1">Email</label>
                        <div class="d-flex align-items-center">
                            <i class="fas fa-envelope text-primary me-2"></i>
                                    <a href="mailto:{{ profile.user.email }}" class="text-decoration-none text-body">{{ profile.user.email }}</a>
                                </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                            <div class="info-item">
                        <label class="text-muted small mb-1">Phone</label>
                        <div class="d-flex align-items-center">
                            <i class="fas fa-phone text-primary me-2"></i>
                            {% if profile.phone_number %}
                                    <a href="tel:{{ profile.phone_number }}" class="text-decoration-none text-body">{{ profile.phone_number }}</a>
                            {% else %}
                            <span class="text-muted">Not provided</span>
                            {% endif %}
                                </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                            <div class="info-item">
                        <label class="text-muted small mb-1">Date of Birth</label>
                        <div class="d-flex align-items-center">
                            <i class="fas fa-calendar text-primary me-2"></i>
                                    {% if profile.birth_date %}
                                    <span>{{ profile.birth_date|date:"F d, Y" }}</span>
                                    {% else %}
                                    <span class="text-muted">Not provided</span>
                                    {% endif %}
                                </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                            <div class="info-item">
                        <label class="text-muted small mb-1">Gender</label>
                        <div class="d-flex align-items-center">
                            <i class="fas fa-venus-mars text-primary me-2"></i>
                                    {% if profile.gender %}
                                    <span>{{ profile.get_gender_display }}</span>
                                    {% else %}
                                    <span class="text-muted">Not provided</span>
                                    {% endif %}
                                </div>
                        </div>
                    </div>
                    <div class="col-12">
                            <div class="info-item">
                        <label class="text-muted small mb-1">Address</label>
                        <div class="d-flex align-items-center">
                            <i class="fas fa-map-marker-alt text-primary me-2"></i>
                                    {% if profile.address %}
                                    <span>{{ profile.address }}, {{ profile.city }}, {{ profile.state }}, {{ profile.country.name }}</span>
                                    {% else %}
                                    <span class="text-muted">Not provided</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% if alumni and alumni.college %}
                        <div class="col-md-6">
                            <div class="info-item">
                                <label class="text-muted small mb-1">College</label>
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-university text-primary me-2"></i>
                                    <span>{{ alumni.college_display }}</span>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        {% if alumni and alumni.campus %}
                        <div class="col-md-6">
                            <div class="info-item">
                                <label class="text-muted small mb-1">Campus</label>
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-map-marker-alt text-primary me-2"></i>
                                    <span>{{ alumni.get_campus_display }}</span>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                    </div>
                </div>

                <!-- Skills Tab -->
                <div class="tab-pane fade" id="skills" role="tabpanel" aria-labelledby="skills-tab">
                    <div class="profile-card">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="section-title mb-0">
                        <i class="fas fa-star"></i> Skills
                    </h5>
                    <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addSkillModal">
                        <i class="fas fa-plus me-1"></i> Add Skill
                    </button>
                </div>
                {% if skill_list %}
                    {% regroup skill_list by get_skill_type_display as skill_list_grouped %}
                    {% for skill_type in skill_list_grouped %}
                        <div class="mb-3">
                            <h6 class="mb-2 text-primary">
                                <i class="fas fa-layer-group me-2"></i>{{ skill_type.grouper }}
                            </h6>
                            <div class="skill-tags">
                            {% for skill in skill_type.list %}
                                    <span class="badge bg-light mb-2 me-2 p-2">
                                        {{ skill.name }}
                                        <span class="badge bg-primary ms-1">{{ skill.get_proficiency_level_display }}</span>
                                    </span>
                                {% endfor %}
                                    </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-star"></i>
                        <p>No skills added yet</p>
                    </div>
                {% endif %}
                    </div>
                </div>

                <!-- Documents Tab -->
                <div class="tab-pane fade" id="documents" role="tabpanel" aria-labelledby="documents-tab">
                    <div class="profile-card">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="section-title mb-0">
                        <i class="fas fa-file-alt"></i> Documents
                    </h5>
                    <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addDocumentModal">
                        <i class="fas fa-plus me-1"></i> Add Document
                    </button>
                </div>
                {% if profile.documents.all %}
                    <div class="document-list">
                    {% for document in profile.documents.all %}
                        <div class="document-item mb-3 p-3 bg-light rounded d-flex align-items-center">
                            <div class="document-icon me-3">
                                <i class="fas fa-file-pdf fa-2x text-primary"></i>
                                </div>
                            <div class="document-info">
                                <h6 class="mb-1">{{ document.title }}</h6>
                                <div class="small text-muted">
                                    <span class="badge bg-secondary me-2">{{ document.get_document_type_display }}</span>
                                    <span>Uploaded: {{ document.created_at|date:"M d, Y" }}</span>
                                </div>
                            </div>
                            <div class="ms-auto">
                                <a href="{{ document.file.url }}" class="btn btn-sm btn-outline-primary me-2" target="_blank">
                                        <i class="fas fa-download"></i>
                                    </a>
                                    <form action="{% url 'accounts:document_delete' document.pk %}" method="post" class="d-inline">
                                        {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-outline-danger">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </form>
                            </div>
                        </div>
                    {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-file-alt"></i>
                        <p>No documents uploaded yet</p>
                    </div>
                {% endif %}
                    </div>
                </div>

                <!-- Education Tab -->
                <div class="tab-pane fade" id="education" role="tabpanel" aria-labelledby="education-tab">
                    <div class="profile-card">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="section-title mb-0">
                        <i class="fas fa-graduation-cap"></i> Education
                    </h5>
                    <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addEducationModal">
                        <i class="fas fa-plus me-1"></i> Add Education
                    </button>
                </div>
                
                {% if education_list %}
                    <div class="timeline-container">
                        {% for education in education_list %}
                            <div class="timeline-item {% if education.is_primary %}current-position{% endif %}">
                                <div class="timeline-marker"></div>
                                <div class="timeline-content">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h4 class="timeline-title">{{ education.program }}</h4>
                                            <h5 class="timeline-subtitle">{{ education.school }}</h5>
                                            {% if education.major %}
                                            <div class="text-muted mb-1">Major in {{ education.major }}</div>
                                            {% endif %}
                                        </div>
                                        {% if is_own_profile %}
                                        <div class="timeline-actions">
                                            <button type="button" class="btn btn-sm btn-outline-primary" 
                                                    data-bs-toggle="modal" 
                                                    data-bs-target="#editEducationModal{{ education.id }}">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            {% if not education.is_primary %}
                                            <button type="button" class="btn btn-sm btn-outline-danger delete-button" 
                                                        data-bs-toggle="modal" 
                                                        data-bs-target="#confirmDeleteModal"
                                                        data-item-id="{{ education.id }}"
                                                        data-item-type="education">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            {% endif %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="timeline-info">
                                        <span class="date-range">
                                            <i class="far fa-calendar-alt"></i>
                                            Graduated {{ education.graduation_year }}
                                        </span>
                                        {% if education.location %}
                                        <span class="location">
                                            <i class="fas fa-map-marker-alt"></i>
                                            {{ education.location }}
                                        </span>
                                        {% endif %}
                                        {% if education.is_primary and alumni and alumni.college %}
                                        <span class="college-info">
                                            <i class="fas fa-university"></i>
                                            {{ alumni.college_display }}
                                        </span>
                                        {% endif %}
                                        {% if education.is_primary %}
                                        <span class="badge bg-primary">Primary Education</span>
                                        {% endif %}
                                    </div>

                                    {% if education.achievements %}
                                    <div class="timeline-achievements mt-3">
                                        <h6>
                                            <i class="fas fa-trophy me-2"></i>Achievements
                                        </h6>
                                        <div class="card">
                                            <div class="card-body">
                                                {{ education.achievements|linebreaks }}
                </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-graduation-cap"></i>
                        <p>No education history added yet</p>
                    </div>
                {% endif %}
                    </div>
                </div>

                <!-- Experience Tab -->
                <div class="tab-pane fade" id="experience" role="tabpanel" aria-labelledby="experience-tab">
                    <div class="profile-card">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="section-title mb-0">
                        <i class="fas fa-briefcase"></i> Professional Experience
                    </h5>
                    {% if is_own_profile %}
                    <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addExperienceModal">
                        <i class="fas fa-plus me-1"></i> Add Experience
                    </button>
                    {% endif %}
                </div>
                
                <ul class="nav nav-tabs" id="experienceTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="all-experience-tab" data-bs-toggle="tab" data-bs-target="#all-experience" type="button" role="tab" aria-controls="all-experience" aria-selected="true">
                            <i class="fas fa-th-list"></i> All Experience
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="career-path-tab" data-bs-toggle="tab" data-bs-target="#career-path" type="button" role="tab" aria-controls="career-path" aria-selected="false">
                            <i class="fas fa-route"></i> Career Path
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="work-experience-tab" data-bs-toggle="tab" data-bs-target="#work-experience" type="button" role="tab" aria-controls="work-experience" aria-selected="false">
                            <i class="fas fa-building"></i> Work Experience
                        </button>
                    </li>
                </ul>
                <div class="tab-content" id="experienceTabsContent">
                    <!-- All Experience Tab -->
                    <div class="tab-pane fade show active" id="all-experience" role="tabpanel" aria-labelledby="all-experience-tab">
                        {% if unified_experience %}
                        <div class="timeline-container">
                            {% for exp in unified_experience %}
                            <div class="timeline-item {% if exp.is_current %}current-position{% endif %}">
                                <div class="timeline-marker"></div>
                                <div class="timeline-content">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h4 class="timeline-title">{{ exp.position }}</h4>
                                            <h5 class="timeline-subtitle">{{ exp.company }}</h5>
                                                </div>
                                        {% if is_own_profile %}
                                        <div class="timeline-actions">
                                            <button type="button" class="btn btn-sm btn-outline-primary" 
                                                    data-item-id="{{ exp.id }}" 
                                                    data-item-type="experience"
                                                    data-bs-toggle="modal" 
                                                    data-bs-target="#editExperienceModal{{ exp.id }}">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button type="button" class="btn btn-sm btn-outline-danger" 
                                                    data-item-id="{{ exp.id }}" 
                                                    data-item-type="experience"
                                                    data-bs-toggle="modal" 
                                                    data-bs-target="#deleteExperienceModal{{ exp.id }}">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="timeline-info">
                                        <span class="date-range">
                                            <i class="far fa-calendar-alt"></i>
                                            {{ exp.start_date|date:"M Y" }}{% if exp.end_date %} - {{ exp.end_date|date:"M Y" }}{% elif exp.is_current %} - <span class="badge bg-success">Present</span>{% endif %}
                                        </span>
                                        {% if exp.location %}
                                        <span class="location">
                                            <i class="fas fa-map-marker-alt"></i>
                                            {{ exp.location }}
                                        </span>
                                        {% endif %}
                                        {% if exp.career_significance != 'REGULAR' %}
                                        <span class="badge bg-info">{{ exp.get_career_significance_display }}</span>
                                        {% endif %}
                                </div>
                                    
                                    {% if exp.description %}
                                    <div class="timeline-body mt-3">
                                        <div class="card">
                                            <div class="card-body">
                                                {{ exp.description|linebreaks }}
                            </div>
                    </div>
                                    </div>
                {% endif %}
                                    
                                    {% if exp.achievements %}
                                    <div class="timeline-achievements mt-3">
                                        <h6>
                                            <i class="fas fa-trophy me-2"></i>Key Achievements
                                        </h6>
                                        <div class="card">
                                            <div class="card-body">
                                                {{ exp.achievements|linebreaks }}
            </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                    
                                    {% if exp.skills_gained %}
                                    <div class="timeline-skills mt-3">
                                        <h6>
                                            <i class="fas fa-tools me-2"></i>Skills Gained
                                        </h6>
                                        <div class="skill-tags">
                                            {% for skill in exp.skills_gained|split:"," %}
                                            <span class="badge bg-light">{{ skill|strip }}</span>
                                            {% endfor %}
                </div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                                        {% else %}
                        <div class="empty-state">
                            <i class="fas fa-briefcase"></i>
                            <p>No professional experience added yet</p>
                        </div>
                                        {% endif %}
                                    </div>
                    
                    <!-- Career Path Tab -->
                    <div class="tab-pane fade" id="career-path" role="tabpanel" aria-labelledby="career-path-tab">
                        {% if career_path %}
                        <div class="timeline-container">
                            {% for exp in career_path %}
                            <div class="timeline-item {% if exp.is_current %}current-position{% endif %}">
                                <div class="timeline-marker"></div>
                                <div class="timeline-content">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h4 class="timeline-title">{{ exp.position }}</h4>
                                            <h5 class="timeline-subtitle">{{ exp.company }}</h5>
                                        </div>
                                        {% if is_own_profile %}
                                        <div class="timeline-actions">
                                            <button type="button" class="btn btn-sm btn-outline-primary" 
                                                    data-item-id="{{ exp.id }}" 
                                                    data-item-type="experience"
                                                data-bs-toggle="modal" 
                                                    data-bs-target="#editExperienceModal{{ exp.id }}">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-danger" 
                                                    data-item-id="{{ exp.id }}" 
                                                    data-item-type="experience"
                                                data-bs-toggle="modal" 
                                                    data-bs-target="#deleteExperienceModal{{ exp.id }}">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                        {% endif %}
                                </div>
                                    
                                    <div class="timeline-info">
                                        <span class="date-range">
                                            <i class="far fa-calendar-alt"></i>
                                            {{ exp.start_date|date:"M Y" }}{% if exp.end_date %} - {{ exp.end_date|date:"M Y" }}{% elif exp.is_current %} - <span class="badge bg-success">Present</span>{% endif %}
                                        </span>
                                        {% if exp.location %}
                                        <span class="location">
                                            <i class="fas fa-map-marker-alt"></i>
                                            {{ exp.location }}
                                        </span>
                                {% endif %}
                                        {% if exp.career_significance != 'REGULAR' %}
                                        <span class="badge bg-info">{{ exp.get_career_significance_display }}</span>
                                        {% endif %}
                                    </div>
                                    
                                    {% if exp.description %}
                                    <div class="timeline-body mt-3">
                                        <div class="card">
                                            <div class="card-body">
                                                {{ exp.description|linebreaks }}
                            </div>
                    </div>
            </div>
                                {% endif %}
                                    
                                    {% if exp.achievements %}
                                    <div class="timeline-achievements mt-3">
                                        <h6>
                                            <i class="fas fa-trophy me-2"></i>Key Achievements
                                        </h6>
                                        <div class="card">
                                            <div class="card-body">
                                                {{ exp.achievements|linebreaks }}
                            </div>
                            </div>
                            </div>
                        {% endif %}
                                    
                                    {% if exp.skills_gained %}
                                    <div class="timeline-skills mt-3">
                                        <h6>
                                            <i class="fas fa-tools me-2"></i>Skills Gained
                                        </h6>
                                        <div class="skill-tags">
                                            {% for skill in exp.skills_gained|split:"," %}
                                            <span class="badge bg-light">{{ skill|strip }}</span>
                                            {% endfor %}
                    </div>
                </div>
                                    {% endif %}
            </div>
        </div>
                            {% endfor %}
    </div>
                        {% else %}
                        <div class="empty-state">
                            <i class="fas fa-route"></i>
                            <p>No career path information added yet</p>
                        </div>
                        {% endif %}
</div>

                    <!-- Work Experience Tab -->
                    <div class="tab-pane fade" id="work-experience" role="tabpanel" aria-labelledby="work-experience-tab">
                        {% if work_experience %}
                        <div class="timeline-container">
                            {% for exp in work_experience %}
                            <div class="timeline-item {% if exp.is_current %}current-position{% endif %}">
                                <div class="timeline-marker"></div>
                                <div class="timeline-content">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h4 class="timeline-title">{{ exp.position }}</h4>
                                            <h5 class="timeline-subtitle">{{ exp.company }}</h5>
            </div>
                                        {% if is_own_profile %}
                                        <div class="timeline-actions">
                                            <button type="button" class="btn btn-sm btn-outline-primary" 
                                                    data-item-id="{{ exp.id }}" 
                                                    data-item-type="experience"
                                                    data-bs-toggle="modal" 
                                                    data-bs-target="#editExperienceModal{{ exp.id }}">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button type="button" class="btn btn-sm btn-outline-danger" 
                                                    data-item-id="{{ exp.id }}" 
                                                    data-item-type="experience"
                                                    data-bs-toggle="modal" 
                                                    data-bs-target="#deleteExperienceModal{{ exp.id }}">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                        {% endif %}
                    </div>

                                    <div class="timeline-info">
                                        <span class="date-range">
                                            <i class="far fa-calendar-alt"></i>
                                            {{ exp.start_date|date:"M Y" }}{% if exp.end_date %} - {{ exp.end_date|date:"M Y" }}{% elif exp.is_current %} - <span class="badge bg-success">Present</span>{% endif %}
                                        </span>
                                        {% if exp.location %}
                                        <span class="location">
                                            <i class="fas fa-map-marker-alt"></i>
                                            {{ exp.location }}
                                        </span>
                                        {% endif %}
                    </div>

                                    {% if exp.description %}
                                    <div class="timeline-body mt-3">
                                        <div class="card">
                                            <div class="card-body">
                                                {{ exp.description|linebreaks }}
                    </div>
            </div>
            </div>
                                    {% endif %}
                                    
                                    {% if exp.achievements %}
                                    <div class="timeline-achievements mt-3">
                                        <h6>
                                            <i class="fas fa-trophy me-2"></i>Key Achievements
                                        </h6>
                                        <div class="card">
                                            <div class="card-body">
                                                {{ exp.achievements|linebreaks }}
            </div>
                    </div>
                    </div>
                                    {% endif %}
                                    
                                    {% if exp.skills_gained %}
                                    <div class="timeline-skills mt-3">
                                        <h6>
                                            <i class="fas fa-tools me-2"></i>Skills Gained
                                        </h6>
                                        <div class="skill-tags">
                                            {% for skill in exp.skills_gained|split:"," %}
                                            <span class="badge bg-light">{{ skill|strip }}</span>
                                            {% endfor %}
                    </div>
                            </div>
                                    {% endif %}
                        </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="empty-state">
                            <i class="fas fa-building"></i>
                            <p>No work experience added yet</p>
                    </div>
                        {% endif %}
                        </div>
                    </div>
                    </div>
                </div>

                {% if is_mentor %}
                <!-- Mentor Information Tab -->
                <div class="tab-pane fade" id="mentor" role="tabpanel" aria-labelledby="mentor-tab">
                    <div class="profile-card">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5 class="section-title mb-0">
                                <i class="fas fa-chalkboard-teacher"></i> Mentor Information
                            </h5>
                            {% if is_own_profile %}
                            <a href="{% url 'mentorship:mentor_dashboard' %}" class="btn btn-success btn-sm">
                                <i class="fas fa-tachometer-alt"></i> Mentor Dashboard
                            </a>
                            {% endif %}
                        </div>
                        <div class="row g-3">
                            <div class="col-12">
                                <div class="d-flex align-items-center mb-3">
                                    <span class="badge bg-success me-2">
                                        <i class="fas fa-check-circle"></i>
                                    </span>
                                    <span class="fw-bold">Verified Mentor</span>
                                </div>
                                <div class="mb-3">
                                    <label class="text-muted small mb-1">Expertise Areas</label>
                                    <div class="d-flex flex-wrap gap-1 mt-1">
                                        {% for area in profile.user.mentor.expertise_areas.all %}
                                        <span class="badge bg-info">{{ area.name }}</span>
                                        {% empty %}
                                        <span class="text-muted">No expertise areas specified</span>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% if not is_own_profile %}
                                <div class="mt-3">
                                    <a href="{% url 'mentorship:request_mentorship' profile.user.id %}" class="btn btn-primary btn-sm">
                                        <i class="fas fa-user-plus"></i> Request Mentorship
                                    </a>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Add Experience Modal -->
<div class="modal fade" id="addExperienceModal" tabindex="-1" aria-labelledby="experienceModalLabel" aria-modal="true" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="experienceModalLabel">Add Work Experience</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="experienceForm" method="post" action="{% url 'accounts:update_experience' %}" class="needs-validation">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label for="id_company" class="form-label">Company</label>
                        <input type="text" name="company" id="id_company" class="form-control" required>
                    </div>
                        </div>
                        <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label for="id_position" class="form-label">Position</label>
                        <input type="text" name="position" id="id_position" class="form-control" required>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label for="id_location" class="form-label">Location</label>
                        <input type="text" name="location" id="id_location" class="form-control">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="id_career_significance" class="form-label">Type of Position</label>
                                <select name="career_significance" id="id_career_significance" class="form-select">
                                    <option value="REGULAR">Regular Position</option>
                                    <option value="PROMOTION">Promotion</option>
                                    <option value="LATERAL">Lateral Move</option>
                                    <option value="NEW_ROLE">New Role</option>
                                    <option value="COMPANY_CHANGE">Company Change</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-5">
                            <div class="form-group mb-3">
                                <label for="id_start_date" class="form-label">Start Date</label>
                                <input type="date" name="start_date" id="id_start_date" class="form-control" required>
                            </div>
                        </div>
                        <div class="col-md-5">
                            <div class="form-group mb-3">
                                <label for="id_end_date" class="form-label">End Date</label>
                                <input type="date" name="end_date" id="id_end_date" class="form-control">
                            </div>
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                    <div class="form-group mb-3">
                        <div class="form-check">
                            <input type="checkbox" name="is_current" id="id_is_current" class="form-check-input">
                                    <label for="id_is_current" class="form-check-label">Current Job</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_salary_range" class="form-label">Salary Range (Optional)</label>
                        <input type="text" name="salary_range" id="id_salary_range" class="form-control" placeholder="e.g., $50,000-$70,000">
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_description" class="form-label">Job Description</label>
                        <textarea name="description" id="id_description" class="form-control" rows="3" required></textarea>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_achievements" class="form-label">Key Achievements</label>
                        <textarea name="achievements" id="id_achievements" class="form-control" rows="3" placeholder="List your key achievements in this role"></textarea>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_skills_gained" class="form-label">Skills Gained</label>
                        <textarea name="skills_gained" id="id_skills_gained" class="form-control" rows="2" placeholder="Enter skills separated by commas"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" form="experienceForm">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Document Modal -->
<div class="modal fade" id="addDocumentModal" tabindex="-1" aria-labelledby="documentModalLabel" aria-modal="true" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="documentModalLabel">Add Document</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="documentForm" method="post" action="{% url 'accounts:update_documents' %}" class="needs-validation" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="form-group mb-3">
                        <label for="id_title" class="form-label">Document Title</label>
                        <input type="text" name="title" id="id_title" class="form-control" required>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_document_type" class="form-label">Document Type</label>
                        <select name="document_type" id="id_document_type" class="form-select" required>
                            <option value="">Select document type</option>
                            <option value="certificate">Certificate</option>
                            <option value="transcript">Transcript</option>
                            <option value="resume">Resume/CV</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_file" class="form-label">File</label>
                        <input type="file" name="file" id="id_file" class="form-control" required>
                        <div class="form-text">Maximum file size: 5MB. Supported formats: PDF, DOC, DOCX</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" form="documentForm">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Education Edit Modals -->
{% for education in education_list %}
<div class="modal fade" id="editEducationModal{{ education.id }}" tabindex="-1" aria-labelledby="editEducationModalLabel{{ education.id }}" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editEducationModalLabel{{ education.id }}">Edit Education</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editEducationForm{{ education.id }}" method="post" action="{% url 'accounts:edit_education' education.id %}" class="needs-validation">
                    {% csrf_token %}
                    <div class="form-group mb-3">
                        <label for="id_program{{ education.id }}" class="form-label">Program</label>
                        <select name="program" id="id_program{{ education.id }}" class="form-select" required>
                            <option value="">Select program</option>
                            <option value="BSIT" {% if education.program == 'BSIT' %}selected{% endif %}>Bachelor of Science in Information Technology</option>
                            <option value="BSCS" {% if education.program == 'BSCS' %}selected{% endif %}>Bachelor of Science in Computer Science</option>
                            <option value="BSIS" {% if education.program == 'BSIS' %}selected{% endif %}>Bachelor of Science in Information Systems</option>
                            <option value="BSA" {% if education.program == 'BSA' %}selected{% endif %}>Bachelor of Science in Accountancy</option>
                            <option value="BSBA" {% if education.program == 'BSBA' %}selected{% endif %}>Bachelor of Science in Business Administration</option>
                            <option value="BEED" {% if education.program == 'BEED' %}selected{% endif %}>Bachelor of Elementary Education</option>
                            <option value="BSED" {% if education.program == 'BSED' %}selected{% endif %}>Bachelor of Secondary Education</option>
                            <option value="BSN" {% if education.program == 'BSN' %}selected{% endif %}>Bachelor of Science in Nursing</option>
                            <option value="BSCRIM" {% if education.program == 'BSCRIM' %}selected{% endif %}>Bachelor of Science in Criminology</option>
                            <option value="BSHRM" {% if education.program == 'BSHRM' %}selected{% endif %}>Bachelor of Science in Hotel and Restaurant Management</option>
                            <option value="BSTM" {% if education.program == 'BSTM' %}selected{% endif %}>Bachelor of Science in Tourism Management</option>
                            <option value="BSE" {% if education.program == 'BSE' %}selected{% endif %}>Bachelor of Science in Engineering</option>
                            <option value="BSP" {% if education.program == 'BSP' %}selected{% endif %}>Bachelor of Science in Psychology</option>
                            <option value="OTHER" {% if education.program == 'OTHER' %}selected{% endif %}>Other Program</option>
                        </select>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_major{{ education.id }}" class="form-label">Major/Specialization</label>
                        <input type="text" name="major" id="id_major{{ education.id }}" class="form-control" value="{{ education.major }}">
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_school{{ education.id }}" class="form-label">School/Campus</label>
                        <select name="school" id="id_school{{ education.id }}" class="form-select" required>
                            <option value="">Select campus</option>
                            <option value="NORSU-G" {% if education.school == 'NORSU-G' %}selected{% endif %}>NORSU Guihulngan</option>
                            <option value="NORSU-BC" {% if education.school == 'NORSU-BC' %}selected{% endif %}>NORSU Bais City</option>
                            <option value="NORSU-MB" {% if education.school == 'NORSU-MB' %}selected{% endif %}>NORSU Mabinay</option>
                            <option value="NORSU-SC" {% if education.school == 'NORSU-SC' %}selected{% endif %}>NORSU Siaton</option>
                            <option value="NORSU-PC" {% if education.school == 'NORSU-PC' %}selected{% endif %}>NORSU Pamplona</option>
                            <option value="NORSU-SCC" {% if education.school == 'NORSU-SCC' %}selected{% endif %}>NORSU Sta. Catalina</option>
                            <option value="NORSU-VC" {% if education.school == 'NORSU-VC' %}selected{% endif %}>NORSU Valencia</option>
                            <option value="OTHER" {% if education.school == 'OTHER' %}selected{% endif %}>Other Campus</option>
                        </select>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_graduation_year{{ education.id }}" class="form-label">Graduation Year</label>
                        <input type="number" name="graduation_year" id="id_graduation_year{{ education.id }}" class="form-control" min="1950" max="2099" value="{{ education.graduation_year }}" required>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_achievements{{ education.id }}" class="form-label">Achievements</label>
                        <textarea name="achievements" id="id_achievements{{ education.id }}" class="form-control" rows="3">{{ education.achievements }}</textarea>
                    </div>

                    <div class="form-group mb-3">
                        <div class="form-check">
                            <input type="checkbox" name="is_primary" id="id_is_primary{{ education.id }}" class="form-check-input" {% if education.is_primary %}checked{% endif %}>
                            <label for="id_is_primary{{ education.id }}" class="form-check-label">This is my primary education</label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" form="editEducationForm{{ education.id }}">Save Changes</button>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<!-- Add Career Path Modal -->
<div class="modal fade" id="addCareerPathModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Career Path</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="careerPathForm" method="post" action="{% url 'accounts:add_career_path' %}">
                    {% csrf_token %}
                    <div class="form-group mb-3">
                        <label for="company" class="form-label">Company</label>
                        <input type="text" name="company" id="company" class="form-control" required>
                    </div>
                    <div class="form-group mb-3">
                        <label for="position" class="form-label">Position</label>
                        <input type="text" name="position" id="position" class="form-control" required>
                    </div>
                    <div class="form-group mb-3">
                        <label for="location" class="form-label">Location</label>
                        <input type="text" name="location" id="location" class="form-control">
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="start_date" class="form-label">Start Date</label>
                                <input type="date" name="start_date" id="start_date" class="form-control" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="end_date" class="form-label">End Date</label>
                                <input type="date" name="end_date" id="end_date" class="form-control">
                            </div>
                        </div>
                    </div>
                    <div class="form-group mb-3">
                        <div class="form-check">
                            <input type="checkbox" name="is_current" id="is_current" class="form-check-input">
                            <label for="is_current" class="form-check-label">Current Position</label>
                        </div>
                    </div>
                    <div class="form-group mb-3">
                        <label for="career_significance" class="form-label">Type of Change</label>
                        <select name="career_significance" id="career_significance" class="form-select">
                            <option value="">Select type</option>
                            <option value="PROMOTION">Promotion</option>
                            <option value="LATERAL">Lateral Move</option>
                            <option value="NEW_ROLE">New Role</option>
                            <option value="COMPANY_CHANGE">Company Change</option>
                        </select>
                    </div>
                    <div class="form-group mb-3">
                        <label for="salary_range" class="form-label">Salary Range (Optional)</label>
                        <input type="text" name="salary_range" id="salary_range" class="form-control">
                    </div>
                    <div class="form-group mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea name="description" id="description" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="form-group mb-3">
                        <label for="achievements" class="form-label">Key Achievements</label>
                        <textarea name="achievements" id="achievements" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="form-group mb-3">
                        <label for="skills_gained" class="form-label">Skills Gained</label>
                        <input type="text" name="skills_gained" id="skills_gained" class="form-control" placeholder="Enter skills separated by commas">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" form="careerPathForm">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Achievement Modal -->
<div class="modal fade" id="addAchievementModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Achievement</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="achievementForm" method="post" action="{% url 'accounts:add_achievement' %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="form-group mb-3">
                        <label for="title" class="form-label">Achievement Title</label>
                        <input type="text" name="title" id="title" class="form-control" required>
                    </div>
                    <div class="form-group mb-3">
                        <label for="achievement_type" class="form-label">Type</label>
                        <select name="achievement_type" id="achievement_type" class="form-select" required>
                            <option value="">Select type</option>
                            <option value="AWARD">Award</option>
                            <option value="CERTIFICATION">Certification</option>
                            <option value="PUBLICATION">Publication</option>
                            <option value="PROJECT">Project</option>
                            <option value="RECOGNITION">Recognition</option>
                            <option value="OTHER">Other</option>
                        </select>
                    </div>
                    <div class="form-group mb-3">
                        <label for="date_achieved" class="form-label">Date Achieved</label>
                        <input type="date" name="date_achieved" id="date_achieved" class="form-control" required>
                    </div>
                    <div class="form-group mb-3">
                        <label for="issuer" class="form-label">Issuer/Organization</label>
                        <input type="text" name="issuer" id="issuer" class="form-control">
                    </div>
                    <div class="form-group mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea name="description" id="description" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="form-group mb-3">
                        <label for="url" class="form-label">URL (Optional)</label>
                        <input type="url" name="url" id="url" class="form-control">
                    </div>
                    <div class="form-group mb-3">
                        <label for="attachment" class="form-label">Attachment</label>
                        <input type="file" name="attachment" id="attachment" class="form-control" accept=".pdf,.jpg,.jpeg,.png">
                        <div class="form-text">Supported formats: PDF, JPG, PNG (Max size: 5MB)</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" form="achievementForm">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Confirm Delete Modal -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmDeleteModalLabel">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this item? This action cannot be undone.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Experience Modals -->
{% for exp in unified_experience %}
<div class="modal fade" id="editExperienceModal{{ exp.id }}" tabindex="-1" aria-labelledby="editExperienceModalLabel{{ exp.id }}" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editExperienceModalLabel{{ exp.id }}">Edit Experience</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editExperienceForm{{ exp.id }}" method="post" action="{% url 'accounts:edit_experience' exp.id %}" class="needs-validation">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="id_company{{ exp.id }}" class="form-label">Company</label>
                                <input type="text" name="company" id="id_company{{ exp.id }}" class="form-control" value="{{ exp.company }}" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="id_position{{ exp.id }}" class="form-label">Position</label>
                                <input type="text" name="position" id="id_position{{ exp.id }}" class="form-control" value="{{ exp.position }}" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_location{{ exp.id }}" class="form-label">Location</label>
                        <input type="text" name="location" id="id_location{{ exp.id }}" class="form-control" value="{{ exp.location }}">
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="id_start_date{{ exp.id }}" class="form-label">Start Date</label>
                                <input type="date" name="start_date" id="id_start_date{{ exp.id }}" class="form-control" value="{{ exp.start_date|date:'Y-m-d' }}" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="id_end_date{{ exp.id }}" class="form-label">End Date</label>
                                <input type="date" name="end_date" id="id_end_date{{ exp.id }}" class="form-control" value="{% if exp.end_date %}{{ exp.end_date|date:'Y-m-d' }}{% endif %}" {% if exp.is_current %}disabled{% endif %}>
                            </div>
                        </div>
                    </div>

                    <div class="form-group mb-3">
                        <div class="form-check">
                            <input type="checkbox" name="is_current" id="id_is_current{{ exp.id }}" class="form-check-input" {% if exp.is_current %}checked{% endif %}>
                            <label for="id_is_current{{ exp.id }}" class="form-check-label">Currently Working Here</label>
                        </div>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_career_significance{{ exp.id }}" class="form-label">Career Significance</label>
                        <select name="career_significance" id="id_career_significance{{ exp.id }}" class="form-select">
                            <option value="REGULAR" {% if exp.career_significance == 'REGULAR' %}selected{% endif %}>Regular Position</option>
                            <option value="PROMOTION" {% if exp.career_significance == 'PROMOTION' %}selected{% endif %}>Promotion</option>
                            <option value="LATERAL" {% if exp.career_significance == 'LATERAL' %}selected{% endif %}>Lateral Move</option>
                            <option value="NEW_ROLE" {% if exp.career_significance == 'NEW_ROLE' %}selected{% endif %}>New Role</option>
                            <option value="COMPANY_CHANGE" {% if exp.career_significance == 'COMPANY_CHANGE' %}selected{% endif %}>Company Change</option>
                        </select>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_description{{ exp.id }}" class="form-label">Description</label>
                        <textarea name="description" id="id_description{{ exp.id }}" class="form-control" rows="3">{{ exp.description }}</textarea>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_salary_range{{ exp.id }}" class="form-label">Salary Range</label>
                        <input type="text" name="salary_range" id="id_salary_range{{ exp.id }}" class="form-control" value="{{ exp.salary_range }}">
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_achievements{{ exp.id }}" class="form-label">Key Achievements</label>
                        <textarea name="achievements" id="id_achievements{{ exp.id }}" class="form-control" rows="3">{{ exp.achievements }}</textarea>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_skills_gained{{ exp.id }}" class="form-label">Skills Gained</label>
                        <textarea name="skills_gained" id="id_skills_gained{{ exp.id }}" class="form-control" rows="2">{{ exp.skills_gained }}</textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" form="editExperienceForm{{ exp.id }}">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Experience Modal -->
<div class="modal fade" id="deleteExperienceModal{{ exp.id }}" tabindex="-1" aria-labelledby="deleteExperienceModalLabel{{ exp.id }}" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteExperienceModalLabel{{ exp.id }}">Delete Experience</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this experience? This action cannot be undone.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger delete-confirm-btn" data-item-id="{{ exp.id }}" data-item-type="experience">Delete</button>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<!-- Education Delete Modals -->
{% for education in education_list %}
{% if not education.is_primary %}
<div class="modal fade" id="deleteEducationModal{{ education.id }}" tabindex="-1" aria-labelledby="deleteEducationModalLabel{{ education.id }}" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteEducationModalLabel{{ education.id }}">Delete Education</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this education record? This action cannot be undone.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger delete-confirm-btn" data-item-id="{{ education.id }}" data-item-type="education">Delete</button>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endfor %}

<!-- Add Education Modal -->
<div class="modal fade" id="addEducationModal" tabindex="-1" aria-labelledby="addEducationModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addEducationModalLabel">Add Education</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="educationForm" method="post" action="{% url 'accounts:update_education' %}" class="needs-validation">
                    {% csrf_token %}
                    <div class="form-group mb-3">
                        <label for="id_program" class="form-label">Program</label>
                        <select name="program" id="id_program" class="form-select" required>
                            <option value="">Select program</option>
                            <option value="BSIT">Bachelor of Science in Information Technology</option>
                            <option value="BSCS">Bachelor of Science in Computer Science</option>
                            <option value="BSIS">Bachelor of Science in Information Systems</option>
                            <option value="BSA">Bachelor of Science in Accountancy</option>
                            <option value="BSBA">Bachelor of Science in Business Administration</option>
                            <option value="BEED">Bachelor of Elementary Education</option>
                            <option value="BSED">Bachelor of Secondary Education</option>
                            <option value="BSN">Bachelor of Science in Nursing</option>
                            <option value="BSCRIM">Bachelor of Science in Criminology</option>
                            <option value="BSHRM">Bachelor of Science in Hotel and Restaurant Management</option>
                            <option value="BSTM">Bachelor of Science in Tourism Management</option>
                            <option value="BSE">Bachelor of Science in Engineering</option>
                            <option value="BSP">Bachelor of Science in Psychology</option>
                            <option value="OTHER">Other Program</option>
                        </select>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_major" class="form-label">Major/Specialization</label>
                        <input type="text" name="major" id="id_major" class="form-control">
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_school" class="form-label">School/Campus</label>
                        <select name="school" id="id_school" class="form-select" required>
                            <option value="">Select campus</option>
                            <option value="NORSU-G">NORSU Guihulngan</option>
                            <option value="NORSU-BC">NORSU Bais City</option>
                            <option value="NORSU-MB">NORSU Mabinay</option>
                            <option value="NORSU-SC">NORSU Siaton</option>
                            <option value="NORSU-PC">NORSU Pamplona</option>
                            <option value="NORSU-SCC">NORSU Sta. Catalina</option>
                            <option value="NORSU-VC">NORSU Valencia</option>
                            <option value="OTHER">Other Campus</option>
                        </select>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_graduation_year" class="form-label">Graduation Year</label>
                        <input type="number" name="graduation_year" id="id_graduation_year" class="form-control" min="1950" max="2099" required>
                    </div>

                    <div class="form-group mb-3">
                        <label for="id_achievements" class="form-label">Achievements</label>
                        <textarea name="achievements" id="id_achievements" class="form-control" rows="3"></textarea>
                    </div>

                    <div class="form-group mb-3">
                        <div class="form-check">
                            <input type="checkbox" name="is_primary" id="id_is_primary" class="form-check-input">
                            <label for="id_is_primary" class="form-check-label">This is my primary education</label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" form="educationForm">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Skill Modal -->
<div class="modal fade" id="addSkillModal" tabindex="-1" aria-labelledby="addSkillModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addSkillModalLabel">Add New Skill</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addSkillForm" method="post" action="{% url 'accounts:update_skills' %}" class="needs-validation">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="skillName" class="form-label">Skill Name</label>
                        <input type="text" name="name" class="form-control" id="skillName" placeholder="e.g. JavaScript, Project Management" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="skillType" class="form-label">Skill Type</label>
                        <select name="skill_type" class="form-select" id="skillType" required>
                            <option value="TECH">Technical</option>
                            <option value="SOFT">Soft Skills</option>
                            <option value="LANG">Language</option>
                            <option value="CERT">Certification</option>
                            <option value="DOMAIN">Domain Knowledge</option>
                            <option value="TOOL">Tools & Software</option>
                            <option value="OTHER">Other</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="proficiency" class="form-label">Proficiency Level</label>
                        <select name="proficiency_level" class="form-select" id="proficiency" required>
                            <option value="1">Beginner</option>
                            <option value="2">Elementary</option>
                            <option value="3">Intermediate</option>
                            <option value="4">Advanced</option>
                            <option value="5">Expert</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="yearsExperience" class="form-label">Years of Experience</label>
                        <input type="number" name="years_experience" class="form-control" id="yearsExperience" min="0" placeholder="e.g. 2">
                    </div>
                    
                    <div class="mb-3">
                        <label for="lastUsed" class="form-label">Last Used</label>
                        <input type="date" name="last_used" class="form-control" id="lastUsed">
                        <small class="form-text text-muted">Leave blank if currently using this skill</small>
                    </div>
                    
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" name="is_primary" id="isPrimary">
                        <label class="form-check-label" for="isPrimary">
                            This is a primary/key skill
                        </label>
                        <small class="form-text text-muted d-block">Primary skills are given higher weight in job matching</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" form="addSkillForm">Add Skill</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('Profile detail page loaded');
    
    // Django messages are handled by the global processDjangoMessages() function
    console.log('Profile detail page loaded - messages will be processed globally');

    // Handle edit form submissions specifically
    document.addEventListener('submit', function(e) {
        const form = e.target;
        if (form.tagName === 'FORM' && form.id) {
            console.log(`Form submitted: ${form.id}, action: ${form.action}`);
            
            // Check if this is an edit form
            if (form.id.startsWith('editEducationForm') || form.id.startsWith('editExperienceForm')) {
                console.log('Edit form detected, allowing normal submission');
                // Let the form submit normally - the Django view will handle the redirect and messages
                return true;
            }
        }
    });

    // Handle delete buttons
    document.querySelectorAll('.delete-button').forEach(button => {
        button.addEventListener('click', function() {
            deleteItemId = this.dataset.itemId;
            deleteItemType = this.dataset.itemType;
            
            // Update modal text
            const modalBody = document.querySelector('#confirmDeleteModal .modal-body');
            if (deleteItemType === 'experience') {
                modalBody.textContent = 'Are you sure you want to delete this work experience? This action cannot be undone.';
            } else if (deleteItemType === 'education') {
                modalBody.textContent = 'Are you sure you want to delete this education record? This action cannot be undone.';
            } else {
                modalBody.textContent = 'Are you sure you want to delete this item? This action cannot be undone.';
            }
        });
    });
    
    // Handle confirm delete button with SweetAlert
    const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
    if (confirmDeleteBtn) {
        confirmDeleteBtn.addEventListener('click', function() {
            if (!deleteItemId || !deleteItemType) return;
            
            let url = '';
            let itemName = '';
            if (deleteItemType === 'experience') {
                url = `/accounts/update/experience/${deleteItemId}/delete/`;
                itemName = 'work experience';
            } else if (deleteItemType === 'education') {
                url = `/accounts/update/education/${deleteItemId}/delete/`;
                itemName = 'education record';
            } else {
                return;
            }
            
            // Use SweetAlert for confirmation
            Swal.fire({
                icon: 'warning',
                title: 'Confirm Deletion',
                text: `Are you sure you want to delete this ${itemName}? This action cannot be undone.`,
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Yes, delete it!',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Show loading state
                    Swal.fire({
                        title: 'Deleting...',
                        text: 'Please wait while we delete the item.',
                        allowOutsideClick: false,
                        allowEscapeKey: false,
                        showConfirmButton: false,
                        didOpen: () => {
                            Swal.showLoading();
                        }
                    });
                    
                    fetch(url, {
                        method: 'POST',
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest',
                            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            // Close modal
                            const modalInstance = bootstrap.Modal.getInstance(document.getElementById('confirmDeleteModal'));
                            modalInstance.hide();
                            
                            // Show success message
                            Swal.fire({
                                icon: 'success',
                                title: 'Deleted!',
                                text: 'The item has been deleted successfully.',
                                confirmButtonText: 'OK'
                            }).then(() => {
                                window.location.reload();
                            });
                        } else {
                            throw new Error(data.message || 'Delete operation failed');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Error deleting item: ' + error.message,
                            confirmButtonText: 'OK'
                        });
                    });
                }
            });
        });
    }
    
    // Initialize variables for delete functionality
    let deleteItemId = null;
    let deleteItemType = null;
});
</script>
{% endblock extra_js %}