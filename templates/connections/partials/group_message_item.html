<!-- Individual Group Message Item for HTMX -->
<div class="message {% if message.sender == request.user %}own{% endif %}" data-message-id="{{ message.id }}">
    <!-- Avatar for other users (left side) -->
    {% if message.sender != request.user %}
        <div class="me-3">
            {% if message.sender.profile.avatar %}
                <img src="{{ message.sender.profile.avatar.url }}"
                     alt="{{ message.sender.get_full_name }}"
                     class="message-avatar"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div class="message-avatar d-none align-items-center justify-content-center text-white fw-bold user-avatar"
                     data-user-id="{{ message.sender.id }}"
                     data-first-name="{{ message.sender.first_name }}"
                     data-last-name="{{ message.sender.last_name }}"
                     data-username="{{ message.sender.username }}"
                     style="font-size: 16px;">
                    <!-- Initials and gradient will be set by JavaScript -->
                </div>
            {% else %}
                <div class="message-avatar d-flex align-items-center justify-content-center text-white fw-bold user-avatar"
                     data-user-id="{{ message.sender.id }}"
                     data-first-name="{{ message.sender.first_name }}"
                     data-last-name="{{ message.sender.last_name }}"
                     data-username="{{ message.sender.username }}"
                     style="font-size: 16px;">
                    <!-- Initials and gradient will be set by JavaScript -->
                </div>
            {% endif %}
        </div>
    {% endif %}
    
    <div class="message-content">
        <!-- Sender name for group messages (except own messages) -->
        {% if message.sender != request.user %}
            <div class="message-sender-name">{{ message.sender.get_full_name }}</div>
        {% endif %}
        
        <div class="message-text">{{ message.content }}</div>
        
        {% if message.attachment %}
            <div class="message-attachment mt-2">
                {% if message.attachment.name|slice:"-4:" in ".jpg,.png,.gif,.jpeg" %}
                    <img src="{{ message.attachment.url }}" alt="Attachment" class="attachment-preview">
                {% else %}
                    <a href="{{ message.attachment.url }}" class="file-attachment" target="_blank">
                        <i class="fas fa-file me-2"></i>
                        {{ message.attachment.name }}
                    </a>
                {% endif %}
            </div>
        {% endif %}
        
        <div class="message-time">
            {{ message.created_at|date:"M d, Y H:i" }}
        </div>
    </div>
    
    <!-- Avatar for own messages (right side) -->
    {% if message.sender == request.user %}
        <div class="ms-3">
            {% if message.sender.profile.avatar %}
                <img src="{{ message.sender.profile.avatar.url }}"
                     alt="{{ message.sender.get_full_name }}"
                     class="message-avatar"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div class="message-avatar d-none align-items-center justify-content-center text-white fw-bold user-avatar"
                     data-user-id="{{ message.sender.id }}"
                     data-first-name="{{ message.sender.first_name }}"
                     data-last-name="{{ message.sender.last_name }}"
                     data-username="{{ message.sender.username }}"
                     style="font-size: 16px;">
                    <!-- Initials and gradient will be set by JavaScript -->
                </div>
            {% else %}
                <div class="message-avatar d-flex align-items-center justify-content-center text-white fw-bold user-avatar"
                     data-user-id="{{ message.sender.id }}"
                     data-first-name="{{ message.sender.first_name }}"
                     data-last-name="{{ message.sender.last_name }}"
                     data-username="{{ message.sender.username }}"
                     style="font-size: 16px;">
                    <!-- Initials and gradient will be set by JavaScript -->
                </div>
            {% endif %}
        </div>
    {% endif %}
</div>
