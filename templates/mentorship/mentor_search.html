{% extends 'base.html' %}
{% load static %}

{% block title %}Find a Mentor - NORSU Alumni System{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/mentorship.css' %}">
<style>
    /* Design System Variables */
    :root {
        --primary-color: #2b3c6b;
        --primary-hover: #1e2a4a;
        --text-primary: #1a1a1a;
        --text-secondary: #6b7280;
        --text-muted: #9ca3af;
        --text-light: #ffffff;
        --ui-background: #f8fafc;
        --ui-surface: #ffffff;
        --ui-border: #e5e7eb;
        --ui-hover: #f3f4f6;
        --ui-subtle: #f9fafb;
        --feedback-success: #10b981;
        --feedback-warning: #f59e0b;
        --feedback-error: #ef4444;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        --radius-sm: 0.375rem;
        --radius-md: 0.5rem;
        --radius-lg: 0.75rem;
        --space-xs: 0.25rem;
        --space-sm: 0.5rem;
        --space-md: 0.75rem;
        --space-lg: 1rem;
        --space-xl: 1.5rem;
        --space-2xl: 2rem;
    }

    /* Dashboard-Style Layout */
    .page-container {
        background: var(--ui-background);
        min-height: calc(100vh - 76px);
        padding: var(--space-lg);
        font-family: 'Poppins', sans-serif;
    }

    .dashboard-header {
        background: var(--primary-color);
        color: var(--text-light);
        padding: 1.75rem;
        border-radius: var(--radius-md);
        margin-bottom: 1.25rem;
        box-shadow: var(--shadow-sm);
        font-size: 0.875rem;
        font-family: 'Poppins', sans-serif;
    }

    .dashboard-header h1 {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 0.25rem;
        color: var(--text-light);
    }

    .dashboard-header p {
        opacity: 0.9;
        font-size: 0.875rem;
        margin: 0;
    }

    /* Content Sections */
    .content-section {
        background: var(--ui-surface);
        border: 1px solid var(--ui-border);
        border-radius: var(--radius-md);
        padding: var(--space-xl);
        margin-bottom: var(--space-lg);
        box-shadow: var(--shadow-sm);
    }

    .content-section h5 {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: var(--space-md);
    }

    /* Filter Section */
    .filter-section {
        background: var(--ui-surface);
        border: 1px solid var(--ui-border);
        border-radius: var(--radius-md);
        padding: var(--space-xl);
        box-shadow: var(--shadow-sm);
    }

    .filter-section h4 {
        font-size: 1rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: var(--space-lg);
    }

    /* Form Elements */
    .form-label {
        font-size: 0.8rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: var(--space-sm);
    }

    .form-control, .form-select {
        font-size: 0.8rem;
        border: 1px solid var(--ui-border);
        border-radius: var(--radius-sm);
        padding: var(--space-sm) var(--space-md);
        transition: all 0.15s ease;
    }

    .form-control:focus, .form-select:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(43, 60, 107, 0.1);
    }

    .form-text {
        font-size: 0.7rem;
        color: var(--text-muted);
        margin-top: var(--space-xs);
    }

    /* Button Styling */
    .btn {
        font-size: 0.8rem;
        font-weight: 500;
        padding: var(--space-sm) var(--space-lg);
        border-radius: var(--radius-sm);
        transition: all 0.15s ease;
        border: 1px solid transparent;
    }

    .btn-primary {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
        color: var(--text-light);
    }

    .btn-primary:hover {
        background-color: var(--primary-hover);
        border-color: var(--primary-hover);
        transform: translateY(-1px);
    }

    .btn-outline-primary {
        color: var(--primary-color);
        border-color: var(--primary-color);
        background: transparent;
    }

    .btn-outline-primary:hover {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
        color: var(--text-light);
    }

    .btn-outline-secondary {
        color: var(--text-secondary);
        border-color: var(--ui-border);
        background: transparent;
    }

    .btn-outline-secondary:hover {
        background-color: var(--ui-hover);
        border-color: var(--text-secondary);
        color: var(--text-primary);
    }

    /* Mentor Card Styling */
    .mentor-card {
        background: var(--ui-surface);
        border: 1px solid var(--ui-border);
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-sm);
        transition: all 0.15s ease;
        height: 100%;
    }

    .mentor-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
        border-color: var(--primary-color);
    }

    .mentor-card .card-body {
        padding: var(--space-xl);
    }

    .mentor-card .card-title {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: var(--space-xs);
    }

    .mentor-position {
        font-size: 0.75rem;
        color: var(--text-secondary);
        margin-bottom: var(--space-md);
    }

    .mentor-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        border: 2px solid var(--ui-border);
        object-fit: cover;
    }

    .availability-badge {
        font-size: 0.7rem;
        padding: var(--space-xs) var(--space-sm);
        border-radius: var(--radius-sm);
        font-weight: 500;
    }

    .availability-badge.available {
        background: rgba(16, 185, 129, 0.1);
        color: var(--feedback-success);
        border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .availability-badge.limited {
        background: rgba(245, 158, 11, 0.1);
        color: var(--feedback-warning);
        border: 1px solid rgba(245, 158, 11, 0.2);
    }

    .availability-badge.unavailable {
        background: rgba(239, 68, 68, 0.1);
        color: var(--feedback-error);
        border: 1px solid rgba(239, 68, 68, 0.2);
    }

    /* Tags Styling */
    .tags-container {
        margin-bottom: var(--space-md);
    }

    .tags-label {
        font-size: 0.7rem;
        font-weight: 600;
        color: var(--text-secondary);
        margin-bottom: var(--space-xs);
    }

    .tags .tag {
        display: inline-block;
        background: var(--ui-subtle);
        color: var(--text-secondary);
        font-size: 0.7rem;
        padding: var(--space-xs) var(--space-sm);
        border-radius: var(--radius-sm);
        border: 1px solid var(--ui-border);
        margin-right: var(--space-xs);
        margin-bottom: var(--space-xs);
    }

    .mentor-bio {
        font-size: 0.8rem;
        color: var(--text-secondary);
        line-height: 1.4;
        margin-bottom: var(--space-lg);
    }

    /* Input Group Styling */
    .input-group-text {
        border-color: var(--ui-border);
        font-size: 0.8rem;
    }

    /* Form Check Styling */
    .form-check-input:checked {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
    }

    .form-check-input:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.25rem rgba(43, 60, 107, 0.25);
    }

    /* Button Group Styling */
    .btn-group .btn.active {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
        color: var(--text-light);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .dashboard-header {
            padding: var(--space-lg);
        }

        .dashboard-header h1 {
            font-size: 1.25rem;
        }

        .content-section, .filter-section {
            padding: var(--space-lg);
        }

        .mentor-card .card-body {
            padding: var(--space-lg);
        }
    }
</style>
{% endblock %}



{% block content %}
<!-- Add CSRF token -->
{% csrf_token %}
<div class="page-container">
    <div class="container-fluid">
        <!-- Dashboard Header -->
        <div class="dashboard-header">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="mb-2"><i class="fas fa-users me-3"></i>Find Your Mentor</h1>
                    <p class="mb-0">Connect with experienced professionals who can guide you on your career journey</p>
                </div>
            </div>
        </div>

        <!-- Info Section -->
        <div class="content-section">
            <div class="d-flex align-items-start">
                <div class="me-3" style="color: var(--primary-color); font-size: 1.5rem;">
                    <i class="fas fa-info-circle"></i>
                </div>
                <div>
                    <h5 style="margin-bottom: var(--space-sm);">How to Find the Right Mentor</h5>
                    <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0;">
                        Use the search filters to find mentors that match your interests. Our mentorship program connects you with alumni who can provide guidance, share experiences, and help you achieve your career goals.
                    </p>
                </div>
            </div>
        </div>

        <div class="row g-4">
            <!-- Search and Filters -->
            <div class="col-lg-4">
                <div class="filter-section">
                    <h4>
                        <i class="fas fa-search me-2"></i>
                        Search Criteria
                    </h4>
                        <form id="mentorSearchForm">
                            <div class="mb-4">
                                <label for="expertise" class="form-label">Areas of Expertise</label>
                                <div class="input-group">
                                    <span class="input-group-text" style="background: var(--ui-subtle); border-color: var(--ui-border);">
                                        <i class="fas fa-lightbulb" style="color: var(--primary-color);"></i>
                                    </span>
                                    <input type="text" class="form-control" id="expertise" name="expertise"
                                           placeholder="e.g., Web Development, Data Science">
                                </div>
                                <div class="form-text">Enter skills or knowledge areas you're interested in</div>
                            </div>
                            
                            <div class="mb-4">
                                <label for="availability" class="form-label">Availability</label>
                                <select class="form-select" id="availability" name="availability">
                                    <option value="">Any Availability</option>
                                    <option value="AVAILABLE">Fully Available</option>
                                    <option value="LIMITED">Limited Availability</option>
                                </select>
                                <div class="form-text">Filter mentors by their current availability</div>
                            </div>

                            <div class="mb-4">
                                <label class="form-label">Experience Level</label>
                                <div class="form-check" style="padding-left: 1.5rem;">
                                    <input class="form-check-input" type="checkbox" id="experienced" name="experienced"
                                           style="margin-top: 0.25rem;">
                                    <label class="form-check-label" for="experienced" style="font-size: 0.8rem; color: var(--text-primary);">
                                        Experienced Mentors
                                    </label>
                                </div>
                                <div class="form-text" style="margin-left: 1.5rem;">Mentors with documented mentoring experience</div>
                            </div>
                            
                            <div class="mb-4">
                                <label for="sort" class="form-label">Sort By</label>
                                <select class="form-select" id="sort" name="sort">
                                    <option value="experience">Mentoring Experience</option>
                                    <option value="availability">Availability</option>
                                    <option value="recent">Recently Joined</option>
                                </select>
                                <div class="form-text">Choose how to sort your results</div>
                            </div>

                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-search me-2"></i>
                                Find Mentors
                            </button>
                        </form>
                </div>
            </div>
            
            <!-- Results -->
            <div class="col-lg-8">
                <div id="resultsHeader" class="content-section d-none">
                    <div class="d-flex justify-content-between align-items-center">
                        <div style="font-size: 0.875rem; font-weight: 600; color: var(--text-primary);">
                            <i class="fas fa-users me-2"></i>
                            <span id="resultsCount">0</span> mentors found
                        </div>
                        <div class="btn-group" role="group">
                            <button class="btn btn-sm btn-outline-secondary active" id="gridView">
                                <i class="fas fa-th-large"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" id="listView">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="searchResults" class="row g-4">
                    <!-- Results will be populated dynamically -->
                    <div class="col-12">
                        <div class="content-section text-center" style="padding: var(--space-2xl);">
                            <div style="color: var(--text-muted); font-size: 3rem; margin-bottom: var(--space-lg);">
                                <i class="fas fa-users"></i>
                            </div>
                            <h3 style="font-size: 1rem; font-weight: 600; color: var(--text-primary); margin-bottom: var(--space-md);">
                                Find Your Perfect Mentor Match
                            </h3>
                            <p style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: var(--space-lg);">
                                Use the search filters to discover mentors who align with your career goals and interests.
                            </p>
                            <button class="btn btn-primary" onclick="document.getElementById('mentorSearchForm').dispatchEvent(new Event('submit'))">
                                <i class="fas fa-search me-2"></i>
                                Search All Mentors
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Mentorship Request Modal -->
<div class="modal fade mentorship-request-modal" id="mentorshipRequestModal" tabindex="-1" aria-labelledby="mentorshipRequestModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="mentorshipRequestModalLabel">
                    <i class="fas fa-handshake me-2"></i>Request Mentorship
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    Please provide details about what you're looking to gain from this mentorship. Be specific about your goals and what skills you're hoping to develop.
                </div>
                
                <form id="mentorshipRequestForm">
                    <input type="hidden" id="mentorId" name="mentorId">
                    
                    <div class="mb-3">
                        <label for="skillsSeeking" class="form-label">Skills/Knowledge Areas You're Seeking Help With</label>
                        <input type="text" class="form-control" id="skillsSeeking" name="skillsSeeking" placeholder="e.g. Web Development, Leadership, Career Guidance">
                        <div class="form-text">List specific skills or knowledge areas you'd like guidance on.</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="goals" class="form-label">Your Mentorship Goals</label>
                        <textarea class="form-control" id="goals" name="goals" rows="3" placeholder="What do you hope to achieve through this mentorship?"></textarea>
                        <div class="form-text">Be specific about what you want to accomplish.</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="message" class="form-label">Introduction Message</label>
                        <textarea class="form-control" id="message" name="message" rows="4" placeholder="Introduce yourself and explain why you chose this mentor"></textarea>
                        <div class="form-text">This will be sent to the mentor as part of your request.</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cancel
                </button>
                <button type="button" class="btn btn-primary" id="submitRequest">
                    <i class="fas fa-paper-plane me-2"></i>Send Request
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Mentor Card Template -->
<template id="mentorCardTemplate">
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="mentor-card h-100 shadow-sm">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <div class="mentor-avatar-container me-3">
                        <img src="" alt="" class="mentor-avatar">
                    </div>
                    <div>
                        <h5 class="card-title mb-1"></h5>
                        <p class="mentor-position mb-0"></p>
                    </div>
                </div>
                
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <span class="availability-badge"></span>
                </div>
                
                <div class="tags-container mb-3">
                    <div class="tags-label">Expertise Areas</div>
                    <div class="tags"></div>
                </div>
                
                <p class="mentor-bio"></p>
                
                <div class="mt-auto">
                    <button class="btn btn-primary request-btn">
                        <i class="fas fa-handshake me-2"></i>Request Mentorship
                    </button>
                    <button class="btn btn-secondary own-profile-btn d-none" disabled>
                        <i class="fas fa-user-circle me-2"></i>This is Your Profile
                    </button>
                </div>
            </div>
        </div>
    </div>
</template>

{% endblock %}

{% block page_specific_js %}
<script src="{% static 'js/mentorship.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize CSRF token for AJAX requests
        const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        
        // Set up CSRF token for all AJAX requests
        function csrfSafeMethod(method) {
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }
        
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });
        
        // Initialize mentor search functionality
        initMentorSearch();
        
        // Trigger initial search to show all mentors
        document.getElementById('mentorSearchForm').dispatchEvent(new Event('submit'));
    });
</script>
{% endblock %}