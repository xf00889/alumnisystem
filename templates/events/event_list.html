{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Events{% endblock %}

{% block extra_css %}
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
    /* NORSU Alumni System - Events Design */
    :root {
        /* NORSU Brand Colors */
        --primary-color: #2b3c6b;
        --primary-dark: #1a2544;
        --primary-light: #3c4f8a;
        --secondary-color: #4a5568;
        --accent-color: #c8a882;
        
        /* UI Colors - Consistent with system */
        --ui-background: #f8f9fa;
        --ui-surface: #ffffff;
        --ui-border: #e2e8f0;
        --ui-hover: #edf2f7;
        --ui-selected: #e3f2fd;
        
        /* Text Colors */
        --text-primary: #2d3748;
        --text-secondary: #718096;
        --text-muted: #a0aec0;
        --text-light: #ffffff;
        
        /* Feedback Colors - NORSU Theme */
        --feedback-success: #28a745;
        --feedback-warning: #ffc107;
        --feedback-error: #dc3545;
        --feedback-info: #17a2b8;
        
        /* Event Status Colors */
        --status-draft: #6c757d;
        --status-published: #28a745;
        --status-cancelled: #dc3545;
        --status-completed: #17a2b8;
        
        /* Spacing Scale */
        --space-1: 0.25rem;
        --space-2: 0.5rem;
        --space-3: 0.75rem;
        --space-4: 1rem;
        --space-5: 1.25rem;
        --space-6: 1.5rem;
        --space-8: 2rem;
        
        /* Border Radius */
        --radius-sm: 0.25rem;
        --radius-md: 0.5rem;
        --radius-lg: 0.75rem;
        
        /* Shadows */
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    body {
        background-color: var(--ui-background);
        margin: 0;
        font-family: 'Poppins', sans-serif;
    }
    
    .container-fluid {
        padding: 1.5rem;
        max-width: 1200px;
        margin: 0 auto;
    }

    /* Header Section */
    .directory-header {
        background: var(--primary-color);
        color: var(--text-light);
        padding: 2rem;
        border-radius: var(--radius-md);
        margin-bottom: 1.5rem;
        box-shadow: var(--shadow-sm);
        text-align: center;
        font-family: 'Poppins', sans-serif;
    }
    
    .directory-title {
        font-size: 2rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        font-family: 'Poppins', sans-serif;
    }
    
    .directory-subtitle {
        opacity: 0.9;
        font-size: 1rem;
        margin: 0;
        font-family: 'Poppins', sans-serif;
    }
    
    /* Search Section */
    .search-section {
        background: var(--ui-surface);
        padding: 2rem;
        border-radius: var(--radius-md);
        margin-bottom: 1.5rem;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--ui-border);
        font-family: 'Poppins', sans-serif;
    }
    
    .search-form {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 2rem;
        align-items: end;
    }
    
    .search-group {
        display: flex;
        flex-direction: column;
    }
    
    .form-label {
        font-weight: 500;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
        font-size: 0.875rem;
        font-family: 'Poppins', sans-serif;
    }
    
    .search-container {
        position: relative;
    }

    .search-input {
        width: 100%;
        padding: 0.75rem 1rem 0.75rem 2.5rem;
        border: 1px solid var(--ui-border);
        border-radius: var(--radius-sm);
        font-size: 0.875rem;
        transition: all var(--transition-normal);
        background: var(--ui-surface);
        color: var(--text-primary);
        font-family: 'Poppins', sans-serif;
    }

    .search-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(43, 60, 107, 0.1);
    }
    
    .search-icon {
        position: absolute;
        left: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-secondary);
        font-size: 0.875rem;
    }
    
    .filter-group {
        display: flex;
        flex-direction: column;
    }
    
    .filter-buttons {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 0.5rem;
    }

    .filter-button {
        padding: 0.5rem 1rem;
        border: 1px solid var(--ui-border);
        background: var(--ui-surface);
        color: var(--text-primary);
        border-radius: var(--radius-sm);
        font-size: 0.75rem;
        font-weight: 500;
        cursor: pointer;
        transition: all var(--transition-normal);
        font-family: 'Poppins', sans-serif;
    }
    
    .filter-button:hover {
        border-color: var(--primary-color);
        background: var(--ui-hover);
    }
    
    .filter-button.active {
        border-color: var(--primary-color);
        background: var(--ui-selected);
        color: var(--primary-color);
    }
    
    .action-group {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
    }
    
    /* View Toggle Styles */
    .view-toggle-section {
        background: var(--ui-surface);
        padding: var(--space-4);
        border-radius: var(--radius-md);
        margin-bottom: var(--space-6);
        border: 1px solid var(--ui-border);
    }
    
    .view-toggle-container {
        display: flex;
        align-items: center;
        gap: var(--space-4);
    }

    .view-toggle-label {
        font-weight: 600;
        color: var(--text-primary);
        margin: 0;
    }

    .view-toggle-buttons {
        display: flex;
        gap: var(--space-2);
    }
    
    .view-toggle-btn {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        padding: var(--space-2) var(--space-4);
        border: 2px solid var(--ui-border);
        background: var(--ui-surface);
        color: var(--text-secondary);
        border-radius: var(--radius-md);
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .view-toggle-btn:hover {
        border-color: var(--primary-color);
        color: var(--primary-color);
    }
    
    .view-toggle-btn.active {
        background: var(--primary-color);
        color: var(--text-light);
        border-color: var(--primary-color);
    }
    
    /* Table View Styles */
    .events-table {
        display: none;
        background: var(--ui-surface);
        border-radius: var(--radius-md);
        overflow: hidden;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--ui-border);
        margin-bottom: 2rem;
    }
    
    .events-table.show {
        display: block;
    }
    
    .events-table table {
        width: 100%;
        border-collapse: collapse;
        font-family: 'Poppins', sans-serif;
    }
    
    .events-table th {
        background: var(--primary-color);
        color: var(--text-light);
        padding: var(--space-4);
        text-align: left;
        font-weight: 600;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .events-table td {
        padding: var(--space-4);
        border-bottom: 1px solid var(--ui-border);
        vertical-align: top;
    }
    
    .events-table tr:hover {
        background: var(--ui-hover);
    }
    
    .events-table tr:last-child td {
        border-bottom: none;
    }
    
    .table-title {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: var(--space-1);
    }
    
    .table-content {
        color: var(--text-secondary);
        font-size: 0.875rem;
        line-height: 1.4;
        margin-bottom: var(--space-2);
    }
    
    .table-meta {
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-3);
        font-size: 0.75rem;
        color: var(--text-muted);
    }
    
    .table-actions {
        display: flex;
        gap: var(--space-2);
    }
    
    .table-action-btn {
        padding: var(--space-1) var(--space-2);
        border: 1px solid var(--ui-border);
        background: var(--ui-surface);
        color: var(--text-secondary);
        border-radius: var(--radius-sm);
        font-size: 0.75rem;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .table-action-btn:hover {
        background: var(--primary-color);
        color: var(--text-light);
        border-color: var(--primary-color);
    }
    
    .table-checkbox {
        margin-right: var(--space-2);
    }

    /* Events Grid */
    .events-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .event-card {
        background: var(--ui-surface);
        border-radius: var(--radius-md);
        padding: 1.5rem;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--ui-border);
        font-family: 'Poppins', sans-serif;
        transition: all 0.3s ease;
        position: relative;
    }

    .event-card:hover {
        box-shadow: var(--shadow-md);
        transform: translateY(-2px);
    }
    
    .event-card.selected {
        border-color: var(--primary-color);
        background: var(--ui-selected);
    }
    
    .event-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1rem;
    }
    
    .event-checkbox {
        position: absolute;
        top: 1rem;
        left: 1rem;
    }
    
    .event-status {
        margin-left: 2rem;
    }

    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: var(--space-1);
        padding: var(--space-1) var(--space-2);
        border-radius: var(--radius-sm);
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .status-draft {
        background: var(--status-draft);
        color: var(--text-light);
    }

    .status-published {
        background: var(--status-published);
        color: var(--text-light);
    }

    .status-cancelled {
        background: var(--status-cancelled);
        color: var(--text-light);
    }

    .status-completed {
        background: var(--status-completed);
        color: var(--text-light);
    }

    .event-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--text-primary);
        margin: 0 0 0.75rem 0;
        font-family: 'Poppins', sans-serif;
    }
    
    .event-title a {
        color: var(--text-primary);
        text-decoration: none;
        transition: color var(--transition-fast);
    }
    
    .event-title a:hover {
        color: var(--primary-color);
    }
    
    .event-preview {
        color: var(--text-secondary);
        font-size: 0.875rem;
        line-height: 1.5;
        margin: 0;
    }
    
    .event-meta {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
    }
    
    .meta-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.75rem;
        color: var(--text-secondary);
        font-family: 'Poppins', sans-serif;
    }
    
    .meta-item i {
        width: 14px;
        color: var(--primary-color);
    }
    
    .event-actions {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
    }
    
    .view-details-btn {
        flex: 1;
        min-width: 120px;
    }
    
    .btn {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: var(--radius-sm);
        font-size: 0.75rem;
        font-weight: 500;
        font-family: 'Poppins', sans-serif;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        justify-content: center;
    }

    .btn-primary {
        background: var(--primary-color);
        color: var(--text-light);
    }

    .btn-primary:hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
        text-decoration: none;
        color: var(--text-light);
    }

    .btn-warning {
        background: var(--feedback-warning);
        color: var(--text-primary);
    }

    .btn-warning:hover {
        background: #e0a800;
        transform: translateY(-1px);
    }

    .btn-danger {
        background: var(--feedback-error);
        color: var(--text-light);
    }

    .btn-danger:hover {
        background: #c82333;
        transform: translateY(-1px);
    }
    
    .btn-secondary {
        background: var(--ui-hover);
        color: var(--text-primary);
        border: 1px solid var(--ui-border);
    }
    
    .btn-secondary:hover {
        background: var(--ui-border);
        color: var(--text-primary);
        text-decoration: none;
    }
    
    /* Pagination */
    .pagination-container {
        background: var(--ui-surface);
        padding: var(--space-5);
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--ui-border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
    }
    
    .pagination-info {
        color: var(--text-secondary);
        font-size: 0.875rem;
        font-family: 'Poppins', sans-serif;
    }

    .pagination {
        display: flex;
        list-style: none;
        margin: 0;
        padding: 0;
        gap: 0.25rem;
    }

    .page-item {
        display: flex;
    }

    .page-link {
        padding: 0.5rem 0.75rem;
        border: 1px solid var(--ui-border);
        background: var(--ui-surface);
        color: var(--text-primary);
        text-decoration: none;
        border-radius: var(--radius-sm);
        font-size: 0.875rem;
        font-weight: 500;
        transition: all var(--transition-normal);
        display: flex;
        align-items: center;
        gap: 0.25rem;
        font-family: 'Poppins', sans-serif;
    }

    .page-link:hover {
        background: var(--ui-hover);
        border-color: var(--primary-color);
        color: var(--primary-color);
        text-decoration: none;
    }

    .page-item.active .page-link {
        background: var(--primary-color);
        color: var(--text-light);
        border-color: var(--primary-color);
    }
    
    /* Modal Styles */
    .modal {
        display: none;
        position: fixed;
        z-index: 1050;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
    }
    
    .modal.show {
        display: flex;
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.3s ease;
    }
    
    .modal-dialog {
        background: var(--ui-surface);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-lg);
        max-width: 900px;
        width: 95%;
        max-height: 95vh;
        overflow: hidden;
        animation: slideIn 0.3s ease;
        border: 1px solid var(--ui-border);
        position: relative;
        z-index: 1050;
        pointer-events: auto;
    }
    
    .modal-header {
        background: var(--primary-color);
        color: var(--text-light);
        padding: var(--space-4);
        border-bottom: none;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .modal-title {
        font-size: 1.25rem;
        font-weight: 600;
        margin: 0;
        flex: 1;
    }
    
    .modal-close {
        background: none;
        border: none;
        color: var(--text-light);
        font-size: 1.5rem;
        cursor: pointer;
        padding: 0;
        width: 2rem;
        height: 2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: background-color var(--transition-fast);
    }
    
    .modal-close:hover {
        background-color: rgba(255, 255, 255, 0.1);
    }
    
    .modal-body {
        padding: var(--space-5);
        max-height: 60vh;
        overflow-y: auto;
    }
    
    .modal-event-header {
        margin-bottom: var(--space-4);
    }
    
    .modal-event-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--text-primary);
        margin: 0 0 var(--space-3) 0;
        line-height: 1.3;
    }
    
    .modal-status-badge {
        display: inline-flex;
        align-items: center;
        gap: var(--space-1);
        padding: var(--space-1) var(--space-2);
        border-radius: var(--radius-sm);
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: var(--space-3);
    }
    
    .modal-event-meta {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: var(--space-3);
        margin-bottom: var(--space-4);
        padding: var(--space-3);
        background: var(--ui-background);
        border-radius: var(--radius-md);
    }
    
    .modal-meta-item {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        font-size: 0.875rem;
        color: var(--text-secondary);
    }
    
    .modal-meta-item i {
        width: 16px;
        color: var(--primary-color);
    }
    
    .modal-event-content {
        color: var(--text-primary);
        font-size: 1rem;
        line-height: 1.6;
        background: var(--ui-background);
        padding: var(--space-4);
        border-radius: var(--radius-md);
        border: 1px solid var(--ui-border);
    }
    
    .modal-footer {
        padding: var(--space-4);
        background: var(--ui-background);
        border-top: 1px solid var(--ui-border);
        display: flex;
        flex-direction: column;
        gap: var(--space-3);
        pointer-events: auto;
        position: relative;
        z-index: 10;
    }
    
    .modal-footer .btn {
        padding: var(--space-2) var(--space-3);
        font-size: 0.875rem;
    }
    
    .modal-actions {
        display: flex;
        gap: var(--space-2);
        justify-content: flex-end;
        flex-wrap: wrap;
    }
    
    .modal-share-section {
        border-top: 1px solid var(--ui-border);
        padding-top: var(--space-3);
        margin-top: var(--space-3);
    }
    
    .modal-share-title {
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin-bottom: var(--space-2);
        font-weight: 500;
    }
    
    .modal-share-buttons {
        display: flex;
        gap: var(--space-2);
        flex-wrap: wrap;
    }
    
    .modal-share-button {
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-light);
        transition: all var(--transition-normal);
        text-decoration: none;
        border: none;
        cursor: pointer;
        font-size: 0.875rem;
        position: relative;
        z-index: 10;
    }
    
    .modal-share-button:hover {
        transform: translateY(-2px);
        color: var(--text-light);
        text-decoration: none;
        box-shadow: var(--shadow-md);
        cursor: pointer;
    }
    
    .modal-share-button:active {
        transform: translateY(0);
    }
    
    .modal-share-facebook { 
        background: #1877f2; 
    }
    .modal-share-facebook:hover { 
        background: #166fe5; 
    }
    
    .modal-share-twitter { 
        background: #1da1f2; 
    }
    .modal-share-twitter:hover { 
        background: #1a91da; 
    }
    
    .modal-share-linkedin { 
        background: #0a66c2; 
    }
    .modal-share-linkedin:hover { 
        background: #0959a8; 
    }
    
    .modal-share-email { 
        background: #ea4335; 
    }
    .modal-share-email:hover { 
        background: #d33b2c; 
    }
    
    .modal-share-whatsapp { 
        background: #25d366; 
    }
    .modal-share-whatsapp:hover { 
        background: #22c55e; 
    }
    
    .modal-share-telegram { 
        background: #0088cc; 
    }
    .modal-share-telegram:hover { 
        background: #0077b3; 
    }
    
    /* Loading Spinner */
    .spinner-border {
        display: inline-block;
        width: 2rem;
        height: 2rem;
        vertical-align: text-bottom;
        border: 0.25em solid currentColor;
        border-right-color: transparent;
        border-radius: 50%;
        animation: spinner-border 0.75s linear infinite;
    }
    
    .spinner-border.text-primary {
        color: var(--primary-color) !important;
    }
    
    @keyframes spinner-border {
        to { transform: rotate(360deg); }
    }
    
    /* Modal Animations */
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    @keyframes slideIn {
        from { 
            opacity: 0;
            transform: translateY(-50px) scale(0.95);
        }
        to { 
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .search-form {
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }
        
        .action-group {
            grid-column: 1 / -1;
            justify-self: start;
            margin-top: 1rem;
        }
    }
    
    @media (max-width: 768px) {
        .events-grid {
            grid-template-columns: 1fr;
        }
        
        .search-form {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        
        .event-meta {
            grid-template-columns: 1fr;
        }
        
        .view-toggle-container {
            flex-direction: column;
            align-items: flex-start;
            gap: var(--space-3);
        }

        .view-toggle-buttons {
            width: 100%;
        }
        
        .view-toggle-btn {
            flex: 1;
            justify-content: center;
        }
        
        .events-table {
            overflow-x: auto;
        }
        
        .events-table table {
            min-width: 600px;
        }
        
        .table-actions {
            flex-direction: column;
            gap: var(--space-1);
        }
        
        .filter-buttons {
            grid-template-columns: repeat(2, 1fr);
        }
    }
    
    @media (max-width: 480px) {
        .filter-buttons {
            grid-template-columns: 1fr;
        }
        
        .pagination-container {
            flex-direction: column;
            text-align: center;
        }
        
        .modal-dialog {
            width: 95%;
            margin: var(--space-4);
        }
        
        .modal-event-meta {
            grid-template-columns: 1fr;
        }

        .modal-footer {
            flex-direction: column;
        }
        
        .modal-footer .btn {
            width: 100%;
            justify-content: center;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header Section -->
    <div class="directory-header">
        <h1 class="directory-title">Events</h1>
        <p class="directory-subtitle">Discover and manage upcoming events and activities</p>
    </div>
    
    <!-- View Toggle Section -->
    <div class="view-toggle-section">
        <div class="view-toggle-container">
            <label class="view-toggle-label">View Mode:</label>
            <div class="view-toggle-buttons">
                <button type="button" id="cardViewBtn" class="view-toggle-btn active" data-view="card">
                    <i class="fas fa-th-large"></i>
                    Card View
                </button>
                <button type="button" id="tableViewBtn" class="view-toggle-btn" data-view="table">
                    <i class="fas fa-table"></i>
                    Tabular View
                </button>
            </div>
        </div>
    </div>

    <!-- Search Section -->
    <div class="search-section">
        <div class="search-form">
            <div class="search-group">
                <label for="searchInput" class="form-label">Search Events</label>
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" 
                           id="searchInput" 
                           class="search-input" 
                           placeholder="Search by title or description...">
                </div>
            </div>
            <div class="filter-group">
                <label class="form-label">Filter by Status</label>
                <div class="filter-buttons">
                    <button class="filter-button active" data-filter="all">All</button>
                    <button class="filter-button" data-filter="published">Published</button>
                    <button class="filter-button" data-filter="draft">Draft</button>
                    <button class="filter-button" data-filter="cancelled">Cancelled</button>
                    <button class="filter-button" data-filter="completed">Completed</button>
                </div>
            </div>
            <div class="action-group">
                {% if user.is_authenticated %}
                    <a href="{% url 'events:event_create' %}" class="btn btn-primary">
                        <i class="fas fa-plus me-2"></i>New Event
                    </a>
                {% endif %}
                <button class="btn btn-secondary" onclick="handleExport()">
                    <i class="fas fa-download me-2"></i>Export
                </button>
            </div>
        </div>
    </div>

    <!-- Events Grid -->
    {% if events %}
    <div class="events-grid" id="eventsGrid">
        {% for event in events %}
        <div class="event-card" data-id="{{ event.pk }}">
            <div class="event-header">
                <div class="event-checkbox">
                    <input type="checkbox" class="row-checkbox form-check-input" 
                           value="{{ event.pk }}">
                </div>
                <div class="event-status">
                    <span class="status-badge status-{{ event.status }}">
                        <i class="fas {% if event.status == 'published' %}fa-check-circle{% elif event.status == 'draft' %}fa-edit{% elif event.status == 'cancelled' %}fa-times-circle{% else %}fa-calendar-check{% endif %}"></i>
                        {{ event.get_status_display }}
                    </span>
                </div>
            </div>
            
            <div class="event-content">
                <h3 class="event-title">
                    <a href="{% url 'events:event_detail' event.pk %}">
                        {{ event.title }}
                    </a>
                </h3>
                <p class="event-preview">
                    {{ event.description|striptags|truncatewords:20 }}
                </p>
            </div>

            <div class="event-meta">
                <div class="meta-item">
                    <i class="fas fa-calendar"></i>
                    <span>{{ event.start_date|date:"M d, Y" }}</span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-clock"></i>
                    <span>{{ event.start_date|date:"g:i A" }}</span>
                </div>
                <div class="meta-item">
                    <i class="fas {% if event.is_virtual %}fa-video{% else %}fa-map-marker-alt{% endif %}"></i>
                    <span>{% if event.is_virtual %}Virtual Event{% else %}{{ event.location }}{% endif %}</span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-users"></i>
                    <span>{{ event.rsvps.count }} RSVPs</span>
                </div>
            </div>

            <div class="event-actions">
                <button class="btn btn-primary view-details-btn" 
                        data-event-id="{{ event.pk }}">
                    <i class="fas fa-eye me-1"></i>
                    View Details
                </button>
                {% if user.is_authenticated %}
                <a href="{% url 'events:event_update' event.pk %}" 
                   class="btn btn-warning">
                    <i class="fas fa-edit"></i>
                </a>
                <a href="{% url 'events:event_delete' event.pk %}" 
                   class="btn btn-danger">
                    <i class="fas fa-trash"></i>
                </a>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Table View -->
    <div class="events-table" id="eventsTable">
        <table>
            <thead>
                <tr>
                    <th width="5%">
                        <input type="checkbox" id="selectAllTable" class="form-check-input">
                    </th>
                    <th width="25%">Title</th>
                    <th width="35%">Description</th>
                    <th width="15%">Status</th>
                    <th width="10%">Date</th>
                    <th width="10%">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for event in events %}
                <tr data-id="{{ event.pk }}">
                    <td>
                        <input type="checkbox" class="row-checkbox form-check-input table-checkbox" 
                               value="{{ event.pk }}">
                    </td>
                    <td>
                        <div class="table-title">{{ event.title }}</div>
                        <div class="table-meta">
                            <span><i class="fas fa-calendar"></i> {{ event.start_date|date:"M d, Y" }}</span>
                            <span><i class="fas fa-users"></i> {{ event.rsvps.count }} RSVPs</span>
                        </div>
                    </td>
                    <td>
                        <div class="table-content">{{ event.description|truncatewords:20 }}</div>
                        <div class="table-meta">
                            <span><i class="fas {% if event.is_virtual %}fa-video{% else %}fa-map-marker-alt{% endif %}"></i> {% if event.is_virtual %}Virtual Event{% else %}{{ event.location }}{% endif %}</span>
                        </div>
                    </td>
                    <td>
                        <span class="status-badge status-{{ event.status }}">
                            <i class="fas {% if event.status == 'published' %}fa-check-circle{% elif event.status == 'draft' %}fa-edit{% elif event.status == 'cancelled' %}fa-times-circle{% else %}fa-calendar-check{% endif %}"></i>
                            {{ event.get_status_display }}
                        </span>
                    </td>
                    <td>
                        <div class="table-meta">
                            <span>{{ event.start_date|date:"M d, Y" }}</span>
                            <span>{{ event.start_date|date:"g:i A" }}</span>
                        </div>
                    </td>
                    <td>
                        <div class="table-actions">
                            <button class="table-action-btn view-details-btn" data-event-id="{{ event.pk }}">
                                <i class="fas fa-eye"></i>
                            </button>
                            {% if user.is_staff %}
                            <a href="{% url 'events:event_update' event.pk %}" class="table-action-btn">
                                <i class="fas fa-edit"></i>
                            </a>
                            <button class="table-action-btn delete-btn" data-id="{{ event.pk }}">
                                <i class="fas fa-trash"></i>
                            </button>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% else %}
    <div class="text-center py-5">
        <div class="mb-4">
            <i class="fas fa-calendar-times fa-3x text-muted"></i>
        </div>
        <h4 class="text-muted mb-3">No events found</h4>
        <p class="text-muted mb-4">
            {% if user.is_authenticated %}
            Create your first event to get started
            {% else %}
            There are no events available at the moment
            {% endif %}
        </p>
        {% if user.is_authenticated %}
        <a href="{% url 'events:event_create' %}" class="btn btn-primary">
            <i class="fas fa-plus me-2"></i>
            Create Event
        </a>
        {% endif %}
    </div>
    {% endif %}

    <!-- Event Detail Modal -->
    <div class="modal" id="eventModal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h2 class="modal-title">Event Details</h2>
                <button class="modal-close" onclick="closeEventModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Content will be loaded here -->
            </div>
            <div class="modal-footer">
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeEventModal()">
                        <i class="fas fa-times me-1"></i>
                        Close
                    </button>
                    <button class="btn btn-primary" id="modalEditBtn" style="display: none;">
                        <i class="fas fa-edit me-1"></i>
                        Edit
                    </button>
                    <button class="btn btn-danger" id="modalDeleteBtn" style="display: none;">
                        <i class="fas fa-trash me-1"></i>
                        Delete
                    </button>
                </div>
                
                <div class="modal-share-section">
                    <h4 class="modal-share-title">
                        <i class="fas fa-share-alt me-1"></i>
                        Share this event
                    </h4>
                    <div class="modal-share-buttons">
                        <button class="modal-share-button modal-share-facebook" 
                                data-share-action="shareToFacebook" 
                                title="Share on Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </button>
                        <button class="modal-share-button modal-share-twitter" 
                                data-share-action="shareToTwitter" 
                                title="Share on Twitter">
                            <i class="fab fa-twitter"></i>
                        </button>
                        <button class="modal-share-button modal-share-linkedin" 
                                data-share-action="shareToLinkedIn" 
                                title="Share on LinkedIn">
                            <i class="fab fa-linkedin-in"></i>
                        </button>
                        <button class="modal-share-button modal-share-whatsapp" 
                                data-share-action="shareToWhatsApp" 
                                title="Share on WhatsApp">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                        <button class="modal-share-button modal-share-telegram" 
                                data-share-action="shareToTelegram" 
                                title="Share on Telegram">
                            <i class="fab fa-telegram-plane"></i>
                        </button>
                        <button class="modal-share-button modal-share-email" 
                                data-share-action="shareViaEmail" 
                                title="Share via Email">
                            <i class="fas fa-envelope"></i>
                        </button>
                        <button class="modal-share-button" 
                                style="background: var(--primary-color);" 
                                data-share-action="copyToClipboard" 
                                title="Copy Link">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
class EventsTable {
    constructor() {
        this.selectedRows = new Set();
        this.searchInput = document.getElementById('searchInput');
        this.currentView = localStorage.getItem('eventsView') || 'card';
        this.initViewToggle();
        this.selectedCount = document.getElementById('selectedCount');
        this.filterButtons = document.querySelectorAll('.filter-button');
        this.cards = document.querySelectorAll('.event-card');
        
        this.init();
    }
    
    init() {
        this.setupSearch();
        this.setupFilters();
        this.setupCheckboxes();
        this.setInitialView();
    }
    
    initViewToggle() {
        const cardViewBtn = document.getElementById('cardViewBtn');
        const tableViewBtn = document.getElementById('tableViewBtn');
        const eventsGrid = document.getElementById('eventsGrid');
        const eventsTable = document.getElementById('eventsTable');
        
        if (cardViewBtn) {
            cardViewBtn.addEventListener('click', () => {
                this.switchView('card');
            });
        }
        
        if (tableViewBtn) {
            tableViewBtn.addEventListener('click', () => {
                this.switchView('table');
            });
        }
    }
    
    switchView(view) {
        const cardViewBtn = document.getElementById('cardViewBtn');
        const tableViewBtn = document.getElementById('tableViewBtn');
        const eventsGrid = document.getElementById('eventsGrid');
        const eventsTable = document.getElementById('eventsTable');
        
        // Update button states
        if (view === 'card') {
            cardViewBtn.classList.add('active');
            tableViewBtn.classList.remove('active');
            eventsGrid.style.display = 'grid';
            eventsTable.classList.remove('show');
        } else {
            tableViewBtn.classList.add('active');
            cardViewBtn.classList.remove('active');
            eventsGrid.style.display = 'none';
            eventsTable.classList.add('show');
        }
        
        // Save preference
        localStorage.setItem('eventsView', view);
        this.currentView = view;
    }
    
    setInitialView() {
        this.switchView(this.currentView);
    }
    
    setupSearch() {
        if (this.searchInput) {
            this.searchInput.addEventListener('input', this.debounce((e) => {
                this.filterCards();
            }, 300));
        }
    }
    
    setupFilters() {
        this.filterButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                this.filterButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                this.filterCards();
            });
        });
    }
    
    setupCheckboxes() {
        // Select all checkbox
        const selectAll = document.getElementById('selectAllTable');
        if (selectAll) {
            selectAll.addEventListener('change', (e) => {
                this.cards.forEach(card => {
                    const checkbox = card.querySelector('.row-checkbox');
                    if (checkbox) {
                        checkbox.checked = e.target.checked;
                        if (e.target.checked) {
                            this.selectedRows.add(checkbox.value);
                            card.classList.add('selected');
                        } else {
                            this.selectedRows.delete(checkbox.value);
                            card.classList.remove('selected');
                        }
                    }
                });
                this.updateBulkActions();
            });
        }
        
        // Individual checkboxes
        this.cards.forEach(card => {
            const checkbox = card.querySelector('.row-checkbox');
            if (checkbox) {
                checkbox.addEventListener('change', (e) => {
                    if (e.target.checked) {
                        this.selectedRows.add(e.target.value);
                        card.classList.add('selected');
                    } else {
                        this.selectedRows.delete(e.target.value);
                        card.classList.remove('selected');
                    }
                    this.updateBulkActions();
                });
            }
        });
    }
    
    filterCards() {
        const searchTerm = this.searchInput ? this.searchInput.value.toLowerCase() : '';
        const activeFilter = document.querySelector('.filter-button.active');
        const filterValue = activeFilter ? activeFilter.dataset.filter : 'all';
        
        this.cards.forEach(card => {
            const title = card.querySelector('.event-title a').textContent.toLowerCase();
            const content = card.querySelector('.event-preview').textContent.toLowerCase();
            const status = card.querySelector('.status-badge').textContent.toLowerCase();
            
            const matchesSearch = title.includes(searchTerm) || content.includes(searchTerm);
            const matchesFilter = filterValue === 'all' || status.includes(filterValue);
            
            if (matchesSearch && matchesFilter) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }
    
    updateBulkActions() {
        // This would be implemented if bulk actions are needed
    }
    
    debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    new EventsTable();
    
    // Handle view details button clicks
    document.addEventListener('click', (e) => {
        if (e.target.closest('.view-details-btn')) {
            const button = e.target.closest('.view-details-btn');
            const eventId = button.dataset.eventId;
            openEventModal(eventId);
        }
    });
});

// SweetAlert Utils
const SweetAlertUtils = {
    confirmDelete: (title, text) => {
        return Swal.fire({
            title: title,
            text: text,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#dc3545',
            cancelButtonColor: '#6c757d',
            confirmButtonText: 'Yes, delete it!',
            cancelButtonText: 'Cancel'
        });
    },
    
    success: (title, text) => {
        return Swal.fire({
            title: title,
            text: text,
            icon: 'success',
            confirmButtonColor: '#28a745'
        });
    },
    
    error: (title, text) => {
        return Swal.fire({
            title: title,
            text: text,
            icon: 'error',
            confirmButtonColor: '#dc3545'
        });
    }
};

function handleExport() {
    SweetAlertUtils.success('Export Started', 'Exporting all events...');
}

// Modal Functions
function openEventModal(eventId) {
    console.log('Opening modal for event ID:', eventId);
    
    if (!eventId || eventId === 'undefined') {
        console.error('Invalid event ID:', eventId);
        alert('Error: Invalid event ID');
        return;
    }
    
    const modal = document.getElementById('eventModal');
    const modalBody = document.getElementById('modalBody');
    const modalEditBtn = document.getElementById('modalEditBtn');
    const modalDeleteBtn = document.getElementById('modalDeleteBtn');
            
    // Show loading state
    modalBody.innerHTML = `
        <div class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading event details...</p>
        </div>
    `;
    
    // Show modal
    modal.classList.add('show');
    document.body.style.overflow = 'hidden';
    
    // Fetch event details
    console.log('Fetching from URL:', `/events/${eventId}/`);
    fetch(`/events/${eventId}/`)
        .then(response => {
            console.log('Response status:', response.status);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.text();
        })
        .then(html => {
            console.log('Received HTML response');
            // Extract content from the response
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // Extract event details
            const title = doc.querySelector('.event-title')?.textContent || 'Event';
            const status = doc.querySelector('.status-badge')?.textContent || '';
            const statusClass = doc.querySelector('.status-badge')?.className || '';
            const content = doc.querySelector('.event-content')?.innerHTML || '';
            const metaItems = doc.querySelectorAll('.meta-item');
            
            // Build modal content
            let metaHtml = '';
            metaItems.forEach(item => {
                const icon = item.querySelector('i')?.className || '';
                const text = item.textContent.trim();
                metaHtml += `
                    <div class="modal-meta-item">
                        <i class="${icon}"></i>
                        <span>${text}</span>
                    </div>
                `;
            });
            
            modalBody.innerHTML = `
                <div class="modal-event-header">
                    <h3 class="modal-event-title">${title}</h3>
                    <span class="modal-status-badge ${statusClass}">${status}</span>
                </div>
                
                <div class="modal-event-meta">
                    ${metaHtml}
                </div>
                
                <div class="modal-event-content">
                    ${content}
                </div>
            `;
            
            // Store event data for sharing
            const eventData = {
                id: eventId,
                title: title,
                content: content.replace(/<[^>]*>/g, ''), // Strip HTML tags
                status: status
            };
            setCurrentEventData(eventData);
            
            // Show action buttons for authenticated users
            const isAuthenticated = document.body.dataset.userAuthenticated === 'true';
            if (isAuthenticated) {
                modalEditBtn.style.display = 'inline-flex';
                modalDeleteBtn.style.display = 'inline-flex';
                modalEditBtn.onclick = () => window.location.href = `/events/${eventId}/update/`;
                modalDeleteBtn.onclick = () => {
                    if (confirm('Are you sure you want to delete this event?')) {
                        window.location.href = `/events/${eventId}/delete/`;
                    }
                };
            }
        })
        .catch(error => {
            console.error('Error loading event:', error);
            console.error('Error details:', error.message);
            modalBody.innerHTML = `
                <div class="text-center py-4">
                    <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                    <h4>Error Loading Event</h4>
                    <p class="text-muted">Unable to load event details. Please try again.</p>
                    <p class="text-danger small">Error: ${error.message}</p>
                    <button class="btn btn-primary" onclick="openEventModal('${eventId}')">
                        <i class="fas fa-refresh me-1"></i>
                        Retry
                    </button>
                </div>
            `;
        });
}

function closeEventModal() {
    const modal = document.getElementById('eventModal');
    modal.classList.remove('show');
    document.body.style.overflow = 'auto';
    
    // Reset modal content
    setTimeout(() => {
        document.getElementById('modalBody').innerHTML = '<!-- Content will be loaded here -->';
        document.getElementById('modalEditBtn').style.display = 'none';
        document.getElementById('modalDeleteBtn').style.display = 'none';
    }, 300);
}

// Close modal when clicking outside (but not inside modal content)
document.addEventListener('click', (e) => {
    const modal = document.getElementById('eventModal');
    const modalDialog = modal?.querySelector('.modal-dialog');
    
    if (modal && modal.classList.contains('show') && e.target === modal) {
        // Only close if clicking on the backdrop, not inside the modal dialog
        if (!modalDialog?.contains(e.target)) {
            closeEventModal();
        }
    }
});

// Close modal with Escape key
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        closeEventModal();
    }
});

// Share Functions
let currentEventData = null;

function setCurrentEventData(data) {
    currentEventData = data;
}

// Generic share button click handler
function handleShareClick(event) {
    event.preventDefault();
    event.stopPropagation();
    
    console.log('Share button clicked:', event.target);
    
    const shareAction = event.target.getAttribute('data-share-action') || 
                       event.target.closest('[data-share-action]')?.getAttribute('data-share-action');
    
    console.log('Share action:', shareAction);
    
    if (shareAction && typeof window[shareAction] === 'function') {
        console.log('Calling share function:', shareAction);
        window[shareAction](event);
    } else {
        console.error('Share action not found or function does not exist:', shareAction);
        SweetAlertUtils.error('Error', 'Share function not available');
    }
}

// Add event listeners to share buttons
document.addEventListener('click', (e) => {
    if (e.target.closest('.modal-share-button')) {
        e.preventDefault();
        e.stopPropagation();
        handleShareClick(e);
    }
});

function shareToFacebook(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }
    
    if (!currentEventData) {
        SweetAlertUtils.error('Error', 'No event data available for sharing');
        return;
    }
    
    const url = encodeURIComponent(window.location.origin + `/events/${currentEventData.id}/`);
    const text = encodeURIComponent(currentEventData.title);
    const shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${text}`;
    
    window.open(shareUrl, 'facebook-share', 'width=600,height=400,scrollbars=yes,resizable=yes');
}

function shareToTwitter(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }
    
    if (!currentEventData) {
        SweetAlertUtils.error('Error', 'No event data available for sharing');
        return;
    }
    
    const url = encodeURIComponent(window.location.origin + `/events/${currentEventData.id}/`);
    const text = encodeURIComponent(`Check out this event: ${currentEventData.title}`);
    const shareUrl = `https://twitter.com/intent/tweet?url=${url}&text=${text}`;
    
    window.open(shareUrl, 'twitter-share', 'width=600,height=400,scrollbars=yes,resizable=yes');
}

function shareToLinkedIn(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }
    
    if (!currentEventData) {
        SweetAlertUtils.error('Error', 'No event data available for sharing');
        return;
    }
    
    const url = encodeURIComponent(window.location.origin + `/events/${currentEventData.id}/`);
    const title = encodeURIComponent(currentEventData.title);
    const summary = encodeURIComponent(currentEventData.content || '');
    const shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${url}&title=${title}&summary=${summary}`;
    
    window.open(shareUrl, 'linkedin-share', 'width=600,height=400,scrollbars=yes,resizable=yes');
}

function shareToWhatsApp(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }
    
    if (!currentEventData) {
        SweetAlertUtils.error('Error', 'No event data available for sharing');
        return;
    }
    
    const url = window.location.origin + `/events/${currentEventData.id}/`;
    const text = `Check out this event: ${currentEventData.title}\n\n${url}`;
    const shareUrl = `https://wa.me/?text=${encodeURIComponent(text)}`;
    
    window.open(shareUrl, 'whatsapp-share', 'width=600,height=400,scrollbars=yes,resizable=yes');
}

function shareToTelegram(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }
    
    if (!currentEventData) {
        SweetAlertUtils.error('Error', 'No event data available for sharing');
        return;
    }
    
    const url = window.location.origin + `/events/${currentEventData.id}/`;
    const text = `Check out this event: ${currentEventData.title}\n\n${url}`;
    const shareUrl = `https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`;
    
    window.open(shareUrl, 'telegram-share', 'width=600,height=400,scrollbars=yes,resizable=yes');
}

function shareViaEmail(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }
    
    if (!currentEventData) {
        SweetAlertUtils.error('Error', 'No event data available for sharing');
        return;
    }
    
    const url = window.location.origin + `/events/${currentEventData.id}/`;
    const subject = `Event: ${currentEventData.title}`;
    const body = `Check out this event:\n\n${currentEventData.title}\n\n${currentEventData.content || ''}\n\nView full details: ${url}`;
    
    const mailtoUrl = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    window.location.href = mailtoUrl;
}

// Copy to clipboard function
function copyToClipboard(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }
    
    if (!currentEventData) {
        SweetAlertUtils.error('Error', 'No event data available for copying');
        return;
    }
    
    const url = window.location.origin + `/events/${currentEventData.id}/`;
    const text = `Check out this event: ${currentEventData.title}\n\n${url}`;
    
    navigator.clipboard.writeText(text).then(() => {
        SweetAlertUtils.success('Copied!', 'Event link copied to clipboard');
    }).catch(() => {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        SweetAlertUtils.success('Copied!', 'Event link copied to clipboard');
    });
}
</script>
{% endblock %}