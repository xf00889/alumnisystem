{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}{{ event.title }}{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'core:home' %}">Home</a></li>
<li class="breadcrumb-item"><a href="{% url 'events:event_list' %}">Events</a></li>
<li class="breadcrumb-item active">{{ event.title }}</li>
{% endblock %}

{% block extra_css %}
<style>
    :root {
        --brand-primary: #2b3c6b;
        --brand-secondary: #4a5568;
        --brand-accent: #3182ce;
        --ui-background: #f7fafc;
        --ui-surface: #ffffff;
        --ui-border: #e2e8f0;
        --ui-hover: #edf2f7;
        --text-primary: #2d3748;
        --text-secondary: #718096;
        --text-light: #ffffff;
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
        --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
        --radius-sm: 0.375rem;
        --radius-md: 0.5rem;
        --radius-lg: 0.75rem;
        --spacing-1: 0.25rem;
        --spacing-2: 0.5rem;
        --spacing-3: 0.75rem;
        --spacing-4: 1rem;
        --spacing-5: 1.5rem;
        --spacing-6: 2rem;
    }

    .page-container {
        background: var(--ui-background);
        min-height: calc(100vh - 76px);
        padding: var(--spacing-4) 0;
    }

    .event-header {
        background: var(--brand-primary);
        color: var(--text-light);
        padding: var(--spacing-5);
        border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        margin-bottom: 0;
        position: relative;
        overflow: hidden;
    }

    .event-header::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0) 100%);
        z-index: 1;
    }

    .event-header .container {
        position: relative;
        z-index: 2;
    }

    .event-image {
        width: 100%;
        height: 350px;
        object-fit: cover;
        border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    }

    .event-content {
        background: var(--ui-surface);
        border: 1px solid var(--ui-border);
        border-radius: 0 0 var(--radius-lg) var(--radius-lg);
        padding: var(--spacing-5);
    }

    .event-meta {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: var(--spacing-3);
        margin-bottom: var(--spacing-5);
        padding: var(--spacing-4);
        background: var(--ui-hover);
        border-radius: var(--radius-md);
    }

    .meta-item {
        display: flex;
        align-items: center;
        gap: var(--spacing-3);
        padding: var(--spacing-3);
        background: var(--ui-surface);
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-sm);
        transition: all 0.2s ease;
        border: 1px solid var(--ui-border);
    }

    .meta-item:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
        border-color: var(--brand-primary);
    }

    .meta-item i {
        font-size: 1.25rem;
        color: var(--brand-primary);
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--ui-hover);
        border-radius: var(--radius-md);
        transition: all 0.2s ease;
    }

    .meta-item:hover i {
        background: var(--brand-primary);
        color: var(--text-light);
    }

    .meta-item-content {
        flex: 1;
        min-width: 0;
    }

    .meta-item-label {
        font-size: 0.8125rem;
        color: var(--text-secondary);
        margin-bottom: var(--spacing-1);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .meta-item-value {
        font-weight: 500;
        color: var(--text-primary);
        font-size: 0.9375rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .event-description {
        color: var(--text-secondary);
        line-height: 1.7;
        font-size: 1rem;
        margin-bottom: var(--spacing-5);
        padding: var(--spacing-4);
        background: var(--ui-hover);
        border-radius: var(--radius-md);
    }

    .rsvp-card {
        background: var(--ui-surface);
        border: 1px solid var(--ui-border);
        border-radius: var(--radius-lg);
        margin-top: var(--spacing-5);
        box-shadow: var(--shadow-md);
    }

    .rsvp-header {
        background: var(--brand-primary);
        color: var(--text-light);
        padding: var(--spacing-4);
        border-radius: var(--radius-md) var(--radius-md) 0 0;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: var(--spacing-2);
        font-size: 1rem;
    }

    .rsvp-content {
        padding: var(--spacing-4);
    }

    .stats-widget {
        background: var(--ui-surface);
        border: 1px solid var(--ui-border);
        border-radius: var(--radius-md);
        overflow: hidden;
        margin-bottom: var(--spacing-4);
        box-shadow: var(--shadow-md);
    }

    .stats-header {
        background: var(--brand-primary);
        color: var(--text-light);
        padding: var(--spacing-3) var(--spacing-4);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: var(--spacing-2);
        font-size: 0.9375rem;
    }

    .stats-content {
        padding: var(--spacing-4);
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: var(--spacing-3);
        text-align: center;
    }

    .stat-item {
        padding: var(--spacing-3);
        background: var(--ui-hover);
        border-radius: var(--radius-md);
        transition: all 0.2s ease;
    }

    .stat-item:hover {
        transform: translateY(-2px);
        background: var(--ui-surface);
        box-shadow: var(--shadow-sm);
    }

    .stat-item h3 {
        color: var(--brand-primary);
        font-size: 1.5rem;
        margin-bottom: var(--spacing-2);
        font-weight: 600;
    }

    .stat-item p {
        color: var(--text-secondary);
        margin: 0;
        font-size: 0.8125rem;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .badge {
        padding: 0.4em 0.8em;
        border-radius: var(--radius-sm);
        font-weight: 500;
        font-size: 0.8125rem;
    }

    .badge.bg-success {
        background: #48bb78 !important;
    }

    .badge.bg-warning {
        background: #ecc94b !important;
        color: #744210;
    }

    .badge.bg-info {
        background: #4299e1 !important;
    }

    .action-buttons {
        display: flex;
        gap: var(--spacing-3);
        margin-top: var(--spacing-5);
    }

    .action-buttons .btn {
        padding: var(--spacing-2) var(--spacing-4);
        display: flex;
        align-items: center;
        gap: var(--spacing-2);
        font-weight: 500;
        font-size: 0.9375rem;
        border-radius: var(--radius-md);
        transition: all 0.2s ease;
    }

    .action-buttons .btn:hover {
        transform: translateY(-2px);
    }

    .list-group-item {
        padding: var(--spacing-3) var(--spacing-4);
        border-left: none;
        border-right: none;
        transition: all 0.2s ease;
    }

    .list-group-item:first-child {
        border-top: none;
    }

    .list-group-item:last-child {
        border-bottom: none;
    }

    .list-group-item:hover {
        background: var(--ui-hover);
    }

    .form-control {
        border-radius: var(--radius-md);
        padding: var(--spacing-2) var(--spacing-3);
        font-size: 0.9375rem;
    }

    .form-control:focus {
        border-color: var(--brand-primary);
        box-shadow: 0 0 0 2px rgba(43, 60, 107, 0.15);
    }

    @media (max-width: 768px) {
        .event-meta {
            grid-template-columns: 1fr;
            gap: var(--spacing-3);
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
            gap: var(--spacing-3);
        }
        
        .action-buttons {
            flex-direction: column;
        }
        
        .action-buttons .btn {
            width: 100%;
            justify-content: center;
        }

        .event-image {
            height: 250px;
        }

        .event-content {
            padding: var(--spacing-4);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="page-container">
    <div class="container">
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'core:home' %}">Home</a></li>
                <li class="breadcrumb-item"><a href="{% url 'events:event_list' %}">Events</a></li>
                <li class="breadcrumb-item active">{{ event.title }}</li>
            </ol>
        </nav>

        <div class="row">
            <!-- Main Content -->
            <div class="col-lg-8">
                <div class="event-main">
                    {% if event.image %}
                    <img src="{{ event.image.url }}" class="event-image" alt="{{ event.title }}">
                    {% else %}
                    <div class="event-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h1 class="h2 mb-0">{{ event.title }}</h1>
                            <span class="badge {% if event.status == 'published' %}bg-success{% elif event.status == 'draft' %}bg-warning{% else %}bg-secondary{% endif %}">
                                {{ event.status|title }}
                            </span>
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="event-content">
                        {% if event.image %}
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h1 class="h2 mb-0">{{ event.title }}</h1>
                            <span class="badge {% if event.status == 'published' %}bg-success{% elif event.status == 'draft' %}bg-warning{% else %}bg-secondary{% endif %}">
                                {{ event.status|title }}
                            </span>
                        </div>
                        {% endif %}

                        <div class="event-meta">
                            <div class="meta-item">
                                <i class="fas fa-calendar"></i>
                                <div class="meta-item-content">
                                    <div class="meta-item-label">Date</div>
                                    <div class="meta-item-value">{{ event.start_date|date:"F j, Y" }}</div>
                                </div>
                            </div>
                            <div class="meta-item">
                                <i class="fas fa-clock"></i>
                                <div class="meta-item-content">
                                    <div class="meta-item-label">Time</div>
                                    <div class="meta-item-value">{{ event.start_date|date:"g:i A" }} - {{ event.end_date|date:"g:i A" }}</div>
                                </div>
                            </div>
                            <div class="meta-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <div class="meta-item-content">
                                    <div class="meta-item-label">Location</div>
                                    <div class="meta-item-value">
                                        {% if event.is_virtual %}
                                            Virtual Event
                                            {% if event.virtual_link %}
                                            <a href="{{ event.virtual_link }}" target="_blank" class="ms-2 text-primary">
                                                <i class="fas fa-external-link-alt"></i> Join Meeting
                                            </a>
                                            {% endif %}
                                        {% else %}
                                            {{ event.location }}
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% if event.max_participants %}
                            <div class="meta-item">
                                <i class="fas fa-users"></i>
                                <div class="meta-item-content">
                                    <div class="meta-item-label">Capacity</div>
                                    <div class="meta-item-value">{{ event.max_participants }} participants</div>
                                </div>
                            </div>
                            {% endif %}
                        </div>

                        <div class="event-description">
                            {{ event.description|safe }}
                        </div>

                        {% if user.is_authenticated %}
                        <div class="rsvp-card">
                            <div class="rsvp-header">
                                <i class="fas fa-calendar-check me-2"></i>
                                RSVP to this Event
                            </div>
                            <div class="rsvp-content">
                                <form method="post" action="{% url 'events:event_rsvp' event.pk %}">
                                    {% csrf_token %}
                                    <div class="mb-3">
                                        {{ rsvp_form.status }}
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ rsvp_form.notes.id_for_label }}" class="form-label">Additional Notes</label>
                                        {{ rsvp_form.notes }}
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-check me-2"></i>
                                        Submit RSVP
                                    </button>
                                </form>
                            </div>
                        </div>
                        {% endif %}

                        {% if user.is_staff %}
                        <div class="action-buttons">
                            <a href="{% url 'events:event_update' event.pk %}" class="btn btn-outline-primary">
                                <i class="fas fa-edit"></i> Edit Event
                            </a>
                            <a href="{% url 'events:event_delete' event.pk %}" class="btn btn-outline-danger">
                                <i class="fas fa-trash"></i> Delete Event
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- RSVP Stats -->
                <div class="stats-widget">
                    <div class="stats-header">
                        <i class="fas fa-chart-bar me-2"></i>
                        RSVP Statistics
                    </div>
                    <div class="stats-content">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <h3 class="text-success">{{ rsvp_counts.attending }}</h3>
                                <p>Attending</p>
                            </div>
                            <div class="stat-item">
                                <h3 class="text-warning">{{ rsvp_counts.maybe }}</h3>
                                <p>Maybe</p>
                            </div>
                            <div class="stat-item">
                                <h3 class="text-danger">{{ rsvp_counts.not_attending }}</h3>
                                <p>Not Attending</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Event Details -->
                <div class="stats-widget">
                    <div class="stats-header">
                        <i class="fas fa-info-circle me-2"></i>
                        Event Details
                    </div>
                    <div class="stats-content">
                        <ul class="list-unstyled mb-0">
                            <li class="mb-2">
                                <strong>Created by:</strong> {{ event.created_by.get_full_name|default:event.created_by.username }}
                            </li>
                            <li class="mb-2">
                                <strong>Created:</strong> {{ event.created_at|naturaltime }}
                            </li>
                            <li>
                                <strong>Last updated:</strong> {{ event.updated_at|naturaltime }}
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Notified Groups -->
                {% if event.notified_groups.exists %}
                <div class="stats-widget">
                    <div class="stats-header">
                        <i class="fas fa-users me-2"></i>
                        Notified Groups
                    </div>
                    <div class="stats-content p-0">
                        <div class="list-group list-group-flush">
                            {% for group in event.notified_groups.all %}
                            <a href="#" class="list-group-item list-group-item-action d-flex align-items-center">
                                <i class="fas fa-user-friends me-2 text-primary"></i>
                                {{ group.name }}
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %} 