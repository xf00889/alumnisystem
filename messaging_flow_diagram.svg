<svg width="1200" height="800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: 'Poppins', Arial, sans-serif; font-size: 24px; font-weight: bold; fill: #2c3e50; }
      .subtitle { font-family: 'Poppins', Arial, sans-serif; font-size: 16px; font-weight: bold; fill: #34495e; }
      .text { font-family: 'Poppins', Arial, sans-serif; font-size: 12px; fill: #2c3e50; }
      .small-text { font-family: 'Poppins', Arial, sans-serif; font-size: 10px; fill: #7f8c8d; }
      .box { fill: #ecf0f1; stroke: #34495e; stroke-width: 2; }
      .mentorship-box { fill: #e8f5e8; stroke: #27ae60; stroke-width: 2; }
      .connection-box { fill: #e8f4fd; stroke: #3498db; stroke-width: 2; }
      .group-box { fill: #fdf2e9; stroke: #e67e22; stroke-width: 2; }
      .flow-arrow { stroke: #2c3e50; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .data-arrow { stroke: #e74c3c; stroke-width: 2; fill: none; marker-end: url(#arrowhead); stroke-dasharray: 5,5; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2c3e50" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="600" y="30" text-anchor="middle" class="title">Alumni System - Message Flow Architecture</text>
  
  <!-- User Authentication Layer -->
  <rect x="50" y="60" width="1100" height="60" class="box" rx="5"/>
  <text x="600" y="80" text-anchor="middle" class="subtitle">User Authentication & Authorization Layer</text>
  <text x="600" y="100" text-anchor="middle" class="text">@login_required decorators ensure authenticated access to all messaging functions</text>
  
  <!-- Three Main Messaging Systems -->
  
  <!-- 1. Mentorship Messaging System -->
  <rect x="50" y="150" width="350" height="280" class="mentorship-box" rx="10"/>
  <text x="225" y="175" text-anchor="middle" class="subtitle">Mentorship Messaging</text>
  
  <!-- Mentorship Models -->
  <rect x="70" y="190" width="150" height="40" class="box" rx="5"/>
  <text x="145" y="205" text-anchor="middle" class="text">Conversation Model</text>
  <text x="145" y="220" text-anchor="middle" class="small-text">OneToOne → MentorshipRequest</text>
  
  <rect x="230" y="190" width="150" height="40" class="box" rx="5"/>
  <text x="305" y="205" text-anchor="middle" class="text">Message Model</text>
  <text x="305" y="220" text-anchor="middle" class="small-text">ForeignKey → Conversation</text>
  
  <!-- Mentorship Views -->
  <rect x="70" y="250" width="310" height="80" class="box" rx="5"/>
  <text x="225" y="270" text-anchor="middle" class="text">Mentorship Views</text>
  <text x="80" y="290" class="small-text">• conversation_list_view()</text>
  <text x="80" y="305" class="small-text">• conversation_detail_view()</text>
  <text x="80" y="320" class="small-text">• send_message()</text>
  <text x="220" y="290" class="small-text">• messaging_page()</text>
  <text x="220" y="305" class="small-text">• create_conversation()</text>
  
  <!-- Mentorship URLs -->
  <rect x="70" y="350" width="310" height="60" class="box" rx="5"/>
  <text x="225" y="370" text-anchor="middle" class="text">URL Patterns</text>
  <text x="80" y="390" class="small-text">/messages/ | /messages/conversation/{id}/</text>
  <text x="80" y="405" class="small-text">/messages/conversation/{id}/send/</text>
  
  <!-- 2. Direct Connections Messaging -->
  <rect x="425" y="150" width="350" height="280" class="connection-box" rx="10"/>
  <text x="600" y="175" text-anchor="middle" class="subtitle">Direct Connections Messaging</text>
  
  <!-- Connection Models -->
  <rect x="445" y="190" width="150" height="40" class="box" rx="5"/>
  <text x="520" y="205" text-anchor="middle" class="text">DirectConversation</text>
  <text x="520" y="220" text-anchor="middle" class="small-text">ManyToMany → Users</text>
  
  <rect x="605" y="190" width="150" height="40" class="box" rx="5"/>
  <text x="680" y="205" text-anchor="middle" class="text">DirectMessage</text>
  <text x="680" y="220" text-anchor="middle" class="small-text">ForeignKey → DirectConversation</text>
  
  <!-- Connection Requirements -->
  <rect x="445" y="250" width="310" height="40" class="box" rx="5"/>
  <text x="600" y="265" text-anchor="middle" class="text">Connection Requirement</text>
  <text x="600" y="280" text-anchor="middle" class="small-text">Connection.are_connected() validation</text>
  
  <!-- Connection Views -->
  <rect x="445" y="310" width="310" height="60" class="box" rx="5"/>
  <text x="600" y="330" text-anchor="middle" class="text">Direct Message Views</text>
  <text x="455" y="350" class="small-text">• direct_messages() - handles both list & detail</text>
  <text x="455" y="365" class="small-text">• AJAX support for real-time messaging</text>
  
  <!-- Connection URLs -->
  <rect x="445" y="380" width="310" height="40" class="box" rx="5"/>
  <text x="600" y="395" text-anchor="middle" class="text">URL Patterns</text>
  <text x="600" y="410" text-anchor="middle" class="small-text">/messages/ | /messages/{user_id}/</text>
  
  <!-- 3. Group Messaging System -->
  <rect x="800" y="150" width="350" height="280" class="group-box" rx="10"/>
  <text x="975" y="175" text-anchor="middle" class="subtitle">Alumni Group Messaging</text>
  
  <!-- Group Models -->
  <rect x="820" y="190" width="150" height="40" class="box" rx="5"/>
  <text x="895" y="205" text-anchor="middle" class="text">GroupMessage</text>
  <text x="895" y="220" text-anchor="middle" class="small-text">ForeignKey → AlumniGroup</text>
  
  <rect x="980" y="190" width="150" height="40" class="box" rx="5"/>
  <text x="1055" y="205" text-anchor="middle" class="text">GroupMembership</text>
  <text x="1055" y="220" text-anchor="middle" class="small-text">Validation Required</text>
  
  <!-- Group Views -->
  <rect x="820" y="250" width="310" height="80" class="box" rx="5"/>
  <text x="975" y="270" text-anchor="middle" class="text">Group Message Views</text>
  <text x="830" y="290" class="small-text">• send_message() - API endpoint</text>
  <text x="830" y="305" class="small-text">• get_messages() - AJAX message retrieval</text>
  <text x="830" y="320" class="small-text">• Membership validation required</text>
  
  <!-- Group URLs -->
  <rect x="820" y="350" width="310" height="60" class="box" rx="5"/>
  <text x="975" y="370" text-anchor="middle" class="text">URL Patterns</text>
  <text x="830" y="390" class="small-text">/api/{slug}/messages/send/</text>
  <text x="830" y="405" class="small-text">/api/{slug}/messages/get/</text>
  
  <!-- Message Flow Arrows -->
  
  <!-- User to Systems -->
  <line x1="600" y1="120" x2="225" y2="150" class="flow-arrow"/>
  <line x1="600" y1="120" x2="600" y2="150" class="flow-arrow"/>
  <line x1="600" y1="120" x2="975" y2="150" class="flow-arrow"/>
  
  <!-- Data Flow Section -->
  <rect x="50" y="460" width="1100" height="320" class="box" rx="10"/>
  <text x="600" y="485" text-anchor="middle" class="subtitle">Message Flow Process</text>
  
  <!-- Flow Steps -->
  <rect x="80" y="510" width="200" height="80" class="mentorship-box" rx="5"/>
  <text x="180" y="530" text-anchor="middle" class="text">1. Authentication</text>
  <text x="90" y="550" class="small-text">• @login_required check</text>
  <text x="90" y="565" class="small-text">• User session validation</text>
  <text x="90" y="580" class="small-text">• Permission verification</text>
  
  <rect x="300" y="510" width="200" height="80" class="connection-box" rx="5"/>
  <text x="400" y="530" text-anchor="middle" class="text">2. Relationship Check</text>
  <text x="310" y="550" class="small-text">• Mentorship: APPROVED status</text>
  <text x="310" y="565" class="small-text">• Connection: are_connected()</text>
  <text x="310" y="580" class="small-text">• Group: membership validation</text>
  
  <rect x="520" y="510" width="200" height="80" class="group-box" rx="5"/>
  <text x="620" y="530" text-anchor="middle" class="text">3. Conversation Setup</text>
  <text x="530" y="550" class="small-text">• Get/Create conversation</text>
  <text x="530" y="565" class="small-text">• Load message history</text>
  <text x="530" y="580" class="small-text">• Mark messages as read</text>
  
  <rect x="740" y="510" width="200" height="80" class="mentorship-box" rx="5"/>
  <text x="840" y="530" text-anchor="middle" class="text">4. Message Processing</text>
  <text x="750" y="550" class="small-text">• Form validation</text>
  <text x="750" y="565" class="small-text">• File attachment handling</text>
  <text x="750" y="580" class="small-text">• Message persistence</text>
  
  <rect x="960" y="510" width="180" height="80" class="connection-box" rx="5"/>
  <text x="1050" y="530" text-anchor="middle" class="text">5. Response</text>
  <text x="970" y="550" class="small-text">• AJAX: JSON response</text>
  <text x="970" y="565" class="small-text">• HTTP: Template render</text>
  <text x="970" y="580" class="small-text">• HTMX: Partial update</text>
  
  <!-- Flow arrows between steps -->
  <line x1="280" y1="550" x2="300" y2="550" class="flow-arrow"/>
  <line x1="500" y1="550" x2="520" y2="550" class="flow-arrow"/>
  <line x1="720" y1="550" x2="740" y2="550" class="flow-arrow"/>
  <line x1="940" y1="550" x2="960" y2="550" class="flow-arrow"/>
  
  <!-- Technical Implementation Details -->
  <rect x="80" y="620" width="360" height="140" class="box" rx="5"/>
  <text x="260" y="640" text-anchor="middle" class="text">Technical Implementation</text>
  <text x="90" y="660" class="small-text">Forms:</text>
  <text x="90" y="675" class="small-text">• MessageForm (mentorship)</text>
  <text x="90" y="690" class="small-text">• DirectMessageForm (connections)</text>
  <text x="90" y="705" class="small-text">• AJAX form handling (groups)</text>
  <text x="90" y="730" class="small-text">Features:</text>
  <text x="90" y="745" class="small-text">• File attachments, Read receipts, Real-time updates</text>
  
  <rect x="460" y="620" width="360" height="140" class="box" rx="5"/>
  <text x="640" y="640" text-anchor="middle" class="text">Security & Validation</text>
  <text x="470" y="660" class="small-text">Access Control:</text>
  <text x="470" y="675" class="small-text">• Participant verification for all message types</text>
  <text x="470" y="690" class="small-text">• Connection status validation</text>
  <text x="470" y="705" class="small-text">• Group membership requirements</text>
  <text x="470" y="730" class="small-text">Data Validation:</text>
  <text x="470" y="745" class="small-text">• Content length limits, File type restrictions</text>
  
  <rect x="840" y="620" width="300" height="140" class="box" rx="5"/>
  <text x="990" y="640" text-anchor="middle" class="text">Frontend Integration</text>
  <text x="850" y="660" class="small-text">Technologies:</text>
  <text x="850" y="675" class="small-text">• HTMX for dynamic updates</text>
  <text x="850" y="690" class="small-text">• AJAX for real-time messaging</text>
  <text x="850" y="705" class="small-text">• Bootstrap for responsive UI</text>
  <text x="850" y="730" class="small-text">Features:</text>
  <text x="850" y="745" class="small-text">• Auto-scroll, Typing indicators, File previews</text>
  
</svg>